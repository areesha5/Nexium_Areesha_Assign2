!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d1359e13-f05d-43c2-8c32-4e58b0e11de7",e._sentryDebugIdIdentifier="sentry-dbid-d1359e13-f05d-43c2-8c32-4e58b0e11de7")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[475,4598,6841],{8082:(e,t,n)=>{"use strict";n.d(t,{a:()=>o});var s=n(43033),r=n(45467),a=n(96971);let o=e=>{let{preset:t,orderBy:n,searchQuery:o="",roles:i,runIndexAdvisor:l=!1}=e,d=r.NY[a.N.QUERY_PERFORMANCE].queries[t],c=[void 0!==i&&i.length>0?"auth.rolname in (".concat(i.map(e=>"'".concat(e,"'")).join(", "),")"):"",o.length>0?"statements.query ~ '".concat(o,"'"):""].filter(e=>e.length>0).join(" AND "),u=n&&"ORDER BY ".concat(n.column," ").concat(n.order),m=d.sql([],c.length>0?"WHERE ".concat(c):void 0,u,l);return(0,s.A)({sql:m,params:void 0,where:c,orderBy:u})}},24261:(e,t,n)=>{"use strict";n.d(t,{tV:()=>c,_X:()=>d});var s=n(17331),r=n(56947),a=n(18232);let o={databaseRoles:e=>["projects",e,"database-roles"]},i=s.A.roles.list();async function l(e,t){let{projectRef:n,connectionString:s}=e,{result:r}=await (0,a.E)({projectRef:n,connectionString:s,sql:i.sql,queryKey:["database-roles"]},t);return r}let d=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.I)(o.databaseRoles(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...a})};function c(e,t){return e.invalidateQueries(o.databaseRoles(t))}},26261:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eU});var s=n(80263),r=n(87355),a=n(45982),o=n(25481),i=n(53239),l=n(73969),d=n(18232);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{hypopg:e.find(e=>"hypopg"===e.name),indexAdvisor:e.find(e=>"index_advisor"===e.name)}}function u(e,t){return void 0===e||void 0===t||e<=0||e<=t?0:(e-t)/e*100}async function m(e){let{projectRef:t,connectionString:n,indexStatements:s,onSuccess:r,onError:a}=e;if(!t){let e=Error("Project ref is required");return a&&a(e),Promise.reject(e)}if(0===s.length){let e=Error("No index statements provided");return a&&a(e),Promise.reject(e)}try{return await (0,d.E)({projectRef:t,connectionString:n,sql:s.join(";\n")+";"}),l.oR.success("Successfully created index"),r&&r(),Promise.resolve()}catch(e){return l.oR.error("Failed to create index: ".concat(e.message)),a&&a(e),Promise.reject(e)}}function x(e,t){return!!(t&&(null==e?void 0:e.index_statements)&&e.index_statements.length>0)}var p=n(9895),h=n(94326);function f(){let{project:e}=(0,p.Om)(),{data:t}=(0,h.z)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{hypopg:n,indexAdvisor:s}=c(null!=t?t:[]),r=!!n&&!!s,a=r&&null!==n.installed_version&&null!==s.installed_version;return{isIndexAdvisorAvailable:r,isIndexAdvisorEnabled:a}}var y=n(95134),g=n(8538),_=n(85462),v=n(37263),j=n(58173),b=n(72470);let S=()=>{let{project:e}=(0,p.Om)(),{isIndexAdvisorAvailable:t,isIndexAdvisorEnabled:n}=f(),[r,a]=(0,i.useState)(!1),{data:o}=(0,h.z)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{hypopg:d,indexAdvisor:u}=c(o),{mutateAsync:m,isLoading:x}=(0,y.E)(),S=async()=>{if(void 0===e)return l.oR.error("Project is required");try{var t,n;(null==d?void 0:d.installed_version)===null&&await m({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,name:d.name,schema:null!=(t=null==d?void 0:d.schema)?t:"extensions",version:d.default_version}),(null==u?void 0:u.installed_version)===null&&await m({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,name:u.name,schema:null!=(n=null==u?void 0:u.schema)?n:"extensions",version:u.default_version}),l.oR.success("Successfully enabled Index Advisor!"),a(!1)}catch(e){l.oR.error("Failed to enable Index Advisor: ".concat(e.message))}};return!t||n?null:(0,s.jsxs)(g.Lt,{open:r,onOpenChange:()=>a(!r),"data-sentry-element":"AlertDialog","data-sentry-component":"EnableIndexAdvisorButton","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,s.jsxs)(_.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,s.jsx)(_.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:(0,s.jsx)(g.tv,{asChild:!0,"data-sentry-element":"AlertDialogTrigger","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:(0,s.jsx)(v.$,{type:"outline",className:"rounded-full",icon:(0,s.jsx)(j.mo,{}),"data-sentry-element":"Button","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Enable Index Advisor"})})}),(0,s.jsx)(_.ZI,{side:"top","data-sentry-element":"TooltipContent","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Recommends indexes to improve query performance"})]}),(0,s.jsxs)(g.EO,{"data-sentry-element":"AlertDialogContent","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,s.jsxs)(g.wd,{"data-sentry-element":"AlertDialogHeader","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,s.jsx)(g.r7,{"data-sentry-element":"AlertDialogTitle","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Enable Index Advisor"}),(0,s.jsxs)(g.$v,{"data-sentry-element":"AlertDialogDescription","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:["Index Advisor is a tool that helps you identify and simulate indexes that can improve query performance. To use Index Advisor, you need to enable the following Postgres extensions:",(0,s.jsxs)("ul",{className:"list-disc pl-6 py-4 flex flex-col gap-2",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)(b.E,{className:"font-mono text-foreground","data-sentry-element":"Badge","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"index_advisor"})," - Recommends database indexes"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)(b.E,{className:"font-mono text-foreground","data-sentry-element":"Badge","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"hypopg"})," - For hypothetical indexes simulation"]})]}),"These extensions help identify and simulate indexes that can improve query performance without having to create actual indexes."]})]}),(0,s.jsxs)(g.ck,{"data-sentry-element":"AlertDialogFooter","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,s.jsx)(g.Zr,{"data-sentry-element":"AlertDialogCancel","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Cancel"}),(0,s.jsx)(g.Rx,{onClick:e=>{e.preventDefault(),S()},disabled:x,"data-sentry-element":"AlertDialogAction","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:x?"Enabling...":"Enable Extensions"})]})]})]})};var w=n(52554),N=n(29260),q=n(76195),A=n(24141),I=n(19214),E=n(32211),T=n(37785),R=n(16425),C=n(82457),P=n(7433),O=n(54097),Q=n(81172),k=n(63809),D=n(8082),F=function(e){return e.MOST_TIME_CONSUMING="most_time_consuming",e.MOST_FREQUENT="most_frequent",e.SLOWEST_EXECUTION="slowest_execution",e}({});let L={most_time_consuming:"mostTimeConsuming",most_frequent:"mostFrequentlyInvoked",slowest_execution:"slowestExecutionTime"},M={most_time_consuming:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150}],most_frequent:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}],slowest_execution:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}]};var B=n(25964),U=n(46249),W=n(24716),H=n(24394),z=n(6861),$=n(24261),Y=n(42206),G=n(67928),V=n(52862);let K=e=>{let{name:t,value:n="",placeholder:r,rows:a=4,onSaveText:o}=e,[l,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(n),m=()=>{o(c),d(!1)};return(0,s.jsxs)(G.AM,{open:l,onOpenChange:d,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"TextSearchPopover","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,s.jsx)(G.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,s.jsx)(v.$,{asChild:!0,type:n.length>0?"default":"dashed",onClick:()=>d(!1),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,s.jsxs)("div",{className:"max-w-[170px]",children:[(0,s.jsx)("span",{children:t}),n.length>0&&(0,s.jsx)("span",{className:"mr-1",children:":"}),(0,s.jsx)("span",{className:"truncate",children:n})]})})}),(0,s.jsxs)(G.hl,{portal:!0,className:"p-0",side:"bottom",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,s.jsx)("div",{className:"space-y-4 p-3 min-w-[170px]",children:(0,s.jsx)(V.f,{value:c,onChange:e=>u(e.target.value),rows:a,className:"text-xs font-mono tracking-tight",placeholder:null!=r?r:"Search for a query",onKeyDown:e=>{e.metaKey&&"Enter"===e.code&&m()},"data-sentry-element":"TextArea_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx"})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,s.jsx)(v.$,{size:"tiny",type:"default",onClick:()=>{o(""),u(""),d(!1)},"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Clear"}),(0,s.jsx)(v.$,{type:"primary",onClick:()=>m(),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Apply search"})]})]})]})},X=e=>{var t;let{queryPerformanceQuery:n,onResetReportClick:a}=e,l=(0,r.useRouter)(),{ref:d}=(0,o.g)(),{project:c}=(0,p.Om)(),[u]=(0,I.U)(o.rS.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),m=l.query.search?String(l.query.search):"",x=l.query.roles?l.query.roles:[],h=l.query.sort?{column:l.query.sort,order:l.query.order}:void 0,[f,y]=(0,i.useState)(m),[g,_]=(0,i.useState)({roles:"string"==typeof x?[x]:x,query:""}),[j,b]=(0,i.useState)(null!=h?h:{column:"total_time",order:"desc"}),{isLoading:S,isRefetching:w}=n,{data:N,isLoading:q}=(0,$._X)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),A=(null!=N?N:[]).sort((e,t)=>e.name.localeCompare(t.name)),E=e=>{b({column:"total_time",order:e}),l.push({...l,query:{...l.query,sort:"total_time",order:e}})};return(0,s.jsxs)("div",{className:"px-6 py-2 bg-surface-200 border-t -mt-px flex justify-between items-center","data-sentry-component":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("p",{className:"text-xs prose",children:"Filter by"}),(0,s.jsx)(z.I,{name:"Roles",options:A,labelKey:"name",valueKey:"name",activeOptions:q?[]:g.roles,onSaveFilters:e=>{_({...g,roles:e}),l.push({...l,query:{...l.query,roles:e}})},"data-sentry-element":"FilterPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,s.jsx)(K,{name:"Query",value:f,onSaveText:e=>{if(y(e),e&&"string"==typeof e)l.push({...l,query:{...l.query,search:e}});else{let{search:e,...t}=l.query;l.push({...l,query:{...t}})}},"data-sentry-element":"TextSearchPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,s.jsx)("div",{className:"border-r border-strong h-6"}),(0,s.jsxs)(Y.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,s.jsx)(Y.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,s.jsx)(v.$,{icon:(null==j?void 0:j.order)==="desc"?(0,s.jsx)(B.A,{}):(0,s.jsx)(U.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(null==j?void 0:j.order)==="desc"?"Sorted by latency - high to low":"Sorted by latency - low to high"})}),(0,s.jsx)(Y.SQ,{className:"w-56","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,s.jsxs)(Y.Hr,{value:null==j?void 0:j.order,onValueChange:e=>E(e),"data-sentry-element":"DropdownMenuRadioGroup","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,s.jsx)(Y.Ht,{value:"desc",defaultChecked:(null==j?void 0:j.order)==="desc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - high to low"}),(0,s.jsx)(Y.Ht,{value:"asc",defaultChecked:(null==j?void 0:j.order)==="asc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - low to high"})]})})]})]})}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[!u&&a&&(0,s.jsx)(v.$,{type:"default",onClick:()=>a(),children:"Reset report"}),(0,s.jsx)(v.$,{size:"tiny",type:"default",onClick:()=>n.runQuery(),disabled:S||w,icon:(0,s.jsx)(W.A,{className:"text-foreground-light ".concat(S||w?"animate-spin":"")}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Refresh"}),(0,s.jsx)(H.b,{results:null!=(t=n.data)?t:[],fileName:"Supabase Query Performance (".concat(d,")"),"data-sentry-element":"DownloadResultsButton","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"})]})]})};var Z=n(1318),J=n(24560),ee=n(27760),et=n(58394),en=n(63212),es=n(17082),er=n(26822);let ea=e=>{let{indexStatements:t,totalCostBefore:n,totalCostAfter:r,className:a,...o}=e,i=u(n,r);return(0,s.jsxs)("p",{className:(0,C.cn)("text-sm text-foreground-light",a),...o,"data-sentry-component":"IndexImprovementText","data-sentry-source-file":"IndexImprovementText.tsx",children:["Query's performance can be improved by"," ",(0,s.jsxs)("span",{className:"text-brand",children:[i.toFixed(2),"%"]})," by creating this"," ",t.length>1?"indexes":"index",":"]})},eo=e=>{let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,C.cn)("flex flex-col gap-y-6 py-4",n),"data-sentry-component":"QueryPanelContainer","data-sentry-source-file":"QueryPanel.tsx",children:t})},ei=e=>{let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,C.cn)("px-5 flex flex-col gap-y-2",n),"data-sentry-component":"QueryPanelSection","data-sentry-source-file":"QueryPanel.tsx",children:t})},el=e=>{let{className:t,name:n,description:r,before:a,after:o,hideArrowMarkers:i=!1}=e;return(0,s.jsxs)("div",{className:(0,C.cn)("py-4 px-4 flex",t),"data-sentry-component":"QueryPanelScoreSection","data-sentry-source-file":"QueryPanel.tsx",children:[(0,s.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,s.jsx)("span",{className:"text-sm",children:n}),(0,s.jsxs)(_.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"QueryPanel.tsx",children:[(0,s.jsx)(_.k$,{asChild:!0,className:"mt-1","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"QueryPanel.tsx",children:(0,s.jsx)(w.A,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light","data-sentry-element":"InformationCircleIcon","data-sentry-source-file":"QueryPanel.tsx"})}),(0,s.jsx)(_.ZI,{side:"top",className:"w-52 text-center","data-sentry-element":"TooltipContent","data-sentry-source-file":"QueryPanel.tsx",children:r})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,s.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,s.jsx)("span",{className:(0,C.cn)("font-mono",void 0!==a&&void 0!==o&&a!==o?"text-foreground-light":""),children:a})]}),void 0!==a&&void 0!==o&&a!==o&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,s.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,s.jsx)("span",{className:"font-mono",children:o}),void 0!==a&&!i&&(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[o>a?(0,s.jsx)(U.A,{size:14,className:"text-warning"}):(0,s.jsx)(B.A,{size:14,className:"text-brand"}),0!==a&&(0,s.jsxs)("span",{className:(0,C.cn)("font-mono tracking-tighter",o>a?"text-warning":"text-brand"),children:[((a-o)/a*100).toFixed(2),"%"]})]})]})]})]})};var ed=n(32144),ec=n(75373),eu=n(67394);function em(){var e,t;let n=(0,r.useRouter)(),s=(0,ed.jE)(),{project:o}=(0,p.Om)(),{isIndexAdvisorEnabled:l}=f(),[{preset:d,search:c,order:u,sort:m}]=(0,a.ab)({sort:a.tU,search:a.tU.withDefault(""),order:a.tU,preset:a.tU.withDefault(F.MOST_TIME_CONSUMING)}),x=L[d],h=null!=(t=null==n||null==(e=n.query)?void 0:e.roles)?t:[],y=(0,D.a)({searchQuery:c,orderBy:m?{column:m,order:u}:void 0,preset:x,roles:"string"==typeof h?[h]:h,runIndexAdvisor:l});return(0,i.useCallback)(()=>{y.runQuery(),s.invalidateQueries(eu.c.indexAdvisorFromQuery(null==o?void 0:o.ref,"")),s.invalidateQueries(ec.K.list(null==o?void 0:o.ref))},[y,s,null==o?void 0:o.ref])}let ex=e=>{var t;let{indexAdvisorResult:n,onClickIcon:r}=e,{project:a}=(0,p.Om)(),[o,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),u=em(),x=async e=>{e.stopPropagation(),l(!0);try{await m({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,indexStatements:n.index_statements,onSuccess:()=>{r&&(r(),c(!1))}}),u()}catch(e){console.error("Failed to create index:",e),l(!1)}finally{setTimeout(()=>l(!1),1e3)}};return(null==n||null==(t=n.index_statements)?void 0:t.length)?(0,s.jsxs)(en.jc,{open:d,onOpenChange:c,"data-sentry-element":"HoverCard","data-sentry-component":"IndexSuggestionIcon","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:[(0,s.jsx)(en.d0,{"data-sentry-element":"HoverCardTrigger","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:(0,s.jsx)("div",{onClick:e=>{r&&!o&&(e.stopPropagation(),r())},className:"cursor-pointer",children:o?(0,s.jsx)(et.A,{size:16,className:"animate-spin text-foreground-light"}):(0,s.jsx)(j.id,{})})}),(0,s.jsxs)(en.Et,{className:"w-[520px] p-0 overflow-hidden",align:"start",alignOffset:-32,"data-sentry-element":"HoverCardContent","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:[(0,s.jsx)("div",{className:"px-4 py-3 bg-surface-75",children:(0,s.jsx)(ea,{indexStatements:n.index_statements,totalCostBefore:n.total_cost_before,totalCostAfter:n.total_cost_after,className:"text-sm","data-sentry-element":"IndexImprovementText","data-sentry-source-file":"IndexSuggestionIcon.tsx"})}),(0,s.jsx)(es.w,{"data-sentry-element":"Separator","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,s.jsx)("div",{children:(0,s.jsx)(er.N,{hideLineNumbers:!0,value:n.index_statements.join(";\n")+";",language:"sql",className:(0,C.cn)("border-none rounded-none","max-w-full","!py-0.5 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap"),"data-sentry-element":"CodeBlock","data-sentry-source-file":"IndexSuggestionIcon.tsx"})}),(0,s.jsx)(es.w,{"data-sentry-element":"Separator","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,s.jsx)(el,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:n.total_cost_before,after:n.total_cost_after,"data-sentry-element":"QueryPanelScoreSection","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,s.jsx)(el,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:n.startup_cost_before,after:n.startup_cost_after,"data-sentry-element":"QueryPanelScoreSection","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,s.jsxs)("div",{className:"p-3 flex gap-2 items-center border-t justify-end",children:[(0,s.jsx)(v.$,{type:"text",onClick:e=>{e.stopPropagation(),r&&!o&&r(),c(!1)},disabled:o,"data-sentry-element":"Button","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:"View details"}),(0,s.jsx)(v.$,{onClick:x,loading:o,disabled:o,"data-sentry-element":"Button","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:"Create index"})]})]})]}):null};n(44067);var ep=n(48252),eh=n(96773);let ef=e=>{let{reportType:t,selectedRow:n,onClickViewSuggestion:r}=e,a=M[t],[o,l]=(0,i.useState)(null==n?void 0:n.query);return(0,i.useEffect)(()=>{void 0!==n&&l((0,ep.A)(n.query))},[n]),(0,s.jsxs)(eo,{"data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryDetail","data-sentry-source-file":"QueryDetail.tsx",children:[(0,s.jsxs)(ei,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:[(0,s.jsx)("p",{className:"text-sm",children:"Query pattern"}),(0,s.jsx)(er.N,{hideLineNumbers:!0,value:o,language:"sql",className:(0,C.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap"),"data-sentry-element":"CodeBlock","data-sentry-source-file":"QueryDetail.tsx"}),!1]}),(0,s.jsx)("div",{className:"border-t"}),(0,s.jsx)(ei,{className:"gap-y-1","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:a.filter(e=>"query"!==e.id).map(e=>{let t=e.name.includes("time")?"".concat(null==n?void 0:n[e.id].toFixed(2),"ms"):String(null==n?void 0:n[e.id]);return(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsx)("p",{className:"text-foreground-lighter text-sm w-32",children:e.name}),(0,s.jsx)("p",{className:"text-sm w-32",children:t})]},e.id)})})]})};var ey=n(69399),eg=n(880),e_=n(92037),ev=n(80948),ej=n(56947);async function eb(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");let r=s.replace(/'/g,"''"),{result:a}=await (0,d.E)({projectRef:t,connectionString:n,sql:"select * from index_advisor('".concat(r,"');")});return a[0]}let eS=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ej.I)(eu.c.indexAdvisorFromQuery(t,s),()=>eb({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&(s.startsWith("select")||s.startsWith("SELECT"))||s.trim().toLowerCase().startsWith("with pgrst_source"),...a})};async function ew(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");try{let{result:e}=await (0,d.E)({projectRef:t,connectionString:n,queryKey:["involved-indexes-explain-query"],sql:"\n        create or replace function pg_temp.explain_query(query text) returns jsonb\n        language plpgsql\n        as $$\n        declare\n            explain_result jsonb;\n            prepared_statement_name text := 'query_to_explain';\n            explain_plan_statement text;\n            n_args int;\n        begin\n            -- Remove comment lines (its common that they contain semicolons)\n            query := trim(\n                regexp_replace(\n                    regexp_replace(\n                        regexp_replace(query,'\\/\\*.+\\*\\/', '', 'g'),\n                    '--[^\\r\\n]*', ' ', 'g'),\n                '\\s+', ' ', 'g')\n            );\n      \n            -- Remove trailing semicolon\n            query := regexp_replace(query, ';\\s*$', '');\n\n            -- Disallow multiple statements\n            if query ilike '%;%' then\n                raise exception 'Query must not contain a semicolon';\n            end if;\n        \n            -- Hack to support PostgREST because the prepared statement for args incorrectly defaults to text\n            query := replace(query, 'WITH pgrst_payload AS (SELECT $1 AS json_data)', \n                                    'WITH pgrst_payload AS (SELECT $1::json AS json_data)');\n        \n            -- Create a prepared statement for the given query\n            deallocate all;\n            execute format('prepare %I as %s', prepared_statement_name, query);\n        \n            -- Detect how many arguments are present in the prepared statement\n            n_args = (\n                select\n                    coalesce(array_length(parameter_types, 1), 0)\n                from\n                    pg_prepared_statements\n                where\n                    name = prepared_statement_name\n                limit\n                    1\n            );\n        \n            -- Create a SQL statement that can be executed to collect the explain plan\n            explain_plan_statement = format(\n                'set local plan_cache_mode = force_generic_plan; explain (format json) execute %I%s',\n                prepared_statement_name,\n                case\n                    when n_args = 0 then ''\n                    else format(\n                        '(%s)', array_to_string(array_fill('null'::text, array[n_args]), ',')\n                    )\n                end\n            );\n        \n            -- Execute the explain plan statement and get the result\n            execute explain_plan_statement into explain_result;\n        \n            -- Clean up the prepared statement\n            deallocate all;\n        \n            -- Return the explain result\n            return explain_result;\n        end;\n        $$;\n\n        select pg_temp.explain_query('".concat(s,"') as plans;\n      ")}),r=function(e){let t=[];return!function e(n){null!==n&&"object"==typeof n&&("Index Name"in n&&t.push(n["Index Name"]),Object.values(n).forEach(t=>e(t)))}(e),t}(e);if(r.length<=0)return[];let{result:a}=await (0,d.E)({projectRef:t,connectionString:n,queryKey:["involved-indexes-names"],sql:"select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (".concat(r.map(e=>"'".concat(e,"'")).join(", "),");")});return a}catch(e){return[]}}let eN=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(null!=s?s:"").trim().toLowerCase(),i=o.startsWith("select")||o.startsWith("with pgrst_source")||o.startsWith("with pgrst_payload");return(0,ej.I)(eu.c.indexesFromQuery(t,s),()=>ew({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&i,...a})};var eq=n(9079),eA=n(8758),eI=n.n(eA),eE=n(86165);let eT=()=>{let{ref:e}=(0,o.g)(),{project:t}=(0,p.Om)(),{data:n}=(0,h.z)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),{hypopg:r,indexAdvisor:a}=c(n),{mutateAsync:i,isLoading:d}=(0,y.E)(),u=async()=>{if(void 0===t)return console.error("Project is required");try{var e,n;(null==r?void 0:r.installed_version)===null&&await i({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:r.name,schema:null!=(e=null==r?void 0:r.schema)?e:"extensions",version:r.default_version}),(null==a?void 0:a.installed_version)===null&&await i({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:a.name,schema:null!=(n=null==a?void 0:a.schema)?n:"extensions",version:a.default_version}),l.oR.success("Successfully enabled index advisor!")}catch(e){l.oR.error("Failed to enable index advisor: ".concat(e.message))}};return(0,s.jsxs)(eh.Fc,{className:"mb-6","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"IndexAdvisorDisabledState","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:[(0,s.jsx)(eh.XL,{"data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,s.jsx)(k.o,{className:"text-foreground",content:void 0===a?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,s.jsx)(eh.TN,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,s.jsx)(k.o,{content:void 0===a?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query.","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,s.jsx)(eh.TN,{className:"mt-3","data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===a?(0,s.jsx)(v.$,{asChild:!0,type:"default",children:(0,s.jsx)(eI(),{href:"/project/".concat(e,"/settings/infrastructure"),children:"Upgrade Postgres version"})}):(0,s.jsx)(v.$,{type:"default",disabled:d,loading:d,onClick:()=>u(),children:"Enable extensions"}),(0,s.jsx)(eE.A,{href:"https://supabase.com/docs/guides/database/extensions/index_advisor","data-sentry-element":"DocsButton","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})]})})]})},eR=e=>{let{selectedRow:t}=e,{project:n}=(0,p.Om)(),[r,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1),{data:d,isSuccess:c,isLoading:y,isError:g,error:_}=eN({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query}),{data:j,isLoading:b}=(0,h.z)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{isIndexAdvisorEnabled:S}=f(),{data:w,error:N,refetch:q,isError:A,isSuccess:I,isLoading:E}=eS({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query},{enabled:S}),{index_statements:T,startup_cost_after:R,startup_cost_before:P,total_cost_after:O,total_cost_before:k}=null!=w?w:{index_statements:[],total_cost_after:0,total_cost_before:0},D=x(w,I),F=(u(k,O),em()),L=async()=>{if(0!==T.length){l(!0);try{await m({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,indexStatements:T,onSuccess:()=>q()}),F()}catch(e){console.error("Failed to create index:",e),l(!1)}finally{l(!1)}}};return(0,s.jsxs)(eo,{className:"h-full","data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryIndexes","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,s.jsxs)(ei,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm",children:"Indexes in use"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(null!=d?d:[]).length>1?"s":"",":"]})]}),y&&(0,s.jsx)(Q.y,{}),g&&(0,s.jsx)(ev.A,{projectRef:null==n?void 0:n.ref,error:_,subject:"Failed to retrieve indexes in use"}),c&&(0,s.jsxs)("div",{children:[0===d.length&&(0,s.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-20 gap-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,s.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),d.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(ey.A,{size:14,className:"text-foreground-light"}),(0,s.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,s.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,s.jsx)("div",{className:"border-t"}),(0,s.jsxs)(ei,{className:"flex flex-col gap-y-6","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-sm",children:"New index recommendations"}),b?(0,s.jsx)(Q.y,{}):S?(0,s.jsxs)(s.Fragment,{children:[E&&(0,s.jsx)(Q.y,{}),A&&(0,s.jsx)(ev.A,{projectRef:null==n?void 0:n.ref,error:N,subject:"Failed to retrieve result from index advisor"}),I&&(0,s.jsx)(s.Fragment,{children:0===(null!=T?T:[]).length?(0,s.jsxs)(eh.Fc,{className:"[&>svg]:rounded-full",children:[(0,s.jsx)(eg.A,{}),(0,s.jsx)(eh.XL,{children:"This query is optimized"}),(0,s.jsx)(eh.TN,{children:"Recommendations for indexes will show here"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ea,{indexStatements:T,totalCostBefore:k,totalCostAfter:O,className:"text-sm text-foreground-light"}),(0,s.jsx)(er.N,{hideLineNumbers:!0,value:T.join(";\n")+";",language:"sql",className:(0,C.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created. (e.g If your table is still small at this time)"})]})})]}):(0,s.jsx)(eT,{})]}),S&&D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-sm",children:"Query costs"}),(0,s.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100",children:[(0,s.jsx)(el,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:k,after:O}),(0,s.jsxs)(eq.Nt,{open:r,onOpenChange:a,children:[(0,s.jsx)(eq.Ke,{asChild:!0,className:"pb-3",children:(0,s.jsx)(el,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:P,after:R})}),(0,s.jsxs)(eq.R6,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",r?"less":"more"]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-sm",children:"FAQ"}),(0,s.jsxs)(e_.nD,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,s.jsxs)(e_.As,{value:"1",children:[(0,s.jsx)(e_.$m,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,s.jsx)(e_.ub,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,s.jsxs)(e_.As,{value:"2",className:"border-b-0",children:[(0,s.jsx)(e_.$m,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,s.jsxs)(e_.ub,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,s.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,s.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,s.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})]})]}),S&&D&&(0,s.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 text-sm",children:[(0,s.jsx)("span",{children:"Apply index to database"}),(0,s.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,s.jsx)(v.$,{disabled:o,loading:o,type:"primary",onClick:()=>L(),children:"Create index"})]})]})},eC=e=>{var t,n;let{queryPerformanceQuery:a}=e,l=(0,r.useRouter)(),d=(0,i.useRef)(null),{preset:c,sort:u,order:m,roles:p,search:h}=(0,o.g)(),{isLoading:f,data:y}=a,g=l.query.sort?{column:l.query.sort,order:l.query.order}:void 0,[_,j]=(0,i.useState)("details"),[b,S]=(0,i.useState)(g),[w,q]=(0,i.useState)(),A=null!=c?c:F.MOST_TIME_CONSUMING,I=M[A].map(e=>{var t;return{key:e.id,name:e.name,resizable:!0,minWidth:null!=(t=e.minWidth)?t:120,headerCellClass:"first:pl-6 cursor-pointer",renderHeaderCell:()=>(0,s.jsxs)("div",{className:"flex items-center justify-between font-mono font-normal text-xs w-full",onClick:()=>k(e.id),children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("p",{className:"!text-foreground",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-foreground-lighter",children:e.description})]}),(null==b?void 0:b.column)===e.id&&(0,s.jsx)(s.Fragment,{children:"desc"===b.order?(0,s.jsx)(B.A,{size:14}):(0,s.jsx)(U.A,{size:14})})]}),renderCell:t=>{var n;let r=null==(n=t.row)?void 0:n[e.id];if("query"===e.id)return(0,s.jsxs)("div",{className:"w-full flex items-center gap-x-2",children:[x(t.row.index_advisor_result,!0)&&(0,s.jsx)(ex,{indexAdvisorResult:t.row.index_advisor_result,onClickIcon:()=>{var e;q(t.rowIdx),j("suggestion"),null==(e=d.current)||e.scrollToCell({idx:0,rowIdx:t.rowIdx})}}),(0,s.jsx)("div",{className:"font-mono text-xs",children:r})]});let a=e.name.includes("time"),o=r?a?"".concat(r.toFixed(0),"ms"):r.toLocaleString():"";return(0,s.jsxs)("div",{className:(0,C.cn)("w-full flex flex-col justify-center font-mono text-xs","number"==typeof r?"text-right":""),children:[(0,s.jsx)("p",{children:o}),a&&(0,s.jsxs)("p",{className:"text-foreground-lighter",children:[(r/1e3).toFixed(2),"s"]})]})}}}),E=null!=y?y:[],T=void 0!==w?null==(t=E[w])?void 0:t.query:void 0,P=(null!=T?T:"").trim().toLowerCase(),O=(P.startsWith("select")||P.startsWith("with pgrst_source")||P.startsWith("with pgrst_payload"))&&x(null==(n=E[w])?void 0:n.index_advisor_result,!0),k=e=>{let t;if(S(t=(null==b?void 0:b.column)===e?"desc"===b.order?{column:e,order:"asc"}:void 0:{column:e,order:"desc"}),void 0===t){let{sort:e,order:t,...n}=l.query;l.push({...l,query:n})}else l.push({...l,query:{...l.query,sort:t.column,order:t.order}})};return(0,i.useEffect)(()=>{q(void 0)},[c,h,p,u,m]),(0,s.jsxs)(ee.HK,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,s.jsx)(ee.wV,{defaultSize:1,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:(0,s.jsx)(J.Ay,{ref:d,style:{height:"100%"},className:(0,C.cn)("flex-1 flex-grow h-full"),rowHeight:44,headerRowHeight:36,columns:I,rows:E,rowClass:(e,t)=>{let n=t===w;return["".concat(n?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"".concat(n?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:border-l-foreground":""),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},renderers:{renderRow:(e,t)=>(0,i.createElement)(J.fI,{...t,key:"qp-row-".concat(t.rowIdx),onClick:()=>{if("number"==typeof e&&e>=0){var t,n,s;q(e),null==(t=d.current)||t.scrollToCell({idx:0,rowIdx:e}),(null!=(s=null==(n=E[e])?void 0:n.query)?s:"").trim().toLowerCase().startsWith("select")||j("details")}}}),noRowsFallback:f?(0,s.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,s.jsx)(Q.y,{})}):(0,s.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,s.jsx)(Z.A,{className:"text-foreground-muted",strokeWidth:1}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-foreground",children:"No queries detected"}),(0,s.jsx)("p",{className:"text-foreground-light",children:"There are no actively running queries that match the criteria"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx"})}),void 0!==w&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ee.WM,{withHandle:!0}),(0,s.jsxs)(ee.wV,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t",children:[(0,s.jsx)(v.$,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,s.jsx)(N.A,{}),onClick:()=>q(void 0)}),(0,s.jsxs)(R.tU,{value:_,className:"flex flex-col h-full",onValueChange:e=>j(e),children:[(0,s.jsxs)(R.j7,{className:"px-5 flex gap-x-4 min-h-[46px]",children:[(0,s.jsx)(R.Xi,{value:"details",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none",children:"Query details"}),O&&(0,s.jsx)(R.Xi,{value:"suggestion",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Indexes"})]}),(0,s.jsx)(R.av,{value:"details",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,s.jsx)(ef,{reportType:A,selectedRow:E[w],onClickViewSuggestion:()=>j("suggestion")})}),(0,s.jsx)(R.av,{value:"suggestion",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,s.jsx)(eR,{selectedRow:E[w]})})]})]})]})]})},eP=e=>{var t;let{queryHitRate:n,queryPerformanceQuery:r}=e,{ref:c}=(0,o.g)(),{project:u}=(0,p.Om)(),m=(0,T.RE)(),[{preset:x},h]=(0,a.ab)({sort:a.tU,search:a.tU,order:a.tU,preset:a.tU.withDefault(F.MOST_TIME_CONSUMING)}),{isLoading:f,isRefetching:y}=r,g=m.selectedDatabaseId===c,j=(0,A.s)(null!=(t=m.selectedDatabaseId)?t:""),[b,S]=(0,i.useState)(!1),[L,M]=(0,I.U)(o.rS.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),B=()=>{r.runQuery(),n.runQuery()},{data:U}=(0,q.Vh)({projectRef:c}),{data:W,isLoading:H}=(0,D.a)({preset:"mostTimeConsuming"}),{data:z,isLoading:$}=(0,D.a)({preset:"mostFrequentlyInvoked"}),{data:Y,isLoading:G}=(0,D.a)({preset:"slowestExecutionTime"}),V=(0,i.useMemo)(()=>[{id:F.MOST_TIME_CONSUMING,label:"Most time consuming",description:"Lists queries ordered by their cumulative total execution time.",isLoading:H,max:(null!=W?W:[]).length>0?Math.max(...(null!=W?W:[]).map(e=>e.total_time)).toFixed(2):void 0},{id:F.MOST_FREQUENT,label:"Most frequent",description:"Lists queries in order of their execution count",isLoading:$,max:(null!=z?z:[]).length>0?Math.max(...(null!=z?z:[]).map(e=>e.calls)).toFixed(2):void 0},{id:F.SLOWEST_EXECUTION,label:"Slowest execution",description:"Lists queries ordered by their maximum execution time",isLoading:G,max:(null!=Y?Y:[]).length>0?Math.max(...(null!=Y?Y:[]).map(e=>e.max_time)).toFixed(2):void 0}],[$,G,H,z,W,Y]);return(0,i.useEffect)(()=>{m.setSelectedDatabaseId(c)},[c]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.tU,{value:x,defaultValue:x,onValueChange:e=>h({preset:e}),"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:(0,s.jsx)(R.j7,{className:(0,C.cn)("flex gap-0 border-0 items-end z-10"),"data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:V.map(e=>{let t=Number(e.max),n=e.id!==F.MOST_FREQUENT?t>1e3?(t/1e3).toFixed(2):t.toFixed(0):t.toLocaleString();return(0,s.jsxs)(R.Xi,{value:e.id,className:(0,C.cn)("group relative","px-6 py-3 border-b-0 flex flex-col items-start !shadow-none border-default border-t","even:border-x last:border-r even:!border-x-strong last:!border-r-strong",e.id===x?"!bg-surface-200":"!bg-surface-200/[33%]","hover:!bg-surface-100","data-[state=active]:!bg-surface-200","hover:text-foreground-light","transition"),children:[e.id===x&&(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-foreground"}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("span",{className:"",children:e.label}),(0,s.jsxs)(_.m_,{children:[(0,s.jsx)(_.k$,{asChild:!0,children:(0,s.jsx)(w.A,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,s.jsx)(_.ZI,{side:"top",children:e.description})]})]}),e.isLoading?(0,s.jsx)(Q.A,{className:"w-32 pt-1"}):void 0===e.max?(0,s.jsx)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:"No data yet"}):(0,s.jsxs)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:[n,e.id!==F.MOST_FREQUENT?t>1e3?"s":"ms":" calls"]}),e.id===x&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[1px] bg-surface-200"})]},e.id)})})}),(0,s.jsx)(X,{queryPerformanceQuery:r,onResetReportClick:()=>S(!0),"data-sentry-element":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformance.tsx"}),(0,s.jsx)(P.$,{loading:f||y,"data-sentry-element":"LoadingLine","data-sentry-source-file":"QueryPerformance.tsx"}),(0,s.jsx)(eC,{queryPerformanceQuery:r,"data-sentry-element":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformance.tsx"}),(0,s.jsxs)("div",{className:(0,C.cn)("px-6 py-6 flex gap-x-4 border-t relative",{hidden:!1===L}),children:[(0,s.jsx)(v.$,{className:"absolute top-1.5 right-3 px-1.5",type:"text",size:"tiny",onClick:()=>M(!1),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:(0,s.jsx)(N.A,{size:"14","data-sentry-element":"X","data-sentry-source-file":"QueryPerformance.tsx"})}),(0,s.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,s.jsx)("p",{children:"Reset report"}),(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"Consider resetting the analysis after optimizing any queries"}),(0,s.jsx)(v.$,{type:"default",className:"!mt-3 w-min",onClick:()=>S(!0),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:"Reset report"})]}),(0,s.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,s.jsx)("p",{children:"How is this report generated?"}),(0,s.jsx)(k.o,{className:"text-xs",content:"This report uses the pg_stat_statements table, and pg_stat_statements extension. [Learn more here](https://supabase.com/docs/guides/platform/performance#examining-query-performance).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]}),(0,s.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,s.jsx)("p",{children:"Inspect your database for potential issues"}),(0,s.jsx)(k.o,{className:"text-xs",content:"The Supabase CLI comes with a range of tools to help inspect your Postgres instances for potential issues. [Learn more here](https://supabase.com/docs/guides/database/inspect).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]})]}),(0,s.jsx)(O.A,{visible:b,size:"medium",variant:"destructive",title:"Reset query performance analysis",confirmLabel:"Reset report",confirmLabelLoading:"Resetting report",onCancel:()=>S(!1),onConfirm:async()=>{var e;let t=null==U||null==(e=U.find(e=>e.identifier===m.selectedDatabaseId))?void 0:e.connectionString;if(E.pe&&!t)return l.oR.error("Unable to run query: Connection string is missing");try{await (0,d.E)({projectRef:null==u?void 0:u.ref,connectionString:t,sql:"SELECT pg_stat_statements_reset();"}),B(),S(!1)}catch(e){l.oR.error("Failed to reset analysis: ".concat(e.message))}},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"QueryPerformance.tsx",children:(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["This will reset the pg_stat_statements table in the extensions schema on your"," ",(0,s.jsx)("span",{className:"text-foreground",children:g?"primary database":"read replica (ID: ".concat(j,")")}),", which is used to calculate query performance. This data will repopulate immediately after."]})})]})};var eO=n(45467),eQ=n(96971),ek=n(86654),eD=n(62964),eF=n(4649),eL=n(6404),eM=n(92633);let eB=()=>{var e,t;let n=(0,r.useRouter)(),{ref:i}=(0,o.g)(),{isIndexAdvisorEnabled:l}=f(),[{preset:d,search:c,order:u,sort:m}]=(0,a.ab)({sort:a.tU,search:a.tU.withDefault(""),order:a.tU,preset:a.tU.withDefault(F.MOST_TIME_CONSUMING)}),x=eO.NY[eQ.N.QUERY_PERFORMANCE],p=(0,ek.B)(x.queries,null!=i?i:"default").queryHitRate(),h=L[d],y=null!=(t=null==n||null==(e=n.query)?void 0:e.roles)?t:[],g=(0,D.a)({searchQuery:c,orderBy:m?{column:m,order:u}:void 0,preset:h,roles:"string"==typeof y?[y]:y,runIndexAdvisor:l});return(0,s.jsxs)("div",{className:"h-full flex flex-col","data-sentry-component":"QueryPerformanceReport","data-sentry-source-file":"query-performance.tsx",children:[(0,s.jsx)(eM.M,{className:"py-4 px-6 !mb-0",title:"Query Performance",actions:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S,{}),(0,s.jsx)(eE.A,{href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance"}),(0,s.jsx)(eL.A,{})]}),"data-sentry-element":"FormHeader","data-sentry-source-file":"query-performance.tsx"}),(0,s.jsx)(eP,{queryHitRate:p,queryPerformanceQuery:g,"data-sentry-element":"QueryPerformance","data-sentry-source-file":"query-performance.tsx"})]})};eB.getLayout=e=>(0,s.jsx)(eF.A,{children:(0,s.jsx)(eD.A,{title:"Query performance",children:e})});let eU=eB},43033:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var s=n(56947),r=n(45467),a=n(9895),o=n(76195),i=n(18232),l=n(37785);let d=e=>{var t;let{sql:n,params:d=r.EV,where:c,orderBy:u}=e,{project:m}=(0,a.Om)(),x=(0,l.RE)(),{data:p}=(0,o.Vh)({projectRef:null==m?void 0:m.ref}),h=null==(t=(p||[]).find(e=>e.identifier===x.selectedDatabaseId))?void 0:t.connectionString,f=x.selectedDatabaseId,y="function"==typeof n?n([]):n,{data:g,error:_,isLoading:v,isRefetching:j,refetch:b}=(0,s.I)(["projects",null==m?void 0:m.ref,"db",{...d,sql:y,identifier:f},c,u],e=>{let{signal:t}=e;return(0,i.E)({projectRef:null==m?void 0:m.ref,connectionString:h||(null==m?void 0:m.connectionString),sql:y},t).then(e=>e.result)},{enabled:!!y,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return{error:_||("object"==typeof g?null==g?void 0:g.error:""),data:g,isLoading:v,isRefetching:j,params:d,runQuery:b,resolvedSql:y}}},45467:(e,t,n)=>{"use strict";n.d(t,{EV:()=>d,NY:()=>u,cO:()=>o,ig:()=>m,s3:()=>i,xm:()=>l});var s=n(53434),r=n.n(s),a=n(96971);let o=2;var i=function(e){return e.LAST_10_MINUTES="Last 10 minutes",e.LAST_30_MINUTES="Last 30 minutes",e.LAST_60_MINUTES="Last 60 minutes",e.LAST_3_HOURS="Last 3 hours",e.LAST_24_HOURS="Last 24 hours",e.LAST_7_DAYS="Last 7 days",e.LAST_14_DAYS="Last 14 days",e.LAST_28_DAYS="Last 28 days",e}({});let l=[{text:"Last 10 minutes",calcFrom:()=>r()().subtract(10,"minute").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["free","pro","team","enterprise"]},{text:"Last 30 minutes",calcFrom:()=>r()().subtract(30,"minute").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["free","pro","team","enterprise"]},{text:"Last 60 minutes",calcFrom:()=>r()().subtract(1,"hour").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),default:!0,availableIn:["free","pro","team","enterprise"]},{text:"Last 3 hours",calcFrom:()=>r()().subtract(3,"hour").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["free","pro","team","enterprise"]},{text:"Last 24 hours",calcFrom:()=>r()().subtract(1,"day").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["free","pro","team","enterprise"]},{text:"Last 7 days",calcFrom:()=>r()().subtract(7,"day").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["pro","team","enterprise"]},{text:"Last 14 days",calcFrom:()=>r()().subtract(14,"day").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["team","enterprise"]},{text:"Last 28 days",calcFrom:()=>r()().subtract(28,"day").startOf("day").toISOString(),calcTo:()=>r()().toISOString(),availableIn:["team","enterprise"]}],d={iso_timestamp_start:l[0].calcFrom(),iso_timestamp_end:l[0].calcTo()},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(0===e.length)return"";let n=e.map(e=>{let t=e.key.split("."),n=[t[t.length-2],t[t.length-1]].join("."),s=e.key.includes(".")?n:e.key;switch(e.compare){case"matches":return"REGEXP_CONTAINS(".concat(s,", '").concat(e.value,"')");case"is":default:return"".concat(s," = ").concat(e.value);case"!=":return"".concat(s," != ").concat(e.value);case">=":return"".concat(s," >= ").concat(e.value);case"<=":return"".concat(s," <= ").concat(e.value);case">":return"".concat(s," > ").concat(e.value);case"<":return"".concat(s," < ").concat(e.value)}}).filter(Boolean).join(" AND ");return""===n?"":t?"WHERE "+n:"AND "+n},u={[a.N.API]:{title:"API",queries:{totalRequests:{queryType:"logs",sql:e=>"\n        -- reports-api-total-requests\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC")},topRoutes:{queryType:"logs",sql:e=>"\n        -- reports-api-top-routes\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},errorCounts:{queryType:"logs",sql:e=>"\n        -- reports-api-error-counts\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        WHERE\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")},topErrorRoutes:{queryType:"logs",sql:e=>"\n        -- reports-api-top-error-routes\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        where\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},responseSpeed:{queryType:"logs",sql:e=>"\n        -- reports-api-response-speed\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          avg(response.origin_time) as avg\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n      ")},topSlowRoutes:{queryType:"logs",sql:e=>"\n        -- reports-api-top-slow-routes\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count,\n          avg(response.origin_time) as avg\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          avg desc\n        limit 10\n        ")},networkTraffic:{queryType:"logs",sql:e=>'\n        -- reports-api-network-traffic\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as ingress_mb,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(resp_headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as egress_mb,\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          cross join unnest(response.headers) as resp_headers\n          '.concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")}}},[a.N.AUTH]:{title:"",queries:{}},[a.N.STORAGE]:{title:"Storage",queries:{cacheHitRate:{queryType:"logs",sql:e=>"\n        -- reports-storage-cache-hit-rate\nSELECT\n  timestamp_trunc(timestamp, hour) as timestamp,\n  countif( h.cf_cache_status in ('HIT', 'STALE', 'REVALIDATED', 'UPDATING') ) as hit_count,\n  countif( h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC') ) as miss_count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') and r.method = 'GET'\n  ".concat(c(e,!1),"\ngroup by timestamp\norder by timestamp desc\n")},topCacheMisses:{queryType:"logs",sql:e=>"\n        -- reports-storage-top-cache-misses\nSELECT\n  r.path as path,\n  r.search as search,\n  count(id) as count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object')\n  and r.method = 'GET'\n  and h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC')\n  ".concat(c(e,!1),"\ngroup by path, search\norder by count desc\nlimit 12\n    ")}}},[a.N.QUERY_PERFORMANCE]:{title:"Query performance",queries:{mostFrequentlyInvoked:{queryType:"db",sql:function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return"\n        -- reports-query-performance-most-frequently-invoked\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows".concat(s?",\n    case\n      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')\n      then (\n        select json_build_object(\n          'has_suggestion', array_length(index_statements, 1) > 0,\n          'startup_cost_before', startup_cost_before,\n          'startup_cost_after', startup_cost_after,\n          'total_cost_before', total_cost_before,\n          'total_cost_after', total_cost_after,\n          'index_statements', index_statements\n        )\n        from index_advisor(statements.query)\n      )\n      else null\n    end as index_advisor_result":"","\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ").concat(t||"","\n  ").concat(n||"order by statements.calls desc","\n  limit 20")}},mostTimeConsuming:{queryType:"db",sql:function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return"\n        -- reports-query-performance-most-time-consuming\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100, 'FM90D0') || '%'  AS prop_total_time".concat(s?",\n    case\n      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')\n      then (\n        select json_build_object(\n          'has_suggestion', array_length(index_statements, 1) > 0,\n          'startup_cost_before', startup_cost_before,\n          'startup_cost_after', startup_cost_after,\n          'total_cost_before', total_cost_before,\n          'total_cost_after', total_cost_after,\n          'index_statements', index_statements\n        )\n        from index_advisor(statements.query)\n      )\n      else null\n    end as index_advisor_result":"","\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ").concat(t||"","\n  ").concat(n||"order by total_time desc","\n  limit 20")}},slowestExecutionTime:{queryType:"db",sql:function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return"\n        -- reports-query-performance-slowest-execution-time\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows".concat(s?",\n    case\n      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')\n      then (\n        select json_build_object(\n          'has_suggestion', array_length(index_statements, 1) > 0,\n          'startup_cost_before', startup_cost_before,\n          'startup_cost_after', startup_cost_after,\n          'total_cost_before', total_cost_before,\n          'total_cost_after', total_cost_after,\n          'index_statements', index_statements\n        )\n        from index_advisor(statements.query)\n      )\n      else null\n    end as index_advisor_result":"","\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ").concat(t||"","\n  ").concat(n||"order by max_time desc","\n  limit 20")}},queryHitRate:{queryType:"db",sql:e=>"-- reports-query-performance-cache-and-index-hit-rate\nselect\n    'index hit rate' as name,\n    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio\n  from pg_statio_user_indexes\n  union all\n  select\n    'table hit rate' as name,\n    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio\n  from pg_statio_user_tables;"}}},[a.N.DATABASE]:{title:"database",queries:{largeObjects:{queryType:"db",sql:e=>"-- reports-database-large-objects\nSELECT\n        SCHEMA_NAME,\n        relname,\n        table_size\n      FROM\n        (SELECT\n          pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,\n          relname,\n          pg_total_relation_size(pg_catalog.pg_class.oid) AS table_size\n        FROM pg_catalog.pg_class\n        JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid\n        ) t\n      WHERE SCHEMA_NAME NOT LIKE 'pg_%'\n      ORDER BY table_size DESC\n      LIMIT 5;"}}}},m=["total_realtime_ingress","total_rest_options_requests","total_auth_ingress","total_auth_get_requests","total_auth_post_requests","total_auth_patch_requests","total_auth_options_requests","total_storage_options_requests","total_storage_patch_requests","total_options_requests"]},50614:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/advisors/query-performance",function(){return n(26261)}])},69751:(e,t,n)=>{"use strict";n.d(t,{UC:()=>z,Y9:()=>W,bL:()=>B,l9:()=>H,q7:()=>U});var s=n(54993),r=n(53239),a=n(68436),o=n(86829),i=n(63774),l=n(91968),d=n(87990),c=n(70297),u=n(90709),m=n(77306),x=n(37268);let p="Accordion",h=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[f,y,g]=(0,o.N)(p),[_,v]=(0,a.A)(p,[g,u.z3]),j=(0,u.z3)(),b=r.forwardRef((e,t)=>{let{type:n,...a}=e;return r.createElement(f.Provider,{scope:e.__scopeAccordion},"multiple"===n?r.createElement(I,(0,s.A)({},a,{ref:t})):r.createElement(A,(0,s.A)({},a,{ref:t})))});b.propTypes={type(e){let t=e.value||e.defaultValue;return e.type&&!["single","multiple"].includes(e.type)?Error("Invalid prop `type` supplied to `Accordion`. Expected one of `single | multiple`."):"multiple"===e.type&&"string"==typeof t?Error("Invalid prop `type` supplied to `Accordion`. Expected `single` when `defaultValue` or `value` is type `string`."):"single"===e.type&&Array.isArray(t)?Error("Invalid prop `type` supplied to `Accordion`. Expected `multiple` when `defaultValue` or `value` is type `string[]`."):null}};let[S,w]=_(p),[N,q]=_(p,{collapsible:!1}),A=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},collapsible:i=!1,...l}=e,[c,u]=(0,d.i)({prop:n,defaultProp:a,onChange:o});return r.createElement(S,{scope:e.__scopeAccordion,value:c?[c]:[],onItemOpen:u,onItemClose:r.useCallback(()=>i&&u(""),[i,u])},r.createElement(N,{scope:e.__scopeAccordion,collapsible:i},r.createElement(R,(0,s.A)({},l,{ref:t}))))}),I=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},...i}=e,[l=[],c]=(0,d.i)({prop:n,defaultProp:a,onChange:o}),u=r.useCallback(e=>c((t=[])=>[...t,e]),[c]),m=r.useCallback(e=>c((t=[])=>t.filter(t=>t!==e)),[c]);return r.createElement(S,{scope:e.__scopeAccordion,value:l,onItemOpen:u,onItemClose:m},r.createElement(N,{scope:e.__scopeAccordion,collapsible:!0},r.createElement(R,(0,s.A)({},i,{ref:t}))))}),[E,T]=_(p),R=r.forwardRef((e,t)=>{let{__scopeAccordion:n,disabled:a,dir:o,orientation:d="vertical",...u}=e,m=r.useRef(null),p=(0,i.s)(m,t),g=y(n),_="ltr"===(0,x.jH)(o),v=(0,l.m)(e.onKeyDown,e=>{var t;if(!h.includes(e.key))return;let n=e.target,s=g().filter(e=>{var t;return!(null!=(t=e.ref.current)&&t.disabled)}),r=s.findIndex(e=>e.ref.current===n),a=s.length;if(-1===r)return;e.preventDefault();let o=r,i=a-1,l=()=>{(o=r+1)>i&&(o=0)},c=()=>{(o=r-1)<0&&(o=i)};switch(e.key){case"Home":o=0;break;case"End":o=i;break;case"ArrowRight":"horizontal"===d&&(_?l():c());break;case"ArrowDown":"vertical"===d&&l();break;case"ArrowLeft":"horizontal"===d&&(_?c():l());break;case"ArrowUp":"vertical"===d&&c()}null==(t=s[o%a].ref.current)||t.focus()});return r.createElement(E,{scope:n,disabled:a,direction:o,orientation:d},r.createElement(f.Slot,{scope:n},r.createElement(c.sG.div,(0,s.A)({},u,{"data-orientation":d,ref:p,onKeyDown:a?void 0:v}))))}),C="AccordionItem",[P,O]=_(C),Q=r.forwardRef((e,t)=>{let{__scopeAccordion:n,value:a,...o}=e,i=T(C,n),l=w(C,n),d=j(n),c=(0,m.B)(),x=a&&l.value.includes(a)||!1,p=i.disabled||e.disabled;return r.createElement(P,{scope:n,open:x,disabled:p,triggerId:c},r.createElement(u.bL,(0,s.A)({"data-orientation":i.orientation,"data-state":M(x)},d,o,{ref:t,disabled:p,open:x,onOpenChange:e=>{e?l.onItemOpen(a):l.onItemClose(a)}})))}),k=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=T(p,n),i=O("AccordionHeader",n);return r.createElement(c.sG.h3,(0,s.A)({"data-orientation":o.orientation,"data-state":M(i.open),"data-disabled":i.disabled?"":void 0},a,{ref:t}))}),D="AccordionTrigger",F=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=T(p,n),i=O(D,n),l=q(D,n),d=j(n);return r.createElement(f.ItemSlot,{scope:n},r.createElement(u.l9,(0,s.A)({"aria-disabled":i.open&&!l.collapsible||void 0,"data-orientation":o.orientation,id:i.triggerId},d,a,{ref:t})))}),L=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=T(p,n),i=O("AccordionContent",n),l=j(n);return r.createElement(u.UC,(0,s.A)({role:"region","aria-labelledby":i.triggerId,"data-orientation":o.orientation},l,a,{ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}}))});function M(e){return e?"open":"closed"}let B=b,U=Q,W=k,H=F,z=L},86654:(e,t,n)=>{"use strict";n.d(t,{B:()=>o,p:()=>a});var s=n(43033),r=n(7188);let a=e=>Object.fromEntries(new URLSearchParams(e)),o=(e,t)=>Object.entries(e).reduce((e,n)=>{let[a,{sql:o,queryType:i}]=n;return"db"===i?{...e,[a]:()=>(0,s.A)({sql:o})}:{...e,[a]:()=>(0,r.A)(t)}},{})},92037:(e,t,n)=>{"use strict";n.d(t,{$m:()=>c,As:()=>d,nD:()=>l,ub:()=>u});var s=n(80263),r=n(69751),a=n(47330),o=n(53239),i=n(82457);let l=r.bL,d=o.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.q7,{ref:t,className:(0,i.cn)("border-b",n),...a})});d.displayName="AccordionItem";let c=o.forwardRef((e,t)=>{let{className:n,children:o,hideIcon:l,...d}=e;return(0,s.jsx)(r.Y9,{className:"flex",children:(0,s.jsxs)(r.l9,{ref:t,className:(0,i.cn)("flex flex-1 gap-2 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180 text-left",n),...d,children:[o,!l&&(0,s.jsx)(a.A,{className:"h-4 w-4 transition-transform duration-200 shrink-0"})]})})});c.displayName=r.l9.displayName;let u=o.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,s.jsx)(r.UC,{ref:t,className:(0,i.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",n),...o,children:(0,s.jsx)("div",{className:"pb-4 pt-0",children:a})})});u.displayName=r.UC.displayName},94326:(e,t,n)=>{"use strict";n.d(t,{z:()=>d});var s=n(56947),r=n(48678),a=n(46291),o=n(97008),i=n(32211);async function l(e,t,n){let{projectRef:s,connectionString:a}=e;if(!s)throw Error("projectRef is required");let o=new Headers(n);a&&o.set("x-connection-encrypted",a);let{data:i,error:l}=await (0,r.Jt)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:s}},headers:o,signal:t});return l&&(0,r.H4)(l),i}let d=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,o.KT)(),u=(null==c?void 0:c.status)===i.BU.ACTIVE_HEALTHY;return(0,s.I)(a.I.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:r&&void 0!==t&&u,...d})}},95134:(e,t,n)=>{"use strict";n.d(t,{E:()=>u});var s=n(17331),r=n(63295),a=n(32144),o=n(80251),i=n(73969),l=n(18232),d=n(46291);async function c(e){let{projectRef:t,connectionString:n,schema:a,name:o,version:i,cascade:d=!1,createSchema:c=!1}=e,u=new Headers;n&&u.set("x-connection-encrypted",n);let{sql:m}=s.A.extensions.create({schema:a,name:o,version:i,cascade:d}),{result:x}=await (0,l.E)({projectRef:t,connectionString:n,sql:c?"create schema if not exists ".concat((0,r.bD)(a),"; ").concat(m):m,queryKey:["extension","create"]});return x}let u=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,a.jE)();return(0,o.n)(e=>c(e),{async onSuccess(t,n,r){let{projectRef:a}=n;await s.invalidateQueries(d.I.list(a)),await (null==e?void 0:e(t,n,r))},async onError(e,n,s){void 0===t?i.oR.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},96971:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var s=function(e){return e.API="api",e.STORAGE="storage",e.AUTH="auth",e.QUERY_PERFORMANCE="query_performance",e.DATABASE="database",e}({})}},e=>{var t=t=>e(e.s=t);e.O(0,[89,8345,2491,3730,5982,6110,1185,5599,2041,1018,2409,4297,236,4515,1674,4942,2981,9480,4711,6137,4560,7795,3895,4109,2667,9846,2156,5500,4649,7104,3133,2865,3557,6593,636,8792],()=>t(50614)),_N_E=e.O()}]);