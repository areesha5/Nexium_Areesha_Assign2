!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8035d71b-6376-49fe-ae6e-140673ff1aa6",e._sentryDebugIdIdentifier="sentry-dbid-8035d71b-6376-49fe-ae6e-140673ff1aa6")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2156],{403:(e,t,n)=>{"use strict";n.d(t,{Co:()=>E,xd:()=>A});var a=n(80263),o=n(74557),r=n(77796),i=n.n(r),l=n(53239),s=n(56028),c=n(12532),d=n(25481),u=n(97008);let m={open:!1,initialInput:"",sqlSnippets:void 0,suggestions:void 0,tables:[],chats:{},activeChatId:void 0},p="assistantState";async function g(){return(0,o.P2)("ai-assistant-db",1,{upgrade(e){e.objectStoreNames.contains(p)||e.createObjectStore(p,{keyPath:"projectRef"})}})}async function f(e){if(e)try{let t=await g();return await t.get(p,e)}catch(e){console.error("Failed to get AI state from IndexedDB:",e);return}}async function h(e){if(e.projectRef)try{let t=await g();await t.put(p,e)}catch(e){console.error("Failed to save AI state to IndexedDB:",e)}}async function b(e){try{let t=await f(e);if(t)return Object.values(t.chats).forEach(e=>{e&&"object"==typeof e&&(e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt))}),t}catch(e){console.error("Error loading AI state from IndexedDB:",e)}return null}async function _(e){let t=localStorage.getItem(d.rS.AI_ASSISTANT_STATE(e));if(!t)return null;let n=null;try{let o=JSON.parse(t,(e,t)=>("createdAt"===e||"updatedAt"===e)&&t?new Date(t):t);if(o&&"object"==typeof o.chats){var a;n={projectRef:e,open:null!=(a=o.open)&&a,activeChatId:o.activeChatId,chats:o.chats}}else console.warn("Data in localStorage is not in the expected format, ignoring."),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}catch(t){console.error("Failed to parse state from localStorage:",t),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}if(n)try{return await h(n),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e)),n}catch(e){console.error("Failed to save migrated state to IndexedDB:",e)}return null}let v=()=>{let e={...m};{let t=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==t&&(e.open="true"===t)}let t=(0,s.BX)({...e,resetAiAssistantPanel:()=>{Object.assign(t,m)},openAssistant:()=>{t.open=!0},closeAssistant:()=>{t.open=!1},toggleAssistant:()=>{t.open=!t.open},get activeChat(){return t.activeChatId?t.chats[t.activeChatId]:void 0},newChat:e=>{var n,a,o,r,i,l;let s=crypto.randomUUID(),c={id:s,name:null!=(n=null==e?void 0:e.name)?n:"Untitled",messages:[],createdAt:new Date,updatedAt:new Date};return t.chats={...t.chats,[s]:c},t.activeChatId=s,t.open=null!=(a=null==e?void 0:e.open)?a:t.open,t.initialInput=null!=(o=null==e?void 0:e.initialInput)?o:m.initialInput,t.sqlSnippets=null!=(r=null==e?void 0:e.sqlSnippets)?r:m.sqlSnippets,t.suggestions=null!=(i=null==e?void 0:e.suggestions)?i:m.suggestions,t.tables=null!=(l=null==e?void 0:e.tables)?l:m.tables,s},selectChat:e=>{e!==t.activeChatId&&(t.activeChatId=e)},deleteChat:e=>{let{[e]:n,...a}=t.chats;if(t.chats=a,e===t.activeChatId){let e=Object.keys(a);t.activeChatId=e.length>0?e[0]:void 0}},renameChat:(e,n)=>{let a=t.chats[e];a&&a.name!==n&&(a.name=n,a.updatedAt=new Date)},clearMessages:()=>{let e=t.activeChat;e&&(e.messages=[],e.updatedAt=new Date,t.suggestions=void 0,t.sqlSnippets=[],t.initialInput="")},saveMessage:e=>{let n=t.activeChat;if(!n)return;let a=n.messages,o=Array.isArray(e)?e.filter(e=>!a.some(t=>t.id===e.id)):a.some(t=>t.id===e.id)?[]:[e];o.length>0&&(n.messages.push(...o),n.updatedAt=new Date)},updateMessage:e=>{let{id:n,resultId:a,results:o}=e,r=t.activeChat;if(!r||!a)return;let i=r.messages.findIndex(e=>e.id===n);if(-1!==i){let e=r.messages[i];e.results||(e.results={}),e.results[a]=o}},setSqlSnippets:e=>{t.sqlSnippets=e},clearSqlSnippets:()=>{t.sqlSnippets=void 0,t.suggestions=void 0},getCachedSQLResults:e=>{var n;let{messageId:a,snippetId:o}=e,r=t.activeChat;if(!r||!o)return;let i=r.messages.find(e=>e.id===a);return(null!=(n=null==i?void 0:i.results)?n:{})[o]},loadPersistedState:e=>{t.open=e.open,t.chats=e.chats,t.activeChatId=e.activeChatId;{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(t.open="true"===e)}if(!t.activeChat){let e=Object.keys(t.chats);e.length>0?t.activeChatId=e.sort((e,n)=>{var a,o;return((null==(a=t.chats[n].updatedAt)?void 0:a.getTime())||0)-((null==(o=t.chats[e].updatedAt)?void 0:o.getTime())||0)})[0]:t.newChat()}}});return t},y=(0,l.createContext)(v()),E=e=>{let{children:t}=e,n=(0,u.KT)(),[o]=(0,l.useState)(()=>v());return(0,l.useEffect)(()=>{let e=!0;return async function(){if(!(null==n?void 0:n.ref)){(null==n?void 0:n.ref)===void 0&&o.resetAiAssistantPanel();return}let t=null;if((t=await b(null==n?void 0:n.ref))||(t=await _(null==n?void 0:n.ref)),e){t&&o.loadPersistedState(t);{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(o.open="true"===e)}if(!o.activeChatId||!o.chats[o.activeChatId]){let e=Object.keys(o.chats);e.length>0?o.activeChatId=e.sort((e,t)=>{var n,a;return((null==(n=o.chats[t].updatedAt)?void 0:n.getTime())||0)-((null==(a=o.chats[e].updatedAt)?void 0:a.getTime())||0)})[0]:o.newChat()}}}(),()=>{e=!1}},[null==n?void 0:n.ref,o]),(0,l.useEffect)(()=>{if(null==n?void 0:n.ref){let e=i()(h,500),t=(0,s.B1)(o,()=>{let t=(0,s.P9)(o);e({projectRef:null==n?void 0:n.ref,open:t.open,activeChatId:t.activeChatId,chats:t.chats?Object.entries(t.chats).reduce((e,t)=>{var n;let[a,o]=t;return{...e,[a]:{...o,messages:(null==(n=o.messages)?void 0:n.slice(-20))||[]}}},{}):{}})});return()=>{e.cancel(),t()}}},[o,null==n?void 0:n.ref]),(0,a.jsx)(y.Provider,{value:o,"data-sentry-element":"unknown","data-sentry-component":"AiAssistantStateContextProvider","data-sentry-source-file":"ai-assistant-state.tsx",children:t})},A=e=>{let t=(0,l.useContext)(y);return(0,c.s)(t,e)}},1535:(e,t,n)=>{"use strict";n.d(t,{n:()=>a});let a={settings:e=>["projects",e,"settings"],settingsV2:e=>["projects",e,"settings-v2"],api:e=>["projects",e,"settings","api"],postgrest:e=>["projects",e,"postgrest"],jwtSecretUpdatingStatus:e=>["projects",e,"jwt-secret-updating-status"],storage:e=>["projects",e,"storage"],upgradeEligibility:e=>["projects",e,"upgrade-eligibility"],upgradeStatus:e=>["projects",e,"upgrade-status"],diskAttributes:e=>["projects",e,"disk-attributes"],diskBreakdown:e=>["projects",e,"disk-breakdown"],diskUtilization:e=>["projects",e,"disk-utilization"],projectCreationPostgresVersions:(e,t,n)=>["projects",e,t,n,"available-creation-versions"],projectUnpausePostgresVersions:e=>["projects",e,"available-unpause-versions"],diskAutoscaleConfig:e=>["projects",e,"disk-autoscale-config"]}},2647:(e,t,n)=>{"use strict";let a;n.d(t,{y:()=>et,$:()=>en});var o=n(80263),r=n(77341),i=n.n(r),l=n(62140),s=n.n(l),c=n(93896),d=n.n(c),u=n(48388),m=n.n(u),p=n(38280),g=n.n(p),f=n(14685),h=n.n(f),b=n(64676),_=n.n(b),v=n(74722),y=n.n(v),E=n(86727),A=n.n(E),w=n(53239),x=n(96426),T=n(73969),N=n(80896),S=n(56028),I=n(12532),R=n(82147),z=n(99715),j=n(25481),C=n(18971),D=n(11770),L=n(34745),O=n(26455),F=n(1535),k=n(41804),P=n(49081),M=n(48678);let U=async(e,t)=>{let{projectRef:n,bucketId:a,paths:o}=e;if(!a)throw Error("bucketId is required");let{data:r,error:i}=await (0,M.yH)("/platform/storage/{ref}/buckets/{id}/objects",{params:{path:{ref:n,id:a}},body:{paths:o},signal:t});return i&&(0,M.H4)(i),r};var B=n(31857);let q=async(e,t)=>{let{projectRef:n,bucketId:a,path:o,options:r}=e;if(!a)throw Error("bucketId is required");let{data:i,error:l}=await (0,M.bE)("/platform/storage/{ref}/buckets/{id}/objects/list",{params:{path:{ref:n,id:a}},body:{path:o,options:r},signal:t});return l&&(0,M.H4)(l),i},G=async e=>{let{projectRef:t,bucketId:n,from:a,to:o}=e;if(!n)throw Error("bucketId is required");let{data:r,error:i}=await (0,M.bE)("/platform/storage/{ref}/buckets/{id}/objects/move",{params:{path:{ref:t,id:n}},body:{from:a,to:o}});return i&&(0,M.H4)(i),r};var H=n(97008),Y=n(32211),W=n(35416);let $=Object.fromEntries(Object.entries(n(32505)).filter(e=>{let[,{extensions:t}]=e;return void 0!==t}).flatMap(e=>{let[t,{extensions:n}]=e;return n.map(e=>[e.toLowerCase(),t])}));var V=n(96040),J=n(62434),K=n(37263);let X={view:C.JB.COLUMNS,sortBy:C.NA.NAME,sortByOrder:C.ou.ASC};function Q(e){var t;let{projectRef:n,resumableUploadUrl:r,serviceKey:l,supabaseClient:c}=e,u=j.rS.STORAGE_PREFERENCE(n),{view:p,sortBy:f,sortByOrder:b}=(0,W.Bl)(null==(t=localStorage)?void 0:t.getItem(u))||X,v=(0,S.BX)({projectRef:n,supabaseClient:c,resumableUploadUrl:r,serviceKey:l,uploadProgresses:[],abortApiCalls:()=>{a&&(a.abort(),a=new AbortController)},abortUploadCallbacks:{},abortUploads:e=>{v.abortUploadCallbacks[e].forEach(e=>e()),v.abortUploadCallbacks[e]=[]},columns:[],popColumn:()=>{v.abortApiCalls(),v.columns=v.columns.slice(0,v.getLatestColumnIndex())},popColumnAtIndex:e=>{v.columns=v.columns.slice(0,e+1)},pushColumnAtIndex:(e,t)=>{v.columns=v.columns.slice(0,t+1).concat([e])},openedFolders:[],pushOpenedFolderAtIndex:(e,t)=>{v.openedFolders=v.openedFolders.slice(0,t).concat(e)},popOpenedFolders:()=>{v.openedFolders=v.openedFolders.slice(0,v.openedFolders.length-1)},popOpenedFoldersAtIndex:e=>{v.openedFolders=v.openedFolders.slice(0,e+1)},clearOpenedFolders:()=>{v.openedFolders=[]},selectedItems:[],setSelectedItems:e=>v.selectedItems=e,clearSelectedItems:e=>{void 0!==e?v.selectedItems=v.selectedItems.filter(t=>t.columnIndex!==e):v.selectedItems=[]},selectedItemsToDelete:[],setSelectedItemsToDelete:e=>{v.selectedItemsToDelete=e},selectedItemsToMove:[],setSelectedItemsToMove:e=>{v.selectedItemsToMove=e},selectedBucket:{},setSelectedBucket:e=>{v.selectedBucket=e,v.setSelectedFilePreview(void 0),v.clearOpenedFolders(),v.clearSelectedItems()},setSelectedItemToRename:e=>{v.updateRowStatus({name:e.name,status:C.U1.EDITING,columnIndex:e.columnIndex})},view:p,setView:e=>{v.view=e,v.updateExplorerPreference()},sortBy:f,setSortBy:async e=>{v.sortBy=e,v.updateExplorerPreference(),v.setSelectedFilePreview(void 0),await v.refetchAllOpenedFolders()},sortByOrder:b,setSortByOrder:async e=>{v.sortByOrder=e,v.updateExplorerPreference(),v.setSelectedFilePreview(void 0),await v.refetchAllOpenedFolders()},isSearching:!1,setIsSearching:e=>v.isSearching=e,selectedFilePreview:void 0,setSelectedFilePreview:e=>v.selectedFilePreview=e,selectedFileCustomExpiry:void 0,setSelectedFileCustomExpiry:e=>v.selectedFileCustomExpiry=e,updateExplorerPreference:()=>{let e=j.rS.STORAGE_PREFERENCE(n),{view:t,sortBy:a,sortByOrder:o}=v;localStorage.setItem(e,JSON.stringify({view:t,sortBy:a,sortByOrder:o}))},getLatestColumnIndex:()=>v.columns.length-1,setColumnIsLoadingMore:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];v.columns=v.columns.map((n,a)=>a===e?{...n,isLoadingMoreItems:t}:n)},openBucket:async e=>{let{id:t,name:n}=e;v.setSelectedBucket(e),await v.fetchFolderContents({bucketId:e.id,folderId:t,folderName:n,index:-1})},getPathAlongOpenedFolders:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e?v.openedFolders.length>0?"".concat(v.selectedBucket.name,"/").concat(v.openedFolders.map(e=>e.name).join("/")):v.selectedBucket.name:v.openedFolders.map(e=>e.name).join("/")},getPathAlongFoldersToIndex:e=>v.openedFolders.slice(0,e).map(e=>e.name).join("/"),addNewFolderPlaceholder:e=>{let t=C.Vl.FOLDER,n=-1===e?v.getLatestColumnIndex():e;v.addTempRow({type:t,name:"Untitled folder",status:C.U1.EDITING,columnIndex:n,metadata:null,isPrepend:!0})},addNewFolder:async(e,t)=>{if(!v.supabaseClient)return console.error("Supabase Client is missing");let n=v.sanitizeNameForDuplicateInColumn({name:e,autofix:!1,columnIndex:t});if(null===n)return;if(!/^[a-zA-Z0-9_-\s]*$/.test(n))return T.oR.error("Folder name contains invalid special characters");if(0===n.length)return v.removeTempRows(t);v.updateFolderAfterEdit({folderName:n,columnIndex:t});let a="".concat(n,"/").concat(D.ok),o=v.openedFolders.slice(0,t).map(e=>e.name).join("/"),r=o.length>0?"".concat(o,"/").concat(a):a;await v.supabaseClient.storage.from(v.selectedBucket.name).upload(r,new File([],D.ok)),o.length>0&&await U({projectRef:v.projectRef,bucketId:v.selectedBucket.id,paths:["".concat(o,"/").concat(D.ok)]})},fetchFolderContents:async e=>{let{bucketId:t,folderId:n,folderName:o,index:r,searchString:i}=e;v.abortApiCalls(),v.updateRowStatus({name:o,status:C.U1.LOADING,columnIndex:r}),v.pushColumnAtIndex({id:n,name:o,status:C.U1.LOADING,items:[]},r);let l=v.openedFolders.slice(0,r+1).map(e=>e.name).join("/"),s={limit:200,offset:0,search:i,sortBy:{column:v.sortBy,order:v.sortByOrder}};try{let e=await q({bucketId:t,projectRef:v.projectRef,path:l,options:s},null==a?void 0:a.signal);v.updateRowStatus({name:o,status:C.U1.READY,columnIndex:r});let i=(0,D.iN)(e,l);v.pushColumnAtIndex({id:n||o,name:o,status:C.U1.READY,items:i,hasMoreItems:200===i.length,isLoadingMoreItems:!1},r)}catch(e){"AbortError"===e.name?v.updateRowStatus({name:o,status:C.U1.READY,columnIndex:r}):T.oR.error('Failed to retrieve folder contents from "'.concat(o,'": ').concat(e.message))}},fetchMoreFolderContents:async e=>{let{index:t,column:n,searchString:o=""}=e;v.setColumnIsLoadingMore(t);let r=v.openedFolders.map(e=>e.name).join("/"),i={limit:200,offset:n.items.length,search:o,sortBy:{column:v.sortBy,order:v.sortByOrder}};try{let e=await q({projectRef:v.projectRef,bucketId:v.selectedBucket.id,path:r,options:i},null==a?void 0:a.signal),n=(0,D.iN)(e,r);v.columns=v.columns.map((a,o)=>o===t?{...a,items:a.items.concat(n),isLoadingMoreItems:!1,hasMoreItems:200===e.length}:a)}catch(e){e.message.includes("aborted")||T.oR.error("Failed to retrieve more folder contents: ".concat(e.message))}},refetchAllOpenedFolders:async()=>{let e=v.openedFolders.map(e=>e.name);await v.fetchFoldersByPath({paths:e})},fetchFoldersByPath:async e=>{let{paths:t,searchString:n="",showLoading:a=!1}=e;if(void 0===v.selectedBucket.id)return;let o=[""].concat(t);a&&(v.columns=[v.selectedBucket.name].concat(t).map(e=>({id:e,name:e,status:C.U1.LOADING,items:[]})));let r=(await Promise.all(o.map(async(e,a)=>{let o=t.slice(0,a).join("/"),r={limit:200,offset:0,search:n,sortBy:{column:v.sortBy,order:v.sortByOrder}};try{return await q({projectRef:v.projectRef,bucketId:v.selectedBucket.id,path:o,options:r})}catch(e){return T.oR.error("Failed to fetch folders: ".concat(e.message)),[]}}))).map((e,n)=>{let a=t.slice(0,n).join("/"),r=(0,D.iN)(e,a);return{id:null,status:C.U1.READY,name:0===n?v.selectedBucket.name:o[n],items:r,hasMoreItems:200===r.length,isLoadingMoreItems:!1}});v.columns=r,v.openedFolders=t.map((e,t)=>{let n=m()(r[t].items,{name:e});return n||{id:null,name:e,type:C.Vl.FOLDER,status:C.U1.READY,metadata:null,isCorrupted:!1,created_at:null,updated_at:null,last_accessed_at:null}})},validateParentFolderEmpty:async e=>{try{let n=await q({projectRef:v.projectRef,bucketId:v.selectedBucket.id,path:e,options:{limit:200,offset:0,sortBy:{column:v.sortBy,order:v.sortByOrder}}});if(0===n.length){var t;let n="".concat(e,"/").concat(D.ok);await (null==(t=v.supabaseClient)?void 0:t.storage.from(v.selectedBucket.name).upload(n,new File([],D.ok)))}}catch(e){}},deleteFolder:async e=>{try{let t=await v.getAllItemsAlongFolder(e);if(await v.deleteFiles({files:t,isDeleteFolder:!0}),v.popColumnAtIndex(e.columnIndex),v.popOpenedFoldersAtIndex(e.columnIndex-1),e.columnIndex>0){let t=v.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/");t.length>0&&await v.validateParentFolderEmpty(t)}await v.refetchAllOpenedFolders(),v.setSelectedItemsToDelete([]),T.oR.success("Successfully deleted ".concat(e.name))}catch(e){T.oR.error("Failed to delete folder: ".concat(e.message))}},renameFolder:async(e,t,n)=>{let a=e.name;if(a===t)return v.updateRowStatus({name:a,status:C.U1.READY,columnIndex:n});let r=(0,T.oR)((0,o.jsx)(V.t,{progress:0,message:"Renaming folder to ".concat(t)}),{closeButton:!1,position:"top-right"});try{if(t.includes("/")||t.includes("\\"))return T.oR.error("Folder name cannot contain forward or back slashes.");v.updateRowStatus({name:a,status:C.U1.LOADING,columnIndex:n,updatedName:t});let i=await v.getAllItemsAlongFolder(e),l=0,c=!1,d=i.map(e=>{let a="".concat(e.prefix,"/").concat(e.name),o=a.split("/"),r=o.slice(0,n).concat(t).concat(o.slice(n+1)).join("/");return()=>new Promise(async e=>{l+=1/i.length;try{await G({projectRef:v.projectRef,bucketId:v.selectedBucket.id,from:a,to:r})}catch(e){c=!0,T.oR.error("Failed to move ".concat(a," to the new folder"))}e()})}),u=s()(d,2);await u.reduce(async(e,n)=>{await e,await Promise.all(n.map(e=>e())),(0,T.oR)((0,o.jsx)(V.t,{progress:100*l,message:"Renaming folder to ".concat(t)}),{id:r,closeButton:!1,position:"top-right"})},Promise.resolve()),c?T.oR.error("Renamed folder to ".concat(t," with some errors"),{id:r,closeButton:!0,duration:J.j}):T.oR.success("Successfully renamed folder to ".concat(t),{id:r,closeButton:!0,duration:J.j}),v.openedFolders[n].name===e.name&&(v.setSelectedFilePreview(void 0),v.popOpenedFoldersAtIndex(n-1)),await v.refetchAllOpenedFolders()}catch(e){T.oR.error("Failed to rename folder to ".concat(t,": ").concat(e.message),{id:r,closeButton:!0,duration:J.j})}},updateFolderAfterEdit:e=>{let{folderName:t,columnIndex:n,status:a=C.U1.READY}=e,o=void 0!==n?n:v.getLatestColumnIndex(),r=v.columns.map((e,n)=>{if(n===o){let n=e.items.map(e=>{if(e.status===C.U1.EDITING){let n=new Date().toISOString();return{...e,status:a,name:t,createdAt:n,lastAccessedAt:n,updatedAt:n,metadata:null,id:null}}return e});return{...e,items:n}}return e});v.columns=r},downloadFolder:async e=>{let t=0,n=T.oR.loading("Retrieving files from folder...");try{var a;let r=await v.getAllItemsAlongFolder(e);(0,T.oR)((0,o.jsx)(V.t,{progress:0,message:"Downloading ".concat(r.length," file").concat(r.length>1?"s":"","...")}),{id:n,closeButton:!1,position:"top-right"});let i=r.map(e=>{var n,a;let o=null!=(a=null==(n=e.metadata)?void 0:n.mimetype)?a:null;return()=>new Promise(async n=>{try{let a=await (0,B.c)({projectRef:v.projectRef,bucketId:v.selectedBucket.id,path:"".concat(e.prefix,"/").concat(e.name)});t+=1/r.length;let i=await a.blob();n({name:e.name,prefix:e.prefix,blob:new Blob([i],{type:o})})}catch(t){console.error("Failed to download file","".concat(e.prefix,"/").concat(e.name)),n(!1)}})}),l=s()(i,10),c=await l.reduce(async(e,a)=>{let i=await e,l=await Promise.allSettled(a.map(e=>e()));return(0,T.oR)((0,o.jsx)(V.t,{progress:100*t,message:"Downloading ".concat(r.length," file").concat(r.length>1?"s":"","...")}),{id:n,closeButton:!1,position:"top-right"}),i.concat(l.map(e=>e.value).filter(Boolean))},Promise.resolve([])),d=new z.D7("application/zip"),u=new z.Vx(d,{bufferedWrite:!0});0===c.length&&T.oR.error('Failed to download files from "'.concat(e.name,'"'),{id:n,closeButton:!0,duration:J.j}),c.forEach(e=>{e.blob&&u.add("".concat(e.prefix,"/").concat(e.name),new z.nZ(e.blob))});let m=URL.createObjectURL(await u.close()),p=document.createElement("a");p.href=m,p.setAttribute("download","".concat(e.name,".zip")),document.body.appendChild(p),p.click(),null==(a=p.parentNode)||a.removeChild(p),T.oR.success(c.length===r.length?'Successfully downloaded folder "'.concat(e.name,'"'):'Downloaded folder "'.concat(e.name,'". However, ').concat(r.length-c.length," files did not download successfully."),{id:n,closeButton:!0,duration:J.j})}catch(e){T.oR.error("Failed to download folder: ".concat(e.message),{id:n,closeButton:!0,duration:J.j})}},getAllItemsAlongFolder:async e=>{var t,n;let a=[],o=!1,r="",{name:i,columnIndex:l,prefix:s}=e;if(void 0===s){let e=v.openedFolders.slice(0,l).map(e=>e.name).join("/");r=e.length>0?"".concat(e,"/").concat(i):i}else r="".concat(s,"/").concat(i);let c={limit:1e4,offset:0,sortBy:{column:v.sortBy,order:v.sortByOrder}},d=[];for(;;)try{let e=await q({projectRef:v.projectRef,bucketId:v.selectedBucket.id,path:r,options:c});if(d=d.concat(e),c.offset+=c.limit,(e||[]).length<c.limit)break}catch(e){o=!0;break}if(o)throw Error("Failed to retrieve all files within folder");let u=null!=(t=null==d?void 0:d.filter(e=>null===e.id))?t:[];return(null!=(n=null==d?void 0:d.filter(e=>null!==e.id))?n:[]).forEach(e=>a.push({...e,prefix:r})),(await Promise.all(u.map(e=>v.getAllItemsAlongFolder({...e,columnIndex:0,prefix:r})))).map(e=>{e.map(e=>a.push(e))}),a},uploadFiles:async e=>{var t,n,a,r;let{files:l,columnIndex:c,isDrop:d=!1}=e,u=null==(t=(0,P.S)().getQueryCache().find(F.n.storage(v.projectRef)))?void 0:t.state.data,m=null==u?void 0:u.fileSizeLimit,p=new Date,g=d?(await (0,D.Rd)(l)).filter(e=>!e.path.includes("#/")):Array.from(l),f=-1===c?v.getLatestColumnIndex():c,b=void 0!==m?g.filter(e=>e.size<=m):g;if(b.length<g.length){let e=g.length-b.length,{value:t,unit:n}=(0,L.Jb)(m);if(T.oR.error((0,o.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,o.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," beyond the global upload limit of"," ",t,n,"."]}),(0,o.jsxs)("p",{className:"text-foreground-light",children:["You can change the global file size upload limit in"," ",(0,o.jsx)(O.g,{href:"/project/".concat(v.projectRef,"/settings/storage"),children:"Storage settings"}),"."]})]}),{duration:8e3}),e===g.length)return}let _=b.filter(e=>e.size>0);if(_.length<b.length){let e=b.length-_.length;if(T.oR.error((0,o.jsx)("div",{className:"flex flex-col gap-y-1",children:(0,o.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," 0."]})})),e===b.length)return}let y=(null!=(r=null==(a=v.columns)||null==(n=a[f])?void 0:n.items)?r:[]).filter(e=>!e.id).map(e=>e.name),E=b.filter(e=>".DS_Store"!==e.name).map(e=>{if(!e.path)return e;let t=e.path.split("/"),n=t.length>1?t[0]:null;if(y.includes(n)){let a=v.sanitizeNameForDuplicateInColumn({name:n,autofix:!0,columnIndex:c});t[0]=a,e.path=t.join("/")}return e});v.uploadProgresses=Array(E.length).fill({percentage:0,elapsed:0,uploadSpeed:0,remainingBytes:0,remainingTime:0});let A=[],w=E.length,x=0,S=0,I=v.openedFolders.slice(0,f).map(e=>e.name).join("/"),R=v.onUploadProgress(),z=E.map((e,t)=>{var n,a,o;let r=e.name.split(".").pop(),l={mimetype:null!=(n=e.type||function(e){if(void 0!==e)return $[e.toLowerCase()]}(r))?n:"",size:e.size},s={cacheControl:"3600",contentType:l.mimetype},c=(null!=(a=null==e?void 0:e.path)?a:"").split("/").length>1,d=c?e.name:v.sanitizeNameForDuplicateInColumn({name:e.name,autofix:!0}),u=h()(e,["path"])&&c?e.path:d,m=(null!=u?u:"unknown").replaceAll(/\u{202F}/gu," "),p=I.length>0?"".concat(I,"/").concat(m):m;if(c){let t=(null==(o=e.path)?void 0:o.split("/")[0])||"";A.includes(t)||(v.addTempRow({type:C.Vl.FOLDER,name:t,status:C.U1.LOADING,columnIndex:f,metadata:l}),A.push(t))}else v.addTempRow({type:C.Vl.FILE,name:d,status:C.U1.LOADING,columnIndex:f,metadata:l});let g=0,b=v.selectedBucket.name;return()=>new Promise(async(n,a)=>{let o,r=e.size/1048576,c=Date.now();o=Math.min(o=r<30?6291456:r<100?Math.floor(e.size/8):r<500?Math.floor(e.size/10):r<1024?Math.floor(e.size/20):r<10240?Math.floor(e.size/30):Math.floor(e.size/50),524288e3);let d=e.size<=o,u=new N._O(e,{endpoint:v.resumableUploadUrl,retryDelays:[0,200,500,1500,3e3,5e3],headers:{authorization:"Bearer ".concat(v.serviceKey),"x-source":"supabase-dashboard"},uploadDataDuringCreation:d,removeFingerprintOnSuccess:!0,metadata:{bucketName:b,objectName:p,...s},chunkSize:o,onShouldRetry:e=>![400,403,404,409,413,415,429].includes(e.originalResponse?e.originalResponse.getStatus():0),onError:t=>{if(S+=1,t instanceof N.nj){var n,o,r;let a=null==(n=t.originalResponse)?void 0:n.getStatus();415===a?T.oR.error(i()((null==t||null==(o=t.originalResponse)?void 0:o.getBody())||"Failed to upload ".concat(e.name,": ").concat(l.mimetype," is not allowed")),{description:"Allowed MIME types: ".concat(null==(r=v.selectedBucket.allowed_mime_types)?void 0:r.join(", "))}):413===a&&T.oR.error("Failed to upload ".concat(e.name,": File size exceeds the bucket upload limit."))}else T.oR.error("Failed to upload ".concat(e.name,": ").concat(t.message));a(t)},onProgress:(e,n)=>{0===g&&e>o&&(g=e);let a=e-g,r=(Date.now()-c)/1e3,i=a/r,l=n-a;v.uploadProgresses[t]={percentage:0===n?0:e/n,elapsed:r,uploadSpeed:i,remainingBytes:l,remainingTime:l/i},v.onUploadProgress(R)},onSuccess(){x+=1,n()}});return Array.isArray(v.abortUploadCallbacks[R])||(v.abortUploadCallbacks[R]=[]),v.abortUploadCallbacks[R].push(()=>{try{u.abort(!0)}catch(e){}a(Error("Upload aborted by user"))}),u.findPreviousUploads().then(e=>{e.length&&u.resumeFromPreviousUpload(e[0]),u.start()})})}),j=s()(z,10);try{await j.reduce(async(e,t)=>{await e,await Promise.allSettled(t.map(e=>e())),v.onUploadProgress(R)},Promise.resolve()),x>0&&await U({projectRef:v.projectRef,bucketId:v.selectedBucket.id,paths:["".concat(I,"/").concat(D.ok)]}),await v.refetchAllOpenedFolders(),0===w||0===x&&0===S?T.oR.dismiss(R):S===w?T.oR.error("Failed to upload ".concat(w," file").concat(w>1?"s":"","!"),{id:R,closeButton:!0,duration:J.j}):x===w?T.oR.success("Successfully uploaded ".concat(w," file").concat(w>1?"s":"","!"),{id:R,closeButton:!0,duration:J.j}):T.oR.success("Successfully uploaded ".concat(x," out of ").concat(w," file").concat(w>1?"s":"","!"),{id:R,closeButton:!0,duration:J.j})}catch(e){T.oR.error("Failed to upload files",{id:R,closeButton:!0,duration:J.j})}let k=new Date;console.log("Total time taken for ".concat(E.length," files: ").concat((k-p)/1e3," seconds"))},moveFiles:async e=>{let t=d()(e.split("/")).join("/"),n=0;v.clearSelectedItems();let a=(0,T.oR)("Moving ".concat(v.selectedItemsToMove.length," file").concat(v.selectedItemsToMove.length>1?"s":"","..."),{description:"Do not close the browser until it's completed",duration:1/0});await Promise.all(v.selectedItemsToMove.map(async a=>{let o=v.openedFolders.slice(0,a.columnIndex).map(e=>e.name).join("/"),r=o.length>0?"".concat(o,"/").concat(a.name):a.name,i=e.length>0?"".concat(t,"/").concat(a.name):a.name;try{await G({projectRef:v.projectRef,bucketId:v.selectedBucket.id,from:r,to:i})}catch(e){n+=1,T.oR.error(e.message)}})),n===v.selectedItemsToMove.length?T.oR.error("Failed to move files"):(0,T.oR)("Successfully moved ".concat(v.selectedItemsToMove.length-n," files to ").concat(t.length>0?t:"the root of your bucket")),T.oR.dismiss(a),await v.refetchAllOpenedFolders(),v.setSelectedItemsToMove([])},deleteFiles:async e=>{let{files:t,isDeleteFolder:n=!1}=e;v.setSelectedFilePreview(void 0);let a=0,r=t.some(e=>e.prefix)?t.map(e=>"".concat(e.prefix,"/").concat(e.name)):t.map(e=>{let{name:t,columnIndex:n}=e,a=v.openedFolders.slice(0,n).map(e=>e.name).join("/");return v.updateRowStatus({name:t,status:C.U1.LOADING,columnIndex:n}),a.length>0?"".concat(a,"/").concat(t):t});v.clearSelectedItems();let i=(0,T.oR)((0,o.jsx)(V.t,{progress:0,message:"Deleting ".concat(r.length," file(s)...")}),{closeButton:!1,position:"top-right"}),l=s()(r,2).map(e=>()=>(a+=e.length/r.length,U({projectRef:v.projectRef,bucketId:v.selectedBucket.id,paths:e})));if(await s()(l,2).reduce(async(e,t)=>{await e,await Promise.all(t.map(e=>e())),(0,T.oR)((0,o.jsx)(V.t,{progress:100*a,message:"Deleting ".concat(r.length," file(s)...")}),{id:i,closeButton:!1,position:"top-right"})},Promise.resolve()),n)T.oR.dismiss(i);else{let e=y()(r.map(e=>{let t=e.split("/");return t.slice(0,t.length-1).join("/")}));await Promise.all(e.map(e=>v.validateParentFolderEmpty(e))),T.oR.success("Successfully deleted ".concat(r.length," file(s)"),{id:i,closeButton:!0,duration:J.j,description:void 0}),await v.refetchAllOpenedFolders(),v.setSelectedItemsToDelete([])}},downloadSelectedFiles:async e=>{var t;let n=Math.min(...e.map(e=>e.columnIndex)),a=e.map(e=>{let{name:t,columnIndex:a}=e,o=v.openedFolders.slice(n,a).map(e=>e.name).join("/"),r=o.length>0?"".concat(o,"/").concat(t):t;return{...e,formattedPathToFile:r}}),r=0,i=T.oR.loading("Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")),l=a.map(e=>()=>new Promise(async t=>{let n=await (0,D.PE)({projectRef:v.projectRef,bucketId:v.selectedBucket.id,file:e,returnBlob:!0});r+=1/a.length,_()(n)&&t({...n,name:e.formattedPathToFile}),t(!1)})),c=s()(l,10),d=await c.reduce(async(t,n)=>{let a=await t,l=await Promise.allSettled(n.map(e=>e()));return(0,T.oR)((0,o.jsx)(V.t,{progress:100*r,message:"Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")}),{id:i,closeButton:!1,position:"top-right"}),a.concat(l.map(e=>e.value).filter(Boolean))},Promise.resolve([])),u=new z.D7("application/zip"),m=new z.Vx(u,{bufferedWrite:!0});d.forEach(e=>{m.add(e.name,new z.nZ(e.blob))});let p=URL.createObjectURL(await m.close()),g=document.createElement("a");g.href=p,g.setAttribute("download","supabase-files.zip"),document.body.appendChild(g),g.click(),null==(t=g.parentNode)||t.removeChild(g),T.oR.success("Successfully downloaded ".concat(d.length," files"),{id:i,closeButton:!0,duration:J.j})},renameFile:async(e,t,n)=>{let a=e.name;if(a===t||0===t.length)v.updateRowStatus({name:a,status:C.U1.READY,columnIndex:n});else{v.updateRowStatus({name:a,status:C.U1.LOADING,columnIndex:n,updatedName:t});let r=v.getPathAlongFoldersToIndex(n),i=r.length>0?"".concat(r,"/").concat(a):a,l=r.length>0?"".concat(r,"/").concat(t):t;try{var o;if(await G({projectRef:v.projectRef,bucketId:v.selectedBucket.id,from:i,to:l}),T.oR.success('Successfully renamed "'.concat(a,'" to "').concat(t,'"')),(null==(o=v.selectedFilePreview)?void 0:o.name)===a){let{previewUrl:n,...a}=e;v.setSelectedFilePreview({...a,name:t})}await v.refetchAllOpenedFolders()}catch(e){T.oR.error("Failed to rename file: ".concat(e.message)),v.updateRowStatus({name:a,status:C.U1.READY,columnIndex:n})}}},selectRangeItems:(e,t)=>{let n=v.columns[e].items,a=n[t],o=v.selectedItems.map(e=>e.id),r=o[o.length-1],i=g()(n,{id:r}),l=Math.min(t,i),s=Math.max(t,i),c=n.slice(l,s+1).map(t=>({...t,columnIndex:e}));if(t<i&&c.reverse(),o.includes(a.id)){let e=c.map(e=>e.id);v.setSelectedItems(v.selectedItems.filter(t=>t.id===a.id||!e.includes(t.id)))}else v.setSelectedItems(A()(v.selectedItems.concat(c),"id"))},sanitizeNameForDuplicateInColumn:e=>{let{name:t,columnIndex:n,autofix:a=!1}=e,o=void 0!==n?n:v.getLatestColumnIndex(),r=v.columns[o].items.filter(e=>e.status!==C.U1.EDITING);if(r.filter(e=>e.name===t).length>0)if(!a)return T.oR.error("The name ".concat(t," already exists in the current directory. Please use a different name.")),null;else{let[e,n]=t.split("."),a=new RegExp("".concat(e," \\([-0-9]+\\)").concat(n?"."+n:"","$")),o=r.filter(e=>e.name.match(a)),i=e+" (".concat(o.length+1,")");return n?"".concat(i,".").concat(n):i}return t},addTempRow:e=>{let{type:t,name:n,status:a,columnIndex:o,metadata:r,isPrepend:i=!1}=e,l=v.columns.map((e,l)=>{if(l===o){let o={type:t,name:n,status:a,metadata:r},l=i?[o].concat(e.items):e.items.concat([o]);return{...e,items:l}}return e});v.columns=l},removeTempRows:e=>{let t=v.columns.map((t,n)=>{if(n===e){let e=t.items.filter(e=>h()(e,"id"));return{...t,items:e}}return t});v.columns=t},onUploadProgress:e=>{let t=v.uploadProgresses.length,n=v.uploadProgresses.reduce((e,t)=>{let{percentage:n}=t;return e+n},0)/t*100,a=(0,D.Uh)(v.uploadProgresses);return(0,T.oR)((0,o.jsx)(V.t,{progress:n,message:"Uploading ".concat(t," file").concat(t>1?"s":"","..."),progressPrefix:"".concat(a&&!isNaN(a)&&isFinite(a)&&0!==a?"".concat((0,D.fU)(a)," remaining – "):""),action:e&&(0,o.jsx)(K.$,{size:"tiny",type:"default",className:"ml-6",onClick:()=>v.abortUploads(e),children:"Cancel"})}),{id:e,closeButton:!1,position:"top-right"})},updateRowStatus:e=>{let{name:t,status:n,columnIndex:a,updatedName:o}=e,r=void 0!==a?a:v.getLatestColumnIndex(),i=v.columns.map((e,a)=>{if(a===r){let a=e.items.map(e=>e.name===t?{...e,status:n,...o&&{name:o}}:e);return{...e,items:a}}return e});v.columns=i}});return v}a=new AbortController;let Z={projectRef:"",resumableUploadUrl:"",serviceKey:"",supabaseClient:void 0},ee=(0,w.createContext)(Q(Z)),et=e=>{var t,n,a;let{children:r}=e,i=(0,H.KT)(),l=(null==i?void 0:i.status)===Y.BU.INACTIVE,[s,c]=(0,w.useState)(()=>Q(Z)),d=(0,x.A)(s),{data:u}=(0,k.Gm)({projectRef:null==i?void 0:i.ref}),{serviceKey:m}=(0,k.d6)(u),p=null!=(a=null==u||null==(t=u.app_config)?void 0:t.protocol)?a:"https",g=null==u||null==(n=u.app_config)?void 0:n.endpoint,f="".concat(Y.pe?"https":p,"://").concat(g,"/storage/v1/upload/resumable");return(0,w.useEffect)(()=>{let e=(0,S.P9)(d.current),t=!!(null==i?void 0:i.ref),n=e.projectRef!==(null==i?void 0:i.ref);if(!l&&t&&n&&m){var a;let e="".concat(Y.pe?"https":p,"://").concat(g),t=(0,R.UU)(e,m.api_key,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storage:{getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}}}});c(Q({projectRef:null!=(a=null==i?void 0:i.ref)?a:"",supabaseClient:t,resumableUploadUrl:f,serviceKey:m.api_key}))}},[null==i?void 0:i.ref,d,m,l]),(0,o.jsx)(ee.Provider,{value:s,"data-sentry-element":"unknown","data-sentry-component":"StorageExplorerStateContextProvider","data-sentry-source-file":"storage-explorer.tsx",children:r})};function en(e){let t=(0,w.useContext)(ee);return(0,I.s)(t,e)}},4806:(e,t,n)=>{"use strict";n.d(t,{CG:()=>d,Fm:()=>b,Qs:()=>E,XW:()=>v,Xc:()=>_,cj:()=>c,h:()=>h,kN:()=>u,qp:()=>y});var a=n(80263),o=n(39383),r=n(79279),i=n(53239),l=n(29260),s=n(82457);let c=o.bL,d=o.l9,u=o.bm;(0,r.F)("fixed inset-0 z-50 flex",{variants:{side:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{side:"right"}});let m=e=>{let{side:t,children:n,...r}=e;return(0,a.jsx)(o.ZL,{...r,"data-sentry-element":"unknown","data-sentry-component":"SheetPortal","data-sentry-source-file":"sheet.tsx",children:n})};m.displayName=o.ZL.displayName;let p=i.forwardRef((e,t)=>{let{className:n,children:r,...i}=e;return(0,a.jsx)(o.hJ,{className:(0,s.cn)("fixed inset-0 z-50 bg-alternative/90 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",n),...i,ref:t})});p.displayName=o.hJ.displayName;let g=(0,s.cn)(["fixed z-50 scale-100 gap-4 bg-studio opacity-100 shadow-lg","data-[state=open]:animate-in data-[state=open]:duration-300 data-[state=closed]:animate-out data-[state=closed]:duration-300"]),f=(0,r.F)(g,{variants:{side:{top:"data-[state=open]:slide-in-from-top data-[state=closed]:slide-out-to-top w-full border-b inset-x-0 top-0",bottom:"data-[state=open]:slide-in-from-bottom data-[state=closed]:slide-out-to-bottom w-full border-t inset-x-0 bottom-0",left:"data-[state=open]:slide-in-from-left data-[state=closed]:slide-out-to-left h-full border-r inset-y-0 left-0",right:"data-[state=open]:slide-in-from-right data-[state=closed]:slide-out-to-right h-full border-l inset-y-0 right-0"},size:{content:"",default:"",sm:"",lg:"",xl:"",xxl:"",full:""}},compoundVariants:[{side:["top","bottom"],size:"content",class:"max-h-screen"},{side:["top","bottom"],size:"default",class:"h-1/3"},{side:["top","bottom"],size:"sm",class:"h-1/4"},{side:["top","bottom"],size:"lg",class:"h-1/2"},{side:["top","bottom"],size:"xl",class:"h-5/6"},{side:["top","bottom"],size:"full",class:"h-screen"},{side:["right","left"],size:"content",class:"max-w-screen"},{side:["right","left"],size:"default",class:"lg:w-1/3"},{side:["right","left"],size:"sm",class:"lg:w-1/4"},{side:["right","left"],size:"lg",class:"lg:w-1/2"},{side:["right","left"],size:"xl",class:"lg:w-4/6"},{side:["right","left"],size:"xxl",class:"w-5/6"},{side:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{side:"right",size:"default"}}),h=i.forwardRef((e,t)=>{let{side:n,size:r,className:i,children:c,showClose:d=!0,...u}=e;return(0,a.jsxs)(m,{side:n,children:[(0,a.jsx)(p,{}),(0,a.jsxs)(o.UC,{ref:t,className:(0,s.cn)(f({side:n,size:r}),i),...u,children:[c,d?(0,a.jsxs)(o.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}):null]})]})});h.displayName=o.UC.displayName;let b=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)("px-5 py-4 text-center sm:text-left border-b bg-dash-sidebar",t),...n,"data-sentry-component":"SheetHeader","data-sentry-source-file":"sheet.tsx"})};b.displayName="SheetHeader";let _=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)("px-5 py-4",t),...n,"data-sentry-component":"SheetSection","data-sentry-source-file":"sheet.tsx"})};_.displayName="SheetSection";let v=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)("px-5 py-3 border-t w-full","flex flex-col-reverse sm:flex-row sm:justify-end gap-2",t),...n,"data-sentry-component":"SheetFooter","data-sentry-source-file":"sheet.tsx"})};v.displayName="SheetFooter";let y=i.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.hE,{ref:t,className:(0,s.cn)("text-lg text-foreground",n),...r})});y.displayName=o.hE.displayName;let E=i.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.VY,{ref:t,className:(0,s.cn)("text-sm text-foreground-light",n),...r})});E.displayName=o.VY.displayName},7164:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Query:()=>a.X,QueryAction:()=>i.x,QueryFilter:()=>r.X,QueryModifier:()=>l.Y,countQuery:()=>o.Mh,deleteQuery:()=>o.yN,insertQuery:()=>o.Go,selectQuery:()=>o.Z1,truncateQuery:()=>o.TV,updateQuery:()=>o.oR});var a=n(70084),o=n(28763),r=n(13482),i=n(63050),l=n(14257)},9895:(e,t,n)=>{"use strict";n.d(t,{Om:()=>g,f2:()=>h,g3:()=>f});var a=n(80263),o=n(53239),r=n(3231),i=n(32211),l=n(403),s=n(37785),c=n(45897),d=n(2647),u=n(49508),m=n(53674);let p=(0,o.createContext)({project:void 0,isLoading:!0}),g=()=>(0,o.useContext)(p),f=e=>{let{projectRef:t,children:n}=e,{data:i,isLoading:g}=(0,r.wT)({ref:t}),f=(0,o.useMemo)(()=>({project:i,isLoading:g}),[i,g]);return(0,a.jsx)(p.Provider,{value:f,"data-sentry-element":"unknown","data-sentry-component":"ProjectContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(u.by,{"data-sentry-element":"TableEditorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(m.YD,{"data-sentry-element":"TabsStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(l.Co,{"data-sentry-element":"AiAssistantStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(d.y,{"data-sentry-element":"StorageExplorerStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(s.UZ,{"data-sentry-element":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(c.ME,{"data-sentry-element":"RoleImpersonationStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:n},"role-impersonation-state-".concat(t))},"database-selector-state-".concat(t))},"storage-explorer-state-".concat(t))},"ai-assistant-state-".concat(t))},"tabs-state-".concat(t))},"table-editor-state-".concat(t))})},h=()=>{let{project:e}=g();return(null==e?void 0:e.status)===i.BU.ACTIVE_HEALTHY}},11770:(e,t,n)=>{"use strict";n.d(t,{PE:()=>u,Rd:()=>f,Uh:()=>m,Ym:()=>c,fU:()=>d,iN:()=>p,ok:()=>s});var a=n(73969),o=n(31857),r=n(37356),i=n(62434),l=n(18971);let s=".emptyFolderPlaceholder",c=(e,t)=>{let n=e.slice(0,t.columnIndex).map(e=>e.name),o=n.length>0?"".concat(n.join("/"),"/").concat(t.name):t.name;(0,r.l)(o),a.oR.success('Copied path to folder "'.concat(t.name,'"'))},d=e=>{let t=Math.floor(e/86400),n=Math.floor((e%=86400)/3600),a=Math.floor((e%=3600)/60);return(e=Math.floor(e%60),t>0)?"".concat(t,"d "):n>0?"".concat(n,"h "):a>0?"".concat(a,"m "):"".concat(e,"s")},u=async e=>{var t,n,r;let{projectRef:l,bucketId:s,file:c,showToast:d=!0,returnBlob:u=!1}=e;if(!l)return a.oR.error("Failed to download: Project ref is required");if(!s)return a.oR.error("Failed to download: Bucket ID is required");if(!c.path)return a.oR.error("Failed to download: Unable to find path to file");let m=c.name,p=null!=(n=null==c||null==(t=c.metadata)?void 0:t.mimetype)?n:void 0,g=d?a.oR.loading("Retrieving ".concat(m,"...")):void 0;try{let e=await (0,o.c)({projectRef:l,bucketId:s,path:c.path}),t=await e.blob(),n=new Blob([t],{type:p});if(u)return{name:m,blob:n};let d=window.URL.createObjectURL(n),f=document.createElement("a");return f.href=d,f.setAttribute("download","".concat(m)),document.body.appendChild(f),f.click(),null==(r=f.parentNode)||r.removeChild(f),window.URL.revokeObjectURL(t),g&&a.oR.success("Downloading ".concat(m),{id:g,closeButton:!0,duration:i.j}),!0}catch(e){return g&&a.oR.error("Failed to download ".concat(m),{id:g,closeButton:!0,duration:i.j}),!1}},m=e=>{let t=0,n=0;return e.forEach(e=>{if(0===(n+=e.remainingBytes))return;let a=e.remainingBytes/n;t+=a*e.remainingTime}),t},p=function(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;return null!=(t=null==(e=null!=n?n:[])?void 0:e.filter(e=>e.name!==s).map(e=>{let t=e.id?l.Vl.FILE:l.Vl.FOLDER,n=Number(new Date)-Number(new Date(e.created_at)),o=t===l.Vl.FILE&&!e.metadata&&n>=9e5,r=t===l.Vl.FILE&&!e.metadata&&n<=9e5?l.U1.LOADING:l.U1.READY;return{...e,metadata:e.metadata,type:t,status:r,isCorrupted:o,path:a?"".concat(a,"/").concat(e.name):e.name}}))?t:[]},g=async e=>{try{return await new Promise((t,n)=>e.file(t,n))}catch(e){console.error("getFile error:",e);return}},f=async e=>{let t=(0,a.oR)("Retrieving items to upload..."),n=[],o=[];for(let t of e){let e=t.webkitGetAsEntry();e&&o.push(e)}for(;o.length>0;){let e=o.shift();if(e&&e.isFile){let t=await g(e);void 0!==t&&(t.path=e.fullPath.slice(1),n.push(t))}else e&&e.isDirectory&&o.push(...await h(e.createReader()))}return a.oR.dismiss(t),n},h=async e=>{let t=[],n=await b(e);for(;n&&n.length>0;)t.push(...n),n=await b(e);return t},b=async e=>{try{return await new Promise((t,n)=>{e.readEntries(t,n)})}catch(e){console.error("readEntriesPromise error:",e)}}},13482:(e,t,n)=>{"use strict";n.d(t,{X:()=>r});var a=n(72101),o=n(14257);class r{filter(e,t,n){return this.filters.push({column:e,operator:t,value:n}),this}match(e){return Object.entries(e).map(e=>{let[t,n]=e;this.filters.push({column:t,operator:"=",value:n})}),this}order(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.sorts.push({table:e,column:t,ascending:n,nullsFirst:a}),this}range(e,t){return this._getQueryModifier().range(e,t)}toSql(e){return this._getQueryModifier().toSql(e)}_getQueryModifier(){return new o.Y(this.table,this.action,{actionValue:this.actionValue,actionOptions:this.actionOptions,filters:this.filters,sorts:this.sorts})}constructor(e,t,n,o){(0,a._)(this,"table",void 0),(0,a._)(this,"action",void 0),(0,a._)(this,"actionValue",void 0),(0,a._)(this,"actionOptions",void 0),(0,a._)(this,"filters",void 0),(0,a._)(this,"sorts",void 0),this.table=e,this.action=t,this.actionValue=n,this.actionOptions=o,this.filters=[],this.sorts=[]}}},14257:(e,t,n)=>{"use strict";n.d(t,{Y:()=>r});var a=n(72101),o=n(28763);class r{range(e,t){return this.pagination={offset:e,limit:t-e+1},this}toSql(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isCTE:!1,isFinal:!0};try{var t;let{actionValue:n,actionOptions:a,filters:r,sorts:i}=null!=(t=this.options)?t:{};switch(this.action){case"count":return(0,o.Mh)(this.table,{filters:r});case"delete":return(0,o.yN)(this.table,r,{returning:null==a?void 0:a.returning,enumArrayColumns:null==a?void 0:a.enumArrayColumns});case"insert":return(0,o.Go)(this.table,n,{returning:null==a?void 0:a.returning,enumArrayColumns:null==a?void 0:a.enumArrayColumns});case"select":return(0,o.Z1)(this.table,n,{filters:r,pagination:this.pagination,sorts:i},e.isFinal,e.isCTE);case"update":return(0,o.oR)(this.table,n,{filters:r,returning:null==a?void 0:a.returning,enumArrayColumns:null==a?void 0:a.enumArrayColumns});case"truncate":return(0,o.TV)(this.table,{cascade:null==a?void 0:a.cascade});default:return""}}catch(e){throw e}}constructor(e,t,n){(0,a._)(this,"table",void 0),(0,a._)(this,"action",void 0),(0,a._)(this,"options",void 0),(0,a._)(this,"pagination",void 0),this.table=e,this.action=t,this.options=n}}},14287:(e,t,n)=>{"use strict";n.d(t,{M:()=>c});var a=n(80263),o=n(77878),r=n(85651),i=n(37055),l=n(53239),s=n(82457);let c=(0,l.memo)(e=>{let{size:t=24,loading:n=!1,className:c,allowHoverEffect:d=!1}=e,u=Math.max(1.5,t/46),m=(0,l.useRef)(null),[p,g]=(0,l.useState)(!1),f=(0,o.d)(0),h=(0,o.d)(0),b=(0,r.z)(f,{stiffness:300,damping:30}),_=(0,r.z)(h,{stiffness:300,damping:30});return(0,a.jsxs)("div",{className:(0,s.cn)("text-brand-600 flex justify-center items-center relative",c),style:{width:t,height:t,position:"relative"},"data-sentry-component":"AiIconAnimationComponent","data-sentry-source-file":"ai-icon-animation.tsx",children:[(0,a.jsx)("div",{ref:m,className:"absolute flex items-center justify-center",style:{width:2*t,height:2*t,left:-t/2,top:-t/2},onMouseMove:e=>{if(!d||!m.current)return;let t=m.current.getBoundingClientRect(),n=t.left+t.width/2,a=t.top+t.height/2,o=e.clientX-n,r=e.clientY-a;f.set(o/5),h.set(r/5)},onMouseEnter:()=>g(!0),onMouseLeave:()=>{g(!1),f.set(0),h.set(0)}}),(0,a.jsxs)(i.P.svg,{width:t,height:t,viewBox:"0 0 46 46",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"unknown","data-sentry-source-file":"ai-icon-animation.tsx",children:[(0,a.jsx)(i.P.path,{fillRule:"evenodd",clipRule:"evenodd",d:"M23 1.78677L44.2132 23L23 44.2132L1.7868 23L23 1.78677ZM23 0.372559L23.7071 1.07967L44.9203 22.2929L45.6274 23L44.9203 23.7071L23.7071 44.9203L23 45.6274L22.2929 44.9203L1.07969 23.7071L0.372583 23L1.07969 22.2929L22.2929 1.07967L23 0.372559Z",fill:"none",stroke:"currentColor",strokeWidth:u,animate:n?"loading":p?"hover":"rest",variants:{rest:{rotate:0},loading:{rotate:360},hover:{rotate:10}},transition:{duration:2,repeat:n?1/0:0,ease:"circInOut",type:"spring",stiffness:60,damping:10},"data-sentry-element":"unknown","data-sentry-source-file":"ai-icon-animation.tsx"}),(0,a.jsx)(i.P.path,{fillRule:"evenodd",clipRule:"evenodd",d:"M30 23C30 26.866 26.866 30 23 30C19.134 30 16 26.866 16 23C16 19.134 19.134 16 23 16C26.866 16 30 19.134 30 23ZM31 23C31 27.4183 27.4183 31 23 31C18.5817 31 15 27.4183 15 23C15 18.5817 18.5817 15 23 15C27.4183 15 31 18.5817 31 23Z",fill:"none",stroke:"currentColor",strokeWidth:u,variants:{rest:{scale:1,x:0,y:0},loading:{scale:[1,1.1,1],x:0,y:0},hover:{scale:1.1}},animate:p?"hover":n?"loading":"rest",style:{x:b,y:_},transition:{duration:2,repeat:n?1/0:0,ease:"easeInOut"},"data-sentry-element":"unknown","data-sentry-source-file":"ai-icon-animation.tsx"})]})]})})},17082:(e,t,n)=>{"use strict";n.d(t,{w:()=>l});var a=n(80263),o=n(22949),r=n(53239),i=n(82457);let l=r.forwardRef((e,t)=>{let{className:n,orientation:r="horizontal",decorative:l=!0,...s}=e;return(0,a.jsx)(o.b,{ref:t,decorative:l,orientation:r,className:(0,i.cn)("shrink-0 bg-border-muted","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",n),...s})});l.displayName=o.b.displayName},17331:(e,t,n)=>{"use strict";n.d(t,{A:()=>eP});var a={};n.r(a),n.d(a,{create:()=>C,list:()=>I,remove:()=>z,retrieve:()=>R,update:()=>D});var o={};n.r(o),n.d(o,{create:()=>q,list:()=>P,pgFunctionArrayZod:()=>F,pgFunctionCreateZod:()=>U,pgFunctionDeleteZod:()=>Y,pgFunctionOptionalZod:()=>k,pgFunctionUpdateZod:()=>G,pgFunctionZod:()=>O,remove:()=>W,retrieve:()=>M,update:()=>H});var r=n(63295);let i='\n-- Can\'t use pg_authid here since some managed Postgres providers don\'t expose it\n-- https://github.com/supabase/postgres-meta/issues/212\n\nselect\n  r.oid as id,\n  rolname as name,\n  rolsuper as "isSuperuser",\n  rolcreatedb as "canCreateDb",\n  rolcreaterole as "canCreateRole",\n  rolinherit as "inheritRole",\n  rolcanlogin as "canLogin",\n  rolreplication as "isReplicationRole",\n  rolbypassrls as "canBypassRls",\n  (\n    select\n      count(*)\n    from\n      pg_stat_activity\n    where\n      r.rolname = pg_stat_activity.usename\n  ) as "activeConnections",\n  case when rolconnlimit = -1 then current_setting(\'max_connections\') :: int8\n       else rolconnlimit\n  end as "connectionLimit",\n  rolvaliduntil as "validUntil",\n  coalesce(r_config.role_configs, \'{}\') as config\nfrom\n  pg_roles r\n  left join (\n    select\n      oid,\n      jsonb_object_agg(param, value) filter (where param is not null) as role_configs\n    from\n      (\n        select\n          oid,\n          (string_to_array(unnest(rolconfig), \'=\'))[1] as param,\n          (string_to_array(unnest(rolconfig), \'=\'))[2] as value\n        from\n          pg_roles\n      ) as _\n    group by\n      oid\n  ) r_config on r_config.oid = r.oid\n';var l=n(39353);let s=l.z.object({id:l.z.number(),name:l.z.string(),isSuperuser:l.z.boolean(),canCreateDb:l.z.boolean(),canCreateRole:l.z.boolean(),inheritRole:l.z.boolean(),canLogin:l.z.boolean(),isReplicationRole:l.z.boolean(),canBypassRls:l.z.boolean(),activeConnections:l.z.number(),connectionLimit:l.z.number(),validUntil:l.z.union([l.z.string(),l.z.null()]),config:l.z.record(l.z.string(),l.z.string())}),c=l.z.array(s),d=l.z.optional(s);function u(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name));throw Error("Must provide either id or name")}let m=["information_schema","pg_catalog","pg_toast"],p=(e,t)=>"\nCOALESCE(\n  (\n    SELECT\n      array_agg(row_to_json(".concat(e,")) FILTER (WHERE ").concat(t,")\n    FROM\n      ").concat(e,"\n  ),\n  '{}'\n) AS ").concat(e);function g(e,t,n){return(n&&(t=n.concat(null!=t?t:[])),null==e?void 0:e.length)?"IN (".concat(e.map(r.eu).join(","),")"):(null==t?void 0:t.length)?"NOT IN (".concat(t.map(r.eu).join(","),")"):""}let f="\n-- Adapted from information_schema.columns\n\nSELECT\n  c.oid :: int8 AS table_id,\n  nc.nspname AS schema,\n  c.relname AS table,\n  (c.oid || '.' || a.attnum) AS id,\n  a.attnum AS ordinal_position,\n  a.attname AS name,\n  CASE\n    WHEN a.atthasdef THEN pg_get_expr(ad.adbin, ad.adrelid)\n    ELSE NULL\n  END AS default_value,\n  CASE\n    WHEN t.typtype = 'd' THEN CASE\n      WHEN bt.typelem <> 0 :: oid\n      AND bt.typlen = -1 THEN 'ARRAY'\n      WHEN nbt.nspname = 'pg_catalog' THEN format_type(t.typbasetype, NULL)\n      ELSE 'USER-DEFINED'\n    END\n    ELSE CASE\n      WHEN t.typelem <> 0 :: oid\n      AND t.typlen = -1 THEN 'ARRAY'\n      WHEN nt.nspname = 'pg_catalog' THEN format_type(a.atttypid, NULL)\n      ELSE 'USER-DEFINED'\n    END\n  END AS data_type,\n  COALESCE(bt.typname, t.typname) AS format,\n  a.attidentity IN ('a', 'd') AS is_identity,\n  CASE\n    a.attidentity\n    WHEN 'a' THEN 'ALWAYS'\n    WHEN 'd' THEN 'BY DEFAULT'\n    ELSE NULL\n  END AS identity_generation,\n  a.attgenerated IN ('s') AS is_generated,\n  NOT (\n    a.attnotnull\n    OR t.typtype = 'd' AND t.typnotnull\n  ) AS is_nullable,\n  (\n    c.relkind IN ('r', 'p')\n    OR c.relkind IN ('v', 'f') AND pg_column_is_updatable(c.oid, a.attnum, FALSE)\n  ) AS is_updatable,\n  uniques.table_id IS NOT NULL AS is_unique,\n  check_constraints.definition AS \"check\",\n  array_to_json(\n    array(\n      SELECT\n        enumlabel\n      FROM\n        pg_catalog.pg_enum enums\n      WHERE\n        enums.enumtypid = coalesce(bt.oid, t.oid)\n        OR enums.enumtypid = coalesce(bt.typelem, t.typelem)\n      ORDER BY\n        enums.enumsortorder\n    )\n  ) AS enums,\n  col_description(c.oid, a.attnum) AS comment\nFROM\n  pg_attribute a\n  LEFT JOIN pg_attrdef ad ON a.attrelid = ad.adrelid\n  AND a.attnum = ad.adnum\n  JOIN (\n    pg_class c\n    JOIN pg_namespace nc ON c.relnamespace = nc.oid\n  ) ON a.attrelid = c.oid\n  JOIN (\n    pg_type t\n    JOIN pg_namespace nt ON t.typnamespace = nt.oid\n  ) ON a.atttypid = t.oid\n  LEFT JOIN (\n    pg_type bt\n    JOIN pg_namespace nbt ON bt.typnamespace = nbt.oid\n  ) ON t.typtype = 'd'\n  AND t.typbasetype = bt.oid\n  LEFT JOIN (\n    SELECT DISTINCT ON (table_id, ordinal_position)\n      conrelid AS table_id,\n      conkey[1] AS ordinal_position\n    FROM pg_catalog.pg_constraint\n    WHERE contype = 'u' AND cardinality(conkey) = 1\n  ) AS uniques ON uniques.table_id = c.oid AND uniques.ordinal_position = a.attnum\n  LEFT JOIN (\n    -- We only select the first column check\n    SELECT DISTINCT ON (table_id, ordinal_position)\n      conrelid AS table_id,\n      conkey[1] AS ordinal_position,\n      substring(\n        pg_get_constraintdef(pg_constraint.oid, true),\n        8,\n        length(pg_get_constraintdef(pg_constraint.oid, true)) - 8\n      ) AS \"definition\"\n    FROM pg_constraint\n    WHERE contype = 'c' AND cardinality(conkey) = 1\n    ORDER BY table_id, ordinal_position, oid asc\n  ) AS check_constraints ON check_constraints.table_id = c.oid AND check_constraints.ordinal_position = a.attnum\nWHERE\n  NOT pg_is_other_temp_schema(nc.oid)\n  AND a.attnum > 0\n  AND NOT a.attisdropped\n  AND (c.relkind IN ('r', 'v', 'm', 'f', 'p'))\n  AND (\n    pg_has_role(c.relowner, 'USAGE')\n    OR has_column_privilege(\n      c.oid,\n      a.attnum,\n      'SELECT, INSERT, UPDATE, REFERENCES'\n    )\n  )\n",h=l.z.object({id:l.z.string(),table_id:l.z.number(),schema:l.z.string(),table:l.z.string(),name:l.z.string(),ordinal_position:l.z.number(),data_type:l.z.string(),format:l.z.string(),is_identity:l.z.boolean(),identity_generation:l.z.string().nullable(),is_generated:l.z.boolean(),is_nullable:l.z.boolean(),is_updatable:l.z.boolean(),is_unique:l.z.boolean(),check:l.z.string().nullable(),default_value:l.z.any().nullable(),enums:l.z.array(l.z.string()),comment:l.z.string().nullable()}),b=l.z.array(h),_=l.z.optional(h),v=e=>e.endsWith("[]")?"".concat((0,r.bD)(e.slice(0,-2)),"[]"):e.includes(".")?e:(0,r.bD)(e),y="\n-- Adapted from information_schema.schemata\n\nselect\n  n.oid as id,\n  n.nspname as name,\n  u.rolname as owner\nfrom\n  pg_namespace n,\n  pg_roles u\nwhere\n  n.nspowner = u.oid\n  and (\n    pg_has_role(n.nspowner, 'USAGE')\n    or has_schema_privilege(n.oid, 'CREATE, USAGE')\n  )\n  and not pg_catalog.starts_with(n.nspname, 'pg_temp_')\n  and not pg_catalog.starts_with(n.nspname, 'pg_toast_temp_')\n",E=l.z.object({id:l.z.number(),name:l.z.string(),owner:l.z.string()}),A=l.z.array(E),w=l.z.optional(E),x=l.z.object({table_id:l.z.number(),name:l.z.string(),schema:l.z.string(),table_name:l.z.string()}),T=l.z.object({id:l.z.number(),constraint_name:l.z.string(),source_schema:l.z.string(),source_table_name:l.z.string(),source_column_name:l.z.string(),target_table_schema:l.z.string(),target_table_name:l.z.string(),target_column_name:l.z.string()}),N=l.z.object({id:l.z.number(),schema:l.z.string(),name:l.z.string(),rls_enabled:l.z.boolean(),rls_forced:l.z.boolean(),replica_identity:l.z.enum(["DEFAULT","INDEX","FULL","NOTHING"]),bytes:l.z.number(),size:l.z.string(),live_rows_estimate:l.z.number(),dead_rows_estimate:l.z.number(),comment:l.z.string().nullable(),primary_keys:l.z.array(x),relationships:l.z.array(T),columns:b.optional()}),S=l.z.array(N);function I(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o,includeColumns:r=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=j({includeColumns:r}),l=g(t,n,e?void 0:m);return l&&(i+=" where schema ".concat(l)),a&&(i+=" limit ".concat(a)),o&&(i+=" offset ".concat(o)),{sql:i,zod:S}}function R(e){let t=function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name)," and ").concat((0,r.bD)("schema")," = ").concat((0,r.eu)(e.schema));throw Error("Must provide either id or name and schema")}(e);return{sql:"".concat(j({includeColumns:!0})," where ").concat(t,";"),zod:N}}function z(e){let{cascade:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"DROP TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.name)," ").concat(t?"CASCADE":"RESTRICT",";")}}let j=e=>{let{includeColumns:t}=e;return"\n  with tables as (".concat("\nSELECT\n  c.oid :: int8 AS id,\n  nc.nspname AS schema,\n  c.relname AS name,\n  c.relrowsecurity AS rls_enabled,\n  c.relforcerowsecurity AS rls_forced,\n  CASE\n    WHEN c.relreplident = 'd' THEN 'DEFAULT'\n    WHEN c.relreplident = 'i' THEN 'INDEX'\n    WHEN c.relreplident = 'f' THEN 'FULL'\n    ELSE 'NOTHING'\n  END AS replica_identity,\n  pg_total_relation_size(format('%I.%I', nc.nspname, c.relname)) :: int8 AS bytes,\n  pg_size_pretty(\n    pg_total_relation_size(format('%I.%I', nc.nspname, c.relname))\n  ) AS size,\n  pg_stat_get_live_tuples(c.oid) AS live_rows_estimate,\n  pg_stat_get_dead_tuples(c.oid) AS dead_rows_estimate,\n  obj_description(c.oid) AS comment,\n  coalesce(pk.primary_keys, '[]') as primary_keys,\n  coalesce(\n    jsonb_agg(relationships) filter (where relationships is not null),\n    '[]'\n  ) as relationships\nFROM\n  pg_namespace nc\n  JOIN pg_class c ON nc.oid = c.relnamespace\n  left join (\n    select\n      table_id,\n      jsonb_agg(_pk.*) as primary_keys\n    from (\n      select\n        n.nspname as schema,\n        c.relname as table_name,\n        a.attname as name,\n        c.oid :: int8 as table_id\n      from\n        pg_index i,\n        pg_class c,\n        pg_attribute a,\n        pg_namespace n\n      where\n        i.indrelid = c.oid\n        and c.relnamespace = n.oid\n        and a.attrelid = c.oid\n        and a.attnum = any (i.indkey)\n        and i.indisprimary\n    ) as _pk\n    group by table_id\n  ) as pk\n  on pk.table_id = c.oid\n  left join (\n    select\n      c.oid :: int8 as id,\n      c.conname as constraint_name,\n      nsa.nspname as source_schema,\n      csa.relname as source_table_name,\n      sa.attname as source_column_name,\n      nta.nspname as target_table_schema,\n      cta.relname as target_table_name,\n      ta.attname as target_column_name\n    from\n      pg_constraint c\n    join (\n      pg_attribute sa\n      join pg_class csa on sa.attrelid = csa.oid\n      join pg_namespace nsa on csa.relnamespace = nsa.oid\n    ) on sa.attrelid = c.conrelid and sa.attnum = any (c.conkey)\n    join (\n      pg_attribute ta\n      join pg_class cta on ta.attrelid = cta.oid\n      join pg_namespace nta on cta.relnamespace = nta.oid\n    ) on ta.attrelid = c.confrelid and ta.attnum = any (c.confkey)\n    where\n      c.contype = 'f'\n  ) as relationships\n  on (relationships.source_schema = nc.nspname and relationships.source_table_name = c.relname)\n  or (relationships.target_table_schema = nc.nspname and relationships.target_table_name = c.relname)\nWHERE\n  c.relkind IN ('r', 'p')\n  AND NOT pg_is_other_temp_schema(nc.oid)\n  AND (\n    pg_has_role(c.relowner, 'USAGE')\n    OR has_table_privilege(\n      c.oid,\n      'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n    )\n    OR has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n  )\ngroup by\n  c.oid,\n  c.relname,\n  c.relrowsecurity,\n  c.relforcerowsecurity,\n  c.relreplident,\n  nc.nspname,\n  pk.primary_keys\n",")\n  ").concat(t?", columns as (".concat(f,")"):"","\n  select\n    *\n    ").concat(t?", ".concat(p("columns","columns.table_id = tables.id")):"","\n  from tables")};function C(e){let{name:t,schema:n="public",comment:a}=e,o="CREATE TABLE ".concat((0,r.bD)(n),".").concat((0,r.bD)(t)," ();"),i=void 0===a?"":"COMMENT ON TABLE ".concat((0,r.bD)(n),".").concat((0,r.bD)(t)," IS ").concat((0,r.eu)(a),";");return{sql:"BEGIN; ".concat(o," ").concat(i," COMMIT;")}}function D(e,t){let{name:n,schema:a,rls_enabled:o,rls_forced:i,replica_identity:l,replica_identity_index:s,primary_keys:c,comment:d}=t,u="ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.name)),m=void 0===a?"":"".concat(u," SET SCHEMA ").concat((0,r.bD)(a),";"),p="";if(void 0!==n&&n!==e.name){let t=void 0===a?e.schema:a;p="ALTER TABLE ".concat((0,r.bD)(t),".").concat((0,r.bD)(e.name)," RENAME TO ").concat((0,r.bD)(n),";")}let g="";void 0!==o&&(g=o?"".concat(u," ENABLE ROW LEVEL SECURITY;"):"".concat(u," DISABLE ROW LEVEL SECURITY;"));let f="";void 0!==i&&(f=i?"".concat(u," FORCE ROW LEVEL SECURITY;"):"".concat(u," NO FORCE ROW LEVEL SECURITY;"));let h="";void 0===l||(h="INDEX"===l?"".concat(u," REPLICA IDENTITY USING INDEX ").concat(s,";"):"".concat(u," REPLICA IDENTITY ").concat(l,";"));let b="";void 0===c||(b+="\nDO $$\nDECLARE\n  r record;\nBEGIN\n  SELECT conname\n    INTO r\n    FROM pg_constraint\n    WHERE contype = 'p' AND conrelid = ".concat((0,r.eu)(e.id),";\n  IF r IS NOT NULL THEN\n    EXECUTE ").concat((0,r.eu)("".concat(u," DROP CONSTRAINT "))," || quote_ident(r.conname);\n  END IF;\nEND\n$$;\n"),0===c.length||(b+="".concat(u," ADD PRIMARY KEY (").concat(c.map(e=>(0,r.bD)(e.name)).join(","),");")));let _=void 0===d?"":"COMMENT ON TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.name)," IS ").concat((0,r.eu)(d),";");return{sql:"\nBEGIN;\n  ".concat(g,"\n  ").concat(f,"\n  ").concat(h,"\n  ").concat(b,"\n  ").concat(_,"\n  ").concat(m,"\n  ").concat(p,"\nCOMMIT;")}}let L="\n-- CTE with sane arg_modes, arg_names, and arg_types.\n-- All three are always of the same length.\n-- All three include all args, including OUT and TABLE args.\nwith functions as (\n  select\n    *,\n    -- proargmodes is null when all arg modes are IN\n    coalesce(\n      p.proargmodes,\n      array_fill('i'::text, array[cardinality(coalesce(p.proallargtypes, p.proargtypes))])\n    ) as arg_modes,\n    -- proargnames is null when all args are unnamed\n    coalesce(\n      p.proargnames,\n      array_fill(''::text, array[cardinality(coalesce(p.proallargtypes, p.proargtypes))])\n    ) as arg_names,\n    -- proallargtypes is null when all arg modes are IN\n    coalesce(p.proallargtypes, p.proargtypes) as arg_types,\n    array_cat(\n      array_fill(false, array[pronargs - pronargdefaults]),\n      array_fill(true, array[pronargdefaults])) as arg_has_defaults\n  from\n    pg_proc as p\n  where\n    p.prokind = 'f'\n)\nselect\n  f.oid as id,\n  n.nspname as schema,\n  f.proname as name,\n  l.lanname as language,\n  case\n    when l.lanname = 'internal' then ''\n    else f.prosrc\n  end as definition,\n  case\n    when l.lanname = 'internal' then f.prosrc\n    else pg_get_functiondef(f.oid)\n  end as complete_statement,\n  coalesce(f_args.args, '[]') as args,\n  pg_get_function_arguments(f.oid) as argument_types,\n  pg_get_function_identity_arguments(f.oid) as identity_argument_types,\n  f.prorettype as return_type_id,\n  pg_get_function_result(f.oid) as return_type,\n  nullif(rt.typrelid, 0) as return_type_relation_id,\n  f.proretset as is_set_returning_function,\n  case\n    when f.provolatile = 'i' then 'IMMUTABLE'\n    when f.provolatile = 's' then 'STABLE'\n    when f.provolatile = 'v' then 'VOLATILE'\n  end as behavior,\n  f.prosecdef as security_definer,\n  f_config.config_params as config_params\nfrom\n  functions f\n  left join pg_namespace n on f.pronamespace = n.oid\n  left join pg_language l on f.prolang = l.oid\n  left join pg_type rt on rt.oid = f.prorettype\n  left join (\n    select\n      oid,\n      jsonb_object_agg(param, value) filter (where param is not null) as config_params\n    from\n      (\n        select\n          oid,\n          (string_to_array(unnest(proconfig), '='))[1] as param,\n          (string_to_array(unnest(proconfig), '='))[2] as value\n        from\n          functions\n      ) as t\n    group by\n      oid\n  ) f_config on f_config.oid = f.oid\n  left join (\n    select\n      oid,\n      jsonb_agg(jsonb_build_object(\n        'mode', t2.mode,\n        'name', name,\n        'type_id', type_id,\n        -- Cast null into false boolean\n        'has_default', COALESCE(has_default, false)\n      )) as args\n    from\n      (\n        select\n          oid,\n          unnest(arg_modes) as mode,\n          unnest(arg_names) as name,\n          -- Coming from: coalesce(p.proallargtypes, p.proargtypes) postgres won't automatically assume\n          -- integer, we need to cast it to be properly parsed\n          unnest(arg_types)::int8 as type_id,\n          unnest(arg_has_defaults) as has_default\n        from\n          functions\n      ) as t1,\n      lateral (\n        select\n          case\n            when t1.mode = 'i' then 'in'\n            when t1.mode = 'o' then 'out'\n            when t1.mode = 'b' then 'inout'\n            when t1.mode = 'v' then 'variadic'\n            else 'table'\n          end as mode\n      ) as t2\n    group by\n      t1.oid\n  ) f_args on f_args.oid = f.oid\n",O=l.z.object({id:l.z.number(),schema:l.z.string(),name:l.z.string(),language:l.z.string(),definition:l.z.string(),complete_statement:l.z.string(),args:l.z.array(l.z.object({mode:l.z.union([l.z.literal("in"),l.z.literal("out"),l.z.literal("inout"),l.z.literal("variadic"),l.z.literal("table")]),name:l.z.string(),type_id:l.z.number(),has_default:l.z.boolean()})),argument_types:l.z.string(),identity_argument_types:l.z.string(),return_type_id:l.z.number(),return_type:l.z.string(),return_type_relation_id:l.z.union([l.z.number(),l.z.null()]),is_set_returning_function:l.z.boolean(),behavior:l.z.union([l.z.literal("IMMUTABLE"),l.z.literal("STABLE"),l.z.literal("VOLATILE")]),security_definer:l.z.boolean(),config_params:l.z.union([l.z.record(l.z.string(),l.z.string()),l.z.null()])}),F=l.z.array(O),k=l.z.optional(O);function P(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="\n    with f as (\n      ".concat(L,"\n    )\n    select\n      f.*\n    from f\n  "),i=g(t,n,e?void 0:m);return i&&(r+=" where schema ".concat(i)),a&&(r="".concat(r," limit ").concat(a)),o&&(r="".concat(r," offset ").concat(o)),{sql:r,zod:F}}function M(e){let{id:t,name:n,schema:a="public",args:o=[]}=e;if(t)return{sql:"\n      with f as (\n        ".concat(L,"\n      )\n      select\n        f.*\n      from f where id = ").concat((0,r.eu)(t),";"),zod:k};if(n&&a&&o)return{sql:"with f as (\n      ".concat(L,"\n    )\n    select\n      f.*\n    from f join pg_proc as p on id = p.oid where schema = ").concat((0,r.eu)(a)," and name = ").concat((0,r.eu)(n)," and p.proargtypes::text = ").concat(o.length?"(\n          select string_agg(type_oid::text, ' ') from (\n            select (\n              split_args.arr[\n                array_length(\n                  split_args.arr,\n                  1\n                )\n              ]::regtype::oid\n            ) as type_oid from (\n              select string_to_array(\n                unnest(\n                  array[".concat(o.map(r.eu),"]\n                ),\n                ' '\n              ) as arr\n            ) as split_args\n          ) args\n        )"):(0,r.eu)("")),zod:k};throw Error("Must provide either id or name and schema")}let U=l.z.object({name:l.z.string(),definition:l.z.string(),args:l.z.array(l.z.string()).optional(),behavior:l.z.enum(["IMMUTABLE","STABLE","VOLATILE"]).optional(),config_params:l.z.record(l.z.string(),l.z.string()).optional(),schema:l.z.string().optional(),language:l.z.string().optional(),return_type:l.z.string().optional(),security_definer:l.z.boolean().optional()});function B(e){let{name:t,schema:n,args:a,definition:o,return_type:i,language:l,behavior:s,security_definer:c,config_params:d}=e,{replace:u=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"\n    CREATE ".concat(u?"OR REPLACE":""," FUNCTION ").concat((0,r.bD)(n),".").concat((0,r.bD)(t),"(").concat((null==a?void 0:a.join(", "))||"",")\n    RETURNS ").concat(i,"\n    AS ").concat((0,r.eu)(o),"\n    LANGUAGE ").concat(l,"\n    ").concat(s,"\n    CALLED ON NULL INPUT\n    ").concat(c?"SECURITY DEFINER":"SECURITY INVOKER","\n    ").concat(d?Object.entries(d).map(e=>{let[t,n]=e;return"SET ".concat(t," ").concat("FROM CURRENT"===n?"FROM CURRENT":"TO "+('""'===n?"''":n))}).join("\n"):"",";\n  ")}function q(e){let{name:t,schema:n="public",args:a=[],definition:o,return_type:r="void",language:i="sql",behavior:s="VOLATILE",security_definer:c=!1,config_params:d={}}=e;return{sql:B({name:t,schema:n,args:a,definition:o,return_type:r,language:i,behavior:s,security_definer:c,config_params:d}),zod:l.z.void()}}let G=l.z.object({name:l.z.string().optional(),schema:l.z.string().optional(),definition:l.z.string().optional()});function H(e,t){var n;let{name:a,schema:o,definition:i}=t,s=e.argument_types.split(", "),c=e.identity_argument_types,d="string"==typeof i?B({...e,definition:i,args:s,config_params:null!=(n=e.config_params)?n:{}},{replace:!0}):"",u=a&&a!==e.name?"ALTER FUNCTION ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.name),"(").concat(c,") RENAME TO ").concat((0,r.bD)(a),";"):"",m=o&&o!==e.schema?"ALTER FUNCTION ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(a||e.name),"(").concat(c,")  SET SCHEMA ").concat((0,r.bD)(o),";"):"";return{sql:"\n    DO LANGUAGE plpgsql $$\n    BEGIN\n      IF ".concat("string"==typeof i?"TRUE":"FALSE"," THEN\n        ").concat(d,"\n\n        IF (\n          SELECT id\n          FROM (").concat(L,") AS f\n          WHERE f.schema = ").concat((0,r.eu)(e.schema),"\n          AND f.name = ").concat((0,r.eu)(e.name),"\n          AND f.identity_argument_types = ").concat((0,r.eu)(c),"\n        ) != ").concat(e.id," THEN\n          RAISE EXCEPTION 'Cannot find function \"").concat(e.schema,'"."').concat(e.name,'"(').concat(c,")';\n        END IF;\n      END IF;\n\n      ").concat(u,"\n\n      ").concat(m,"\n    END;\n    $$;\n  "),zod:l.z.void()}}let Y=l.z.object({cascade:l.z.boolean().default(!1).optional()});function W(e){let{cascade:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"DROP FUNCTION ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.name),"\n  (").concat(e.identity_argument_types,")\n  ").concat(t?"CASCADE":"RESTRICT",";"),zod:l.z.void()}}let $="\n-- Despite the name `table_privileges`, this includes other kinds of relations:\n-- views, matviews, etc. \"Relation privileges\" just doesn't roll off the tongue.\n--\n-- For each relation, get its relacl in a jsonb format,\n-- e.g.\n--\n-- '{postgres=arwdDxt/postgres}'\n--\n-- becomes\n--\n-- [\n--   {\n--     \"grantee\": \"postgres\",\n--     \"grantor\": \"postgres\",\n--     \"is_grantable\": false,\n--     \"privilege_type\": \"INSERT\"\n--   },\n--   ...\n-- ]\nselect\n  c.oid as relation_id,\n  nc.nspname as schema,\n  c.relname as name,\n  case\n    when c.relkind = 'r' then 'table'\n    when c.relkind = 'v' then 'view'\n    when c.relkind = 'm' then 'materialized_view'\n    when c.relkind = 'f' then 'foreign_table'\n    when c.relkind = 'p' then 'partitioned_table'\n  end as kind,\n  coalesce(\n    jsonb_agg(\n      jsonb_build_object(\n        'grantor', grantor.rolname,\n        'grantee', grantee.rolname,\n        'privilege_type', _priv.privilege_type,\n        'is_grantable', _priv.is_grantable\n      )\n    ) filter (where _priv is not null),\n    '[]'\n  ) as privileges\nfrom pg_class c\njoin pg_namespace as nc\n  on nc.oid = c.relnamespace\nleft join lateral (\n  select grantor, grantee, privilege_type, is_grantable\n  from aclexplode(coalesce(c.relacl, acldefault('r', c.relowner)))\n) as _priv on true\nleft join pg_roles as grantor\n  on grantor.oid = _priv.grantor\nleft join (\n  select\n    pg_roles.oid,\n    pg_roles.rolname\n  from pg_roles\n  union all\n  select\n    (0)::oid as oid, 'PUBLIC'\n) as grantee (oid, rolname)\n  on grantee.oid = _priv.grantee\nwhere c.relkind in ('r', 'v', 'm', 'f', 'p')\n  and not pg_is_other_temp_schema(c.relnamespace)\n  and (\n    pg_has_role(c.relowner, 'USAGE')\n    or has_table_privilege(\n      c.oid,\n      'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      || case when current_setting('server_version_num')::int4 >= 170000 then ', MAINTAIN' else '' end\n    )\n    or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n  )\ngroup by\n  c.oid,\n  nc.nspname,\n  c.relname,\n  c.relkind\n",V=l.z.object({relation_id:l.z.number(),schema:l.z.string(),name:l.z.string(),kind:l.z.union([l.z.literal("table"),l.z.literal("view"),l.z.literal("materialized_view"),l.z.literal("foreign_table"),l.z.literal("partitioned_table")]),privileges:l.z.array(l.z.object({grantor:l.z.string(),grantee:l.z.string(),privilege_type:l.z.union([l.z.literal("SELECT"),l.z.literal("INSERT"),l.z.literal("UPDATE"),l.z.literal("DELETE"),l.z.literal("TRUNCATE"),l.z.literal("REFERENCES"),l.z.literal("TRIGGER"),l.z.literal("MAINTAIN")]),is_grantable:l.z.boolean()}))}),J=l.z.array(V),K=l.z.optional(V),X="\nSELECT\n  p.oid :: int8 AS id,\n  p.pubname AS name,\n  p.pubowner::regrole::text AS owner,\n  p.pubinsert AS publish_insert,\n  p.pubupdate AS publish_update,\n  p.pubdelete AS publish_delete,\n  p.pubtruncate AS publish_truncate,\n  CASE\n    WHEN p.puballtables THEN NULL\n    ELSE pr.tables\n  END AS tables\nFROM\n  pg_catalog.pg_publication AS p\n  LEFT JOIN LATERAL (\n    SELECT\n      COALESCE(\n        array_agg(\n          json_build_object(\n            'id',\n            c.oid :: int8,\n            'name',\n            c.relname,\n            'schema',\n            nc.nspname\n          )\n        ),\n        '{}'\n      ) AS tables\n    FROM\n      pg_catalog.pg_publication_rel AS pr\n      JOIN pg_class AS c ON pr.prrelid = c.oid\n      join pg_namespace as nc on c.relnamespace = nc.oid\n    WHERE\n      pr.prpubid = p.oid\n  ) AS pr ON 1 = 1\n",Q=l.z.object({id:l.z.number().optional(),name:l.z.string(),schema:l.z.string()}),Z=l.z.object({id:l.z.number(),name:l.z.string(),owner:l.z.string(),publish_insert:l.z.boolean(),publish_update:l.z.boolean(),publish_delete:l.z.boolean(),publish_truncate:l.z.boolean(),tables:l.z.array(Q).nullable()}),ee=l.z.array(Z),et=l.z.optional(Z),en="\nSELECT\n  e.name,\n  n.nspname AS schema,\n  e.default_version,\n  x.extversion AS installed_version,\n  e.comment\nFROM\n  pg_available_extensions() e(name, default_version, comment)\n  LEFT JOIN pg_extension x ON e.name = x.extname\n  LEFT JOIN pg_namespace n ON x.extnamespace = n.oid\n",ea=l.z.object({name:l.z.string(),schema:l.z.string().nullable(),default_version:l.z.string(),installed_version:l.z.string().nullable(),comment:l.z.string()}),eo=l.z.array(ea),er=l.z.optional(ea),ei=l.z.object({name:l.z.string(),setting:l.z.string(),category:l.z.string(),group:l.z.string(),subgroup:l.z.string(),unit:l.z.string().nullable(),short_desc:l.z.string(),extra_desc:l.z.string().nullable(),context:l.z.string(),vartype:l.z.string(),source:l.z.string(),min_val:l.z.string().nullable(),max_val:l.z.string().nullable(),enumvals:l.z.array(l.z.string()).nullable(),boot_val:l.z.string().nullable(),reset_val:l.z.string().nullable(),sourcefile:l.z.string().nullable(),sourceline:l.z.number().nullable(),pending_restart:l.z.boolean()}),el=l.z.array(ei),es=l.z.object({id:l.z.number(),schema:l.z.string(),name:l.z.string(),is_populated:l.z.boolean(),comment:l.z.string().nullable(),columns:b.optional()}),ec=l.z.array(es),ed=l.z.optional(es),eu=e=>{let{includeColumns:t}=e;return"\nwith materialized_views as (".concat("\nselect\n  c.oid::int8 as id,\n  n.nspname as schema,\n  c.relname as name,\n  c.relispopulated as is_populated,\n  obj_description(c.oid) as comment\nfrom\n  pg_class c\n  join pg_namespace n on n.oid = c.relnamespace\nwhere\n  c.relkind = 'm'\n",")\n  ").concat(t?", columns as (".concat(f,")"):"","\nselect\n  *\n  ").concat(t?", ".concat(p("columns","columns.table_id = materialized_views.id")):"","\nfrom materialized_views")},em=l.z.object({id:l.z.number(),schema:l.z.string(),name:l.z.string(),comment:l.z.string().nullable(),columns:b.optional()}),ep=l.z.array(em),eg=l.z.optional(em),ef=e=>{let{includeColumns:t}=e;return"\nwith foreign_tables as (".concat("\nselect\n  c.oid::int8 as id,\n  n.nspname as schema,\n  c.relname as name,\n  obj_description(c.oid) as comment\nfrom\n  pg_class c\n  join pg_namespace n on n.oid = c.relnamespace\nwhere\n  c.relkind = 'f'\n",")\n  ").concat(t?", columns as (".concat(f,")"):"","\nselect\n  *\n  ").concat(t?", ".concat(p("columns","columns.table_id = foreign_tables.id")):"","\nfrom foreign_tables")},eh=l.z.object({id:l.z.number(),schema:l.z.string(),name:l.z.string(),is_updatable:l.z.boolean(),comment:l.z.string().nullable(),columns:b.optional()}),eb=l.z.array(eh),e_=l.z.optional(eh),ev=e=>{let{includeColumns:t}=e;return"\nwith views as (".concat("\nSELECT\n  c.oid :: int8 AS id,\n  n.nspname AS schema,\n  c.relname AS name,\n  (pg_relation_is_updatable(c.oid, false) & 20) = 20 AS is_updatable,\n  obj_description(c.oid) AS comment\nFROM\n  pg_class c\n  JOIN pg_namespace n ON n.oid = c.relnamespace\nWHERE\n  c.relkind = 'v'\n",")\n  ").concat(t?", columns as (".concat(f,")"):"","\nselect\n  *\n  ").concat(t?", ".concat(p("columns","columns.table_id = views.id")):"","\nfrom views")},ey="\nselect\n  pol.oid :: int8 as id,\n  n.nspname as schema,\n  c.relname as table,\n  c.oid :: int8 as table_id,\n  pol.polname as name,\n  case\n    when pol.polpermissive then 'PERMISSIVE'::text\n    else 'RESTRICTIVE'::text\n  end as action,\n  case\n    when pol.polroles = '{0}'::oid[] then array_to_json(string_to_array('public'::text, ''::text)::name[])\n    else array_to_json(array(\n      select pg_roles.rolname\n      from pg_roles\n      where pg_roles.oid = any(pol.polroles)\n      order by pg_roles.rolname\n    ))\n  end as roles,\n  case pol.polcmd\n    when 'r'::\"char\" then 'SELECT'::text\n    when 'a'::\"char\" then 'INSERT'::text\n    when 'w'::\"char\" then 'UPDATE'::text\n    when 'd'::\"char\" then 'DELETE'::text\n    when '*'::\"char\" then 'ALL'::text\n    else null::text\n  end as command,\n  pg_get_expr(pol.polqual, pol.polrelid) as definition,\n  pg_get_expr(pol.polwithcheck, pol.polrelid) as check\nfrom\n  pg_policy pol\n  join pg_class c on c.oid = pol.polrelid\n  left join pg_namespace n on n.oid = c.relnamespace\n",eE=l.z.object({id:l.z.number(),schema:l.z.string(),table:l.z.string(),table_id:l.z.number(),name:l.z.string(),action:l.z.union([l.z.literal("PERMISSIVE"),l.z.literal("RESTRICTIVE")]),roles:l.z.array(l.z.string()),command:l.z.union([l.z.literal("SELECT"),l.z.literal("INSERT"),l.z.literal("UPDATE"),l.z.literal("DELETE"),l.z.literal("ALL")]),definition:l.z.union([l.z.string(),l.z.null()]),check:l.z.union([l.z.string(),l.z.null()])}),eA=l.z.array(eE),ew=l.z.optional(eE),ex="\nSELECT\n  pg_t.oid AS id,\n  pg_t.tgrelid AS table_id,\n  CASE\n    WHEN pg_t.tgenabled = 'D' THEN 'DISABLED'\n    WHEN pg_t.tgenabled = 'O' THEN 'ORIGIN'\n    WHEN pg_t.tgenabled = 'R' THEN 'REPLICA'\n    WHEN pg_t.tgenabled = 'A' THEN 'ALWAYS'\n  END AS enabled_mode,\n  (\n    STRING_TO_ARRAY(\n      ENCODE(pg_t.tgargs, 'escape'), '\\000'\n    )\n  )[:pg_t.tgnargs] AS function_args,\n  is_t.trigger_name AS name,\n  is_t.event_object_table AS table,\n  is_t.event_object_schema AS schema,\n  is_t.action_condition AS condition,\n  is_t.action_orientation AS orientation,\n  is_t.action_timing AS activation,\n  ARRAY_AGG(is_t.event_manipulation)::text[] AS events,\n  pg_p.proname AS function_name,\n  pg_n.nspname AS function_schema\nFROM\n  pg_trigger AS pg_t\nJOIN\n  pg_class AS pg_c\nON pg_t.tgrelid = pg_c.oid\nJOIN information_schema.triggers AS is_t\nON is_t.trigger_name = pg_t.tgname\nAND pg_c.relname = is_t.event_object_table\nAND pg_c.relnamespace = (quote_ident(is_t.event_object_schema))::regnamespace\nJOIN pg_proc AS pg_p\nON pg_t.tgfoid = pg_p.oid\nJOIN pg_namespace AS pg_n\nON pg_p.pronamespace = pg_n.oid\nGROUP BY\n  pg_t.oid,\n  pg_t.tgrelid,\n  pg_t.tgenabled,\n  pg_t.tgargs,\n  pg_t.tgnargs,\n  is_t.trigger_name,\n  is_t.event_object_table,\n  is_t.event_object_schema,\n  is_t.action_condition,\n  is_t.action_orientation,\n  is_t.action_timing,\n  pg_p.proname,\n  pg_n.nspname\n",eT=l.z.object({id:l.z.number(),table_id:l.z.number(),enabled_mode:l.z.enum(["DISABLED","ORIGIN","REPLICA","ALWAYS"]),function_args:l.z.array(l.z.string()),name:l.z.string(),table:l.z.string(),schema:l.z.string(),condition:l.z.string().nullable(),orientation:l.z.string(),activation:l.z.string(),events:l.z.array(l.z.string()),function_name:l.z.string(),function_schema:l.z.string()}),eN=l.z.array(eT),eS=l.z.optional(eT);l.z.object({name:l.z.string(),schema:l.z.string().optional().default("public"),table:l.z.string(),function_schema:l.z.string().optional().default("public"),function_name:l.z.string(),function_args:l.z.array(l.z.string()).optional(),activation:l.z.enum(["BEFORE","AFTER","INSTEAD OF"]),events:l.z.array(l.z.string()),orientation:l.z.enum(["ROW","STATEMENT"]).optional(),condition:l.z.string().optional()}),l.z.object({name:l.z.string().optional(),enabled_mode:l.z.enum(["ORIGIN","REPLICA","ALWAYS","DISABLED"]).optional()});let eI=l.z.object({id:l.z.number(),name:l.z.string(),schema:l.z.string(),format:l.z.string(),enums:l.z.array(l.z.string()),attributes:l.z.array(l.z.object({name:l.z.string(),type_id:l.z.number()})),comment:l.z.string().nullable()}),eR=l.z.array(eI),ez=l.z.object({version:l.z.string(),version_number:l.z.number(),active_connections:l.z.number(),max_connections:l.z.number()}),ej="\n  SELECT\n    idx.indexrelid::int8 AS id,\n    idx.indrelid::int8 AS table_id,\n    n.nspname AS schema,\n    idx.indnatts AS number_of_attributes,\n    idx.indnkeyatts AS number_of_key_attributes,\n    idx.indisunique AS is_unique,\n    idx.indisprimary AS is_primary,\n    idx.indisexclusion AS is_exclusion,\n    idx.indimmediate AS is_immediate,\n    idx.indisclustered AS is_clustered,\n    idx.indisvalid AS is_valid,\n    idx.indcheckxmin AS check_xmin,\n    idx.indisready AS is_ready,\n    idx.indislive AS is_live,\n    idx.indisreplident AS is_replica_identity,\n    idx.indkey::smallint[] AS key_attributes,\n    idx.indcollation::integer[] AS collation,\n    idx.indclass::integer[] AS class,\n    idx.indoption::smallint[] AS options,\n    idx.indpred AS index_predicate,\n    obj_description(idx.indexrelid, 'pg_class') AS comment,\n    ix.indexdef as index_definition,\n    am.amname AS access_method,\n    jsonb_agg(\n      jsonb_build_object(\n        'attribute_number', a.attnum,\n        'attribute_name', a.attname,\n        'data_type', format_type(a.atttypid, a.atttypmod)\n      )\n      ORDER BY a.attnum\n    ) AS index_attributes\n  FROM\n    pg_index idx\n    JOIN pg_class c ON c.oid = idx.indexrelid\n    JOIN pg_namespace n ON c.relnamespace = n.oid\n    JOIN pg_am am ON c.relam = am.oid\n    JOIN pg_attribute a ON a.attrelid = c.oid AND a.attnum = ANY(idx.indkey)\n    JOIN pg_indexes ix ON c.relname = ix.indexname\n  GROUP BY\n    idx.indexrelid, idx.indrelid, n.nspname, idx.indnatts, idx.indnkeyatts, idx.indisunique, \n    idx.indisprimary, idx.indisexclusion, idx.indimmediate, idx.indisclustered, idx.indisvalid, \n    idx.indcheckxmin, idx.indisready, idx.indislive, idx.indisreplident, idx.indkey, \n    idx.indcollation, idx.indclass, idx.indoption, idx.indexprs, idx.indpred, ix.indexdef, am.amname\n",eC=l.z.object({id:l.z.number(),table_id:l.z.number(),schema:l.z.string(),number_of_attributes:l.z.number(),number_of_key_attributes:l.z.number(),is_unique:l.z.boolean(),is_primary:l.z.boolean(),is_exclusion:l.z.boolean(),is_immediate:l.z.boolean(),is_clustered:l.z.boolean(),is_valid:l.z.boolean(),check_xmin:l.z.boolean(),is_ready:l.z.boolean(),is_live:l.z.boolean(),is_replica_identity:l.z.boolean(),key_attributes:l.z.array(l.z.number()),collation:l.z.array(l.z.number()),class:l.z.array(l.z.number()),options:l.z.array(l.z.number()),index_predicate:l.z.string().nullable(),comment:l.z.string().nullable(),index_definition:l.z.string(),access_method:l.z.string(),index_attributes:l.z.array(l.z.object({attribute_number:l.z.number(),attribute_name:l.z.string(),data_type:l.z.string()}))}),eD=l.z.array(eC),eL=l.z.optional(eC),eO=l.z.object({grantor:l.z.string(),grantee:l.z.string(),privilege_type:l.z.union([l.z.literal("SELECT"),l.z.literal("INSERT"),l.z.literal("UPDATE"),l.z.literal("REFERENCES")]),is_grantable:l.z.boolean()}),eF=l.z.object({column_id:l.z.string(),relation_schema:l.z.string(),relation_name:l.z.string(),column_name:l.z.string(),privileges:l.z.array(eO)}),ek=l.z.array(eF);l.z.object({columnId:l.z.string(),grantee:l.z.string(),privilegeType:l.z.union([l.z.literal("ALL"),l.z.literal("SELECT"),l.z.literal("INSERT"),l.z.literal("UPDATE"),l.z.literal("REFERENCES")]),isGrantable:l.z.boolean().optional()});let eP={roles:{list:function(){let{includeDefaultRoles:e=!1,limit:t,offset:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a="\nwith\n  roles as (".concat(i,")\nselect\n  *\nfrom\n  roles\nwhere\n  true\n");return e||(a+=" and not pg_catalog.starts_with(name, 'pg_')"),t&&(a+=" limit ".concat(t)),n&&(a+=" offset ".concat(n)),{sql:a,zod:c}},retrieve:function(e){return{sql:"with roles as (".concat(i,") select * from roles where ").concat(u(e),";"),zod:d}},create:function(e){let{name:t,isSuperuser:n=!1,canCreateDb:a=!1,canCreateRole:o=!1,inheritRole:i=!0,canLogin:l=!1,isReplicationRole:s=!1,canBypassRls:c=!1,connectionLimit:d=-1,password:u,validUntil:m,memberOf:p=[],members:g=[],admins:f=[],config:h={}}=e;return{sql:"\ncreate role ".concat((0,r.bD)(t),"\n  ").concat(n?"superuser":"","\n  ").concat(a?"createdb":"","\n  ").concat(o?"createrole":"","\n  ").concat(i?"":"noinherit","\n  ").concat(l?"login":"","\n  ").concat(s?"replication":"","\n  ").concat(c?"bypassrls":"","\n  connection limit ").concat(d,"\n  ").concat(void 0===u?"":"password ".concat((0,r.eu)(u)),"\n  ").concat(void 0===m?"":"valid until ".concat((0,r.eu)(m)),"\n  ").concat(0===p.length?"":"in role ".concat(p.map(r.bD).join(",")),"\n  ").concat(0===g.length?"":"role ".concat(g.map(r.bD).join(",")),"\n  ").concat(0===f.length?"":"admin ".concat(f.map(r.bD).join(",")),"\n  ;\n").concat(Object.entries(h).map(e=>{let[n,a]=e;return"alter role ".concat((0,r.bD)(t)," set ").concat((0,r.bD)(n)," = ").concat((0,r.eu)(a),";")}).join("\n"),"\n")}},update:function(e,t){let{name:n,isSuperuser:a,canCreateDb:o,canCreateRole:l,inheritRole:s,canLogin:c,isReplicationRole:d,canBypassRls:m,connectionLimit:p,password:g,validUntil:f}=t;return{sql:"\ndo $$\ndeclare\n  old record;\nbegin\n  with roles as (".concat(i,")\n  select * into old from roles where ").concat(u(e),";\n  if old is null then\n    raise exception 'Cannot find role with id %', id;\n  end if;\n\n  execute(format('alter role %I\n    ").concat(void 0===a?"":a?"superuser":"nosuperuser","\n    ").concat(void 0===o?"":o?"createdb":"nocreatedb","\n    ").concat(void 0===l?"":l?"createrole":"nocreaterole","\n    ").concat(void 0===s?"":s?"inherit":"noinherit","\n    ").concat(void 0===c?"":c?"login":"nologin","\n    ").concat(void 0===d?"":d?"replication":"noreplication","\n    ").concat(void 0===m?"":m?"bypassrls":"nobypassrls","\n    ").concat(void 0===p?"":"connection limit ".concat(p),"\n    ").concat(void 0===g?"":"password ".concat((0,r.eu)(g)),"\n    ").concat(void 0===f?"":"valid until %L","\n  ', old.name").concat(void 0===f?"":", ".concat((0,r.eu)(f)),"));\n\n  ").concat(void 0===n?"":"\n  -- Using the same name in the rename clause gives an error, so only do it if the new name is different.\n  if ".concat((0,r.eu)(n)," != old.name then\n    execute(format('alter role %I rename to %I;', old.name, ").concat((0,r.eu)(n),"));\n  end if;\n  "),"\nend\n$$;\n")}},remove:function(e){let{ifExists:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"\ndo $$\ndeclare\n  old record;\nbegin\n  with roles as (".concat(i,")\n  select * into old from roles where ").concat(u(e),";\n  if old is null then\n    raise exception 'Cannot find role with id %', id;\n  end if;\n\n  execute(format('drop role ").concat(t?"if exists":""," %I;', old.name));\nend\n$$;\n")}},zod:s},columns:{list:function(){let{tableId:e,includeSystemSchemas:t=!1,includedSchemas:n,excludedSchemas:a,limit:o,offset:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l="\nwith\n  columns as (".concat(f,")\nselect\n  *\nfrom\n  columns\nwhere\n true\n"),s=g(n,a,t?void 0:m);return s&&(l+=" and schema ".concat(s)),void 0!==e&&(l+=" and table_id = ".concat((0,r.eu)(e)," ")),o&&(l="".concat(l," limit ").concat(o)),i&&(l="".concat(l," offset ").concat(i)),{sql:l,zod:b}},retrieve:function(e){return{sql:"WITH columns AS (".concat(f,") SELECT * FROM columns WHERE ").concat(function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema&&e.table)return"schema = ".concat((0,r.eu)(e.schema)," AND ").concat((0,r.bD)("table")," = ").concat((0,r.eu)(e.table)," AND name = ").concat((0,r.eu)(e.name));throw Error("Must provide either id or schema, name and table")}(e),";"),zod:_}},create:function(e){let{schema:t,table:n,name:a,type:o,default_value:i,default_value_format:l="literal",is_identity:s=!1,identity_generation:c="BY DEFAULT",is_nullable:d,is_primary_key:u=!1,is_unique:m=!1,comment:p,check:g}=e,f="";if(s){if(void 0!==i)throw Error("Columns cannot both be identity and have a default value");f="GENERATED ".concat(c," AS IDENTITY")}else void 0===i||(f="expression"===l?"DEFAULT ".concat(i):"DEFAULT ".concat((0,r.eu)(i)));let h="";void 0!==d&&(h=d?"NULL":"NOT NULL");let b=void 0===p?"":"COMMENT ON COLUMN ".concat((0,r.bD)(t),".").concat((0,r.bD)(n),".").concat((0,r.bD)(a)," IS ").concat((0,r.eu)(p));return{sql:"\nBEGIN;\n  ALTER TABLE ".concat((0,r.bD)(t),".").concat((0,r.bD)(n)," ADD COLUMN ").concat((0,r.bD)(a)," ").concat(v(o),"\n    ").concat(f,"\n    ").concat(h,"\n    ").concat(u?"PRIMARY KEY":"","\n    ").concat(m?"UNIQUE":"","\n    ").concat(void 0===g?"":"CHECK (".concat(g,")"),";\n  ").concat(b,";\nCOMMIT;")}},update:function(e,t){let n,a,{name:o,type:i,drop_default:l=!1,default_value:s,default_value_format:c="literal",is_identity:d,identity_generation:u="BY DEFAULT",is_nullable:m,is_unique:p,comment:g,check:f}=t,h=void 0===o||o===e.name?"":"ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," RENAME COLUMN ").concat((0,r.bD)(e.name)," TO ").concat((0,r.bD)(o),";"),b=void 0===i?"":"ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name)," SET DATA TYPE ").concat(v(i)," USING ").concat((0,r.bD)(e.name),"::").concat(v(i),";");if(l)n="ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name)," DROP DEFAULT;");else if(void 0===s)n="";else{let t="expression"===c?s:(0,r.eu)(s);n="ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name)," SET DEFAULT ").concat(t,";")}let _="ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name));!1===d?_+=" DROP IDENTITY IF EXISTS;":!0===e.is_identity?void 0===u?_="":_+=" SET GENERATED ".concat(u,";"):void 0===d?_="":_+=" ADD GENERATED ".concat(u," AS IDENTITY;"),a=void 0===m?"":m?"ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name)," DROP NOT NULL;"):"ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ALTER COLUMN ").concat((0,r.bD)(e.name)," SET NOT NULL;");let y="";!0===e.is_unique&&!1===p?y="\nDO $$\nDECLARE\n  r record;\nBEGIN\n  FOR r IN\n    SELECT conname FROM pg_constraint WHERE\n      contype = 'u'\n      AND cardinality(conkey) = 1\n      AND conrelid = ".concat((0,r.eu)(e.table_id),"\n      AND conkey[1] = ").concat((0,r.eu)(e.ordinal_position),"\n  LOOP\n    EXECUTE ").concat((0,r.eu)("ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," DROP CONSTRAINT "))," || quote_ident(r.conname);\n  END LOOP;\nEND\n$$;\n"):!1===e.is_unique&&!0===p&&(y="ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ADD UNIQUE (").concat((0,r.bD)(e.name),");"));let E=void 0===g?"":"COMMENT ON COLUMN ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table),".").concat((0,r.bD)(e.name)," IS ").concat((0,r.eu)(g),";"),A=void 0===f?"":"\nDO $$\nDECLARE\n  v_conname name;\n  v_conkey int2[];\nBEGIN\n  SELECT conname into v_conname FROM pg_constraint WHERE\n    contype = 'c'\n    AND cardinality(conkey) = 1\n    AND conrelid = ".concat((0,r.eu)(e.table_id),"\n    AND conkey[1] = ").concat((0,r.eu)(e.ordinal_position),"\n    ORDER BY oid asc\n    LIMIT 1;\n\n  IF v_conname IS NOT NULL THEN\n    EXECUTE format('ALTER TABLE ").concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," DROP CONSTRAINT %I', v_conname);\n  END IF;\n\n  ").concat(null!==f?"\n  ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," ADD CONSTRAINT ").concat((0,r.bD)("".concat(e.table,"_").concat(e.name,"_check"))," CHECK (").concat(f,");\n\n  SELECT conkey into v_conkey FROM pg_constraint WHERE conname = ").concat((0,r.eu)("".concat(e.table,"_").concat(e.name,"_check")),";\n\n  ASSERT v_conkey IS NOT NULL, 'error creating column constraint: check condition must refer to this column';\n  ASSERT cardinality(v_conkey) = 1, 'error creating column constraint: check condition cannot refer to multiple columns';\n  ASSERT v_conkey[1] = ").concat((0,r.eu)(e.ordinal_position),", 'error creating column constraint: check condition cannot refer to other columns';\n"):"","\nEND\n$$;\n");return{sql:"\nBEGIN;\n  ".concat(a,"\n  ").concat(b,"\n  ").concat(n,"\n  ").concat(_,"\n  ").concat(y,"\n  ").concat(E,"\n  ").concat(A,"\n  ").concat(h,"\nCOMMIT;")}},remove:function(e){let{cascade:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"ALTER TABLE ".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)," DROP COLUMN ").concat((0,r.bD)(e.name)," ").concat(t?"CASCADE":"RESTRICT",";")}},zod:h},schemas:{list:function(){let{includeSystemSchemas:e=!1,limit:t,offset:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=y;return e||(a="".concat(a," and not (n.nspname in (").concat(m.map(r.eu).join(","),"))")),t&&(a="".concat(a," limit ").concat(t)),n&&(a="".concat(a," offset ").concat(n)),{sql:a,zod:A}},retrieve:function(e){let{id:t,name:n}=e;return t?{sql:"".concat(y," and n.oid = ").concat((0,r.eu)(t),";"),zod:w}:{sql:"".concat(y," and n.nspname = ").concat((0,r.eu)(n),";"),zod:w}},create:function(e){let{name:t,owner:n}=e;return{sql:"create schema ".concat((0,r.bD)(t),"\n  ").concat(void 0===n?"":"authorization ".concat((0,r.bD)(n)),";\n")}},update:function(e,t){let{id:n,name:a}=e,{name:o,owner:i}=t;return{sql:"\ndo $$\ndeclare\n  id oid := ".concat(void 0===n?"".concat((0,r.eu)(a),"::regnamespace"):(0,r.eu)(n),";\n  old record;\n  new_name text := ").concat(void 0===o?null:(0,r.eu)(o),";\n  new_owner text := ").concat(void 0===i?null:(0,r.eu)(i),";\nbegin\n  select * into old from pg_namespace where oid = id;\n  if old is null then\n    raise exception 'Cannot find schema with id %', id;\n  end if;\n\n  if new_owner is not null then\n    execute(format('alter schema %I owner to %I;', old.nspname, new_owner));\n  end if;\n\n  -- Using the same name in the rename clause gives an error, so only do it if the new name is different.\n  if new_name is not null and new_name != old.nspname then\n    execute(format('alter schema %I rename to %I;', old.nspname, new_name));\n  end if;\nend\n$$;\n")}},remove:function(e){let{id:t,name:n}=e,{cascade:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"\ndo $$\ndeclare\n  id oid := ".concat(void 0===t?"".concat((0,r.eu)(n),"::regnamespace"):(0,r.eu)(t),";\n  old record;\n  cascade bool := ").concat((0,r.eu)(a),";\nbegin\n  select * into old from pg_namespace where oid = id;\n  if old is null then\n    raise exception 'Cannot find schema with id %', id;\n  end if;\n\n  execute(format('drop schema %I %s;', old.nspname, case when cascade then 'cascade' else 'restrict' end));\nend\n$$;\n")}},zod:E},tables:a,functions:o,tablePrivileges:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="\nwith table_privileges as (".concat($,")\nselect *\nfrom table_privileges\n"),i=g(t,n,e?void 0:m);return i&&(r+=" where schema ".concat(i)),a&&(r+=" limit ".concat(a)),o&&(r+=" offset ".concat(o)),{sql:r,zod:J}},retrieve:function(e){let{id:t,name:n,schema:a="public"}=e;return t?{sql:"\nwith table_privileges as (".concat($,")\nselect *\nfrom table_privileges\nwhere table_privileges.relation_id = ").concat((0,r.eu)(t),";"),zod:K}:{sql:"\nwith table_privileges as (".concat($,")\nselect *\nfrom table_privileges\nwhere table_privileges.schema = ").concat((0,r.eu)(a),"\n  and table_privileges.name = ").concat((0,r.eu)(n),"\n"),zod:K}},grant:function(e){return{sql:"\ndo $$\nbegin\n".concat(e.map(e=>{let{privilegeType:t,relationId:n,grantee:a,isGrantable:o}=e;return"execute format('grant ".concat(t," on table %s to ").concat("public"===a.toLowerCase()?"public":(0,r.bD)(a)," ").concat(o?"with grant option":"","', ").concat(n,"::regclass);")}).join("\n"),"\nend $$;\n")}},revoke:function(e){return{sql:"\ndo $$\nbegin\n".concat(e.map(e=>{let{privilegeType:t,relationId:n,grantee:a}=e;return"execute format('revoke ".concat(t," on table %s from ").concat("public"===a.toLowerCase()?"public":(0,r.bD)(a),"', ").concat(n,"::regclass);")}).join("\n"),"\nend $$;\n")}},zod:V},publications:{list:function(){let{limit:e,offset:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="with publications as (".concat(X,") select * from publications");return e&&(n+=" limit ".concat(e)),t&&(n+=" offset ".concat(t)),{sql:n,zod:ee}},retrieve:function(e){return{sql:"with publications as (".concat(X,") select * from publications where ").concat(function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name));throw Error("Must provide either id or name")}(e),";"),zod:et}},create:function(e){let t,{name:n,publish_insert:a=!1,publish_update:o=!1,publish_delete:i=!1,publish_truncate:l=!1,tables:s=null}=e;t=null==s?"FOR ALL TABLES":0===s.length?"":"FOR TABLE ".concat(s.map(e=>{if(!e.includes("."))return(0,r.bD)(e);let[t,...n]=e.split("."),a=n.join(".");return"".concat((0,r.bD)(t),".").concat((0,r.bD)(a))}).join(","));let c=[];return a&&c.push("insert"),o&&c.push("update"),i&&c.push("delete"),l&&c.push("truncate"),{sql:"\nCREATE PUBLICATION ".concat((0,r.bD)(n)," ").concat(t,"\n  WITH (publish = '").concat(c.join(","),"');")}},update:function(e,t){let{name:n,owner:a,publish_insert:o,publish_update:i,publish_delete:l,publish_truncate:s,tables:c}=t;return{sql:"\ndo $$\ndeclare\n  id oid := ".concat((0,r.eu)(e),";\n  old record;\n  new_name text := ").concat(void 0===n?null:(0,r.eu)(n),";\n  new_owner text := ").concat(void 0===a?null:(0,r.eu)(a),";\n  new_publish_insert bool := ").concat(null!=o?o:null,";\n  new_publish_update bool := ").concat(null!=i?i:null,";\n  new_publish_delete bool := ").concat(null!=l?l:null,";\n  new_publish_truncate bool := ").concat(null!=s?s:null,";\n  new_tables text := ").concat(void 0===c?null:(0,r.eu)(null===c?"all tables":c.map(e=>{if(!e.includes("."))return(0,r.bD)(e);let[t,...n]=e.split("."),a=n.join(".");return"".concat((0,r.bD)(t),".").concat((0,r.bD)(a))}).join(",")),";\nbegin\n  select * into old from pg_publication where oid = id;\n  if old is null then\n    raise exception 'Cannot find publication with id %', id;\n  end if;\n\n  if new_tables is null then\n    null;\n  elsif new_tables = 'all tables' then\n    if old.puballtables then\n      null;\n    else\n      -- Need to recreate because going from list of tables <-> all tables with alter is not possible.\n      execute(format('drop publication %1$I; create publication %1$I for all tables;', old.pubname));\n    end if;\n  else\n    if old.puballtables then\n      -- Need to recreate because going from list of tables <-> all tables with alter is not possible.\n      execute(format('drop publication %1$I; create publication %1$I;', old.pubname));\n    elsif exists(select from pg_publication_rel where prpubid = id) then\n      execute(\n        format(\n          'alter publication %I drop table %s',\n          old.pubname,\n          (select string_agg(prrelid::regclass::text, ', ') from pg_publication_rel where prpubid = id)\n        )\n      );\n    end if;\n\n    -- At this point the publication must have no tables.\n\n    if new_tables != '' then\n      execute(format('alter publication %I add table %s', old.pubname, new_tables));\n    end if;\n  end if;\n\n  execute(\n    format(\n      'alter publication %I set (publish = %L);',\n      old.pubname,\n      concat_ws(\n        ', ',\n        case when coalesce(new_publish_insert, old.pubinsert) then 'insert' end,\n        case when coalesce(new_publish_update, old.pubupdate) then 'update' end,\n        case when coalesce(new_publish_delete, old.pubdelete) then 'delete' end,\n        case when coalesce(new_publish_truncate, old.pubtruncate) then 'truncate' end\n      )\n    )\n  );\n\n  execute(format('alter publication %I owner to %I;', old.pubname, coalesce(new_owner, old.pubowner::regrole::name)));\n\n  -- Using the same name in the rename clause gives an error, so only do it if the new name is different.\n  if new_name is not null and new_name != old.pubname then\n    execute(format('alter publication %I rename to %I;', old.pubname, coalesce(new_name, old.pubname)));\n  end if;\n\n  -- We need to retrieve the publication later, so we need a way to uniquely identify which publication this is.\n  -- We can't rely on id because it gets changed if it got recreated.\n  -- We use a temp table to store the unique name - DO blocks can't return a value.\n  create temp table pg_meta_publication_tmp (name) on commit drop as values (coalesce(new_name, old.pubname));\nend $$;\n")}},remove:function(e){return{sql:"DROP PUBLICATION IF EXISTS ".concat((0,r.bD)(e.name),";")}},zod:Z},extensions:{list:function(){let{limit:e,offset:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=en;return e&&(n="".concat(n," LIMIT ").concat(e)),t&&(n="".concat(n," OFFSET ").concat(t)),{sql:n,zod:eo}},retrieve:function(e){let{name:t}=e;return{sql:"".concat(en," WHERE name = ").concat((0,r.eu)(t),";"),zod:er}},create:function(e){let{name:t,schema:n,version:a,cascade:o=!1}=e;return{sql:"\nCREATE EXTENSION ".concat((0,r.bD)(t),"\n  ").concat(void 0===n?"":"SCHEMA ".concat((0,r.bD)(n)),"\n  ").concat(void 0===a?"":"VERSION ".concat((0,r.eu)(a)),"\n  ").concat(o?"CASCADE":"",";")}},update:function(e,t){let{update:n=!1,version:a,schema:o}=t,i="";n&&(i="ALTER EXTENSION ".concat((0,r.bD)(e)," UPDATE ").concat(void 0===a?"":"TO ".concat((0,r.eu)(a)),";"));let l=void 0===o?"":"ALTER EXTENSION ".concat((0,r.bD)(e)," SET SCHEMA ").concat((0,r.bD)(o),";");return{sql:"BEGIN; ".concat(i," ").concat(l," COMMIT;")}},remove:function(e){let{cascade:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"DROP EXTENSION ".concat((0,r.bD)(e)," ").concat(t?"CASCADE":"RESTRICT",";")}},zod:ea},config:{list:function(){let{limit:e,offset:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="\nSELECT\n  name,\n  setting,\n  category,\n  TRIM(split_part(category, '/', 1)) AS group,\n  TRIM(split_part(category, '/', 2)) AS subgroup,\n  unit,\n  short_desc,\n  extra_desc,\n  context,\n  vartype,\n  source,\n  min_val,\n  max_val,\n  enumvals,\n  boot_val,\n  reset_val,\n  sourcefile,\n  sourceline,\n  pending_restart\nFROM\n  pg_settings\nORDER BY\n  category,\n  name\n";return e&&(n+=" LIMIT ".concat(e)),t&&(n+=" OFFSET ".concat(t)),{sql:n,zod:el}},zod:ei},materializedViews:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o,includeColumns:r=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=eu({includeColumns:r}),l=g(t,n,e?void 0:m);return l&&(i+=" where schema ".concat(l)),a&&(i+=" limit ".concat(a)),o&&(i+=" offset ".concat(o)),{sql:i,zod:ec}},retrieve:function(e){let t=function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name)," and ").concat((0,r.bD)("schema")," = ").concat((0,r.eu)(e.schema));throw Error("Must provide either id or name and schema")}(e);return{sql:"".concat(eu({includeColumns:!0})," where ").concat(t,";"),zod:ed}},zod:es},foreignTables:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o,includeColumns:r=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=ef({includeColumns:r}),l=g(t,n,e?void 0:m);return l&&(i+=" where schema ".concat(l)),a&&(i+=" limit ".concat(a)),o&&(i+=" offset ".concat(o)),{sql:i,zod:ep}},retrieve:function(e){return{sql:"".concat(ef({includeColumns:!0})," where ").concat(function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name)," and ").concat((0,r.bD)("schema")," = ").concat((0,r.eu)(e.schema));throw Error("Must provide either id or name and schema")}(e),";"),zod:eg}},zod:em},views:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o,includeColumns:r=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=ev({includeColumns:r}),l=g(t,n,e?void 0:m);return l&&(i+=" where schema ".concat(l)),a&&(i+=" limit ".concat(a)),o&&(i+=" offset ".concat(o)),{sql:i,zod:eb}},retrieve:function(e){let t=function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name)," and ").concat((0,r.bD)("schema")," = ").concat((0,r.eu)(e.schema));throw Error("Must provide either id or name and schema")}(e);return{sql:"".concat(ev({includeColumns:!0})," where ").concat(t,";"),zod:e_}},zod:eh},policies:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="\n    with policies as (".concat(ey,")\n    select *\n    from policies\n    "),i=g(t,n,e?void 0:m);return i&&(r+="where schema ".concat(i)),a&&(r+=" limit ".concat(a)),o&&(r+=" offset ".concat(o)),{sql:r,zod:eA}},retrieve:function(e){return{sql:"with policies as (".concat(ey,") select * from policies where ").concat(function(e){if("id"in e&&e.id)return"id = ".concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.schema&&e.table)return"name = ".concat((0,r.eu)(e.name)," AND schema = ").concat((0,r.eu)(e.schema)," AND table = ").concat((0,r.eu)(e.table));throw Error("Must provide either id or name, schema and table")}(e),";"),zod:ew}},create:function(e){let{name:t,schema:n="public",table:a,definition:o,check:i,action:l="PERMISSIVE",command:s="ALL",roles:c=["public"]}=e;return{sql:"\ncreate policy ".concat((0,r.bD)(t)," on ").concat((0,r.bD)(n),".").concat((0,r.bD)(a),"\n  as ").concat(l,"\n  for ").concat(s,"\n  to ").concat(c.map(r.bD).join(","),"\n  ").concat(o?"using (".concat(o,")"):"","\n  ").concat(i?"with check (".concat(i,")"):"",";")}},update:function(e,t){let{name:n,definition:a,check:o,roles:i}=t,l="ALTER POLICY ".concat((0,r.bD)(e.name)," ON ").concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)),s=void 0===n?"":"".concat(l," RENAME TO ").concat((0,r.bD)(n),";"),c=void 0===a?"":"".concat(l," USING (").concat(a,");"),d=void 0===o?"":"".concat(l," WITH CHECK (").concat(o,");"),u=void 0===i?"":"".concat(l," TO ").concat(i.map(r.bD).join(","),";");return{sql:"BEGIN; ".concat(c," ").concat(d," ").concat(u," ").concat(s," COMMIT;")}},remove:function(e){return{sql:"DROP POLICY ".concat((0,r.bD)(e.name)," ON ").concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table),";")}},zod:eE},triggers:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="with triggers as (".concat(ex,") select * from triggers"),i=g(t,n,e?void 0:m);return i&&(r+=" where schema ".concat(i)),a&&(r+=" limit ".concat(a)),o&&(r+=" offset ".concat(o)),{sql:r,zod:eN}},retrieve:function(e){let t=function(e){if("id"in e&&e.id)return"".concat((0,r.bD)("id")," = ").concat((0,r.eu)(e.id));if("name"in e&&e.name&&e.table&&e.schema)return"".concat((0,r.bD)("name")," = ").concat((0,r.eu)(e.name)," and ").concat((0,r.bD)("schema")," = ").concat((0,r.eu)(e.schema)," and ").concat((0,r.bD)("table")," = ").concat((0,r.eu)(e.table));throw Error("Must provide either id or name, schema and table")}(e);return{sql:"with triggers as (".concat(ex,") select * from triggers where ").concat(t,";"),zod:eS}},create:function(e){let{name:t,schema:n="public",table:a,function_schema:o="public",function_name:i,function_args:s=[],activation:c,events:d,orientation:u,condition:m}=e,p="".concat((0,r.bD)(n),".").concat((0,r.bD)(a)),g="".concat((0,r.bD)(o),".").concat((0,r.bD)(i)),f=d.join(" or "),h=s.map(r.eu).join(",");return{sql:"create trigger ".concat((0,r.bD)(t)," ").concat(c," ").concat(f," on ").concat(p," ").concat(u?"for each ".concat(u):""," ").concat(m?"when (".concat(m,")"):""," execute function ").concat(g,"(").concat(h,");"),zod:l.z.void()}},update:function(e,t){let n="".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table)),a="";switch(t.enabled_mode){case"ORIGIN":a="alter table ".concat(n," enable trigger ").concat((0,r.bD)(e.name),";");break;case"DISABLED":a="alter table ".concat(n," disable trigger ").concat((0,r.bD)(e.name),";");break;case"REPLICA":case"ALWAYS":a="alter table ".concat(n," enable ").concat(t.enabled_mode," trigger ").concat((0,r.bD)(e.name),";")}let o=t.name&&t.name!==e.name?"alter trigger ".concat((0,r.bD)(e.name)," on ").concat(n," rename to ").concat((0,r.bD)(t.name),";"):"";return{sql:"begin; ".concat(a,"; ").concat(o,"; commit;"),zod:l.z.void()}},remove:function(e){let{cascade:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat((0,r.bD)(e.schema),".").concat((0,r.bD)(e.table));return{sql:"drop trigger ".concat((0,r.bD)(e.name)," on ").concat(n," ").concat(t?"cascade":"",";"),zod:l.z.void()}},zod:eT},types:{list:function(){let{includeArrayTypes:e=!1,includeSystemSchemas:t=!1,includedSchemas:n,excludedSchemas:a,limit:o,offset:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i="\nselect\n  t.oid::int8 as id,\n  t.typname as name,\n  n.nspname as schema,\n  format_type (t.oid, null) as format,\n  coalesce(t_enums.enums, '[]') as enums,\n  coalesce(t_attributes.attributes, '[]') as attributes,\n  obj_description (t.oid, 'pg_type') as comment\nfrom\n  pg_type t\n  left join pg_namespace n on n.oid = t.typnamespace\n  left join (\n    select\n      enumtypid,\n      jsonb_agg(enumlabel order by enumsortorder) as enums\n    from\n      pg_enum\n    group by\n      enumtypid\n  ) as t_enums on t_enums.enumtypid = t.oid\n  left join (\n    select\n      oid,\n      jsonb_agg(\n        jsonb_build_object('name', a.attname, 'type_id', a.atttypid::int8)\n        order by a.attnum asc\n      ) as attributes\n    from\n      pg_class c\n      join pg_attribute a on a.attrelid = c.oid\n    where\n      c.relkind = 'c' and not a.attisdropped\n    group by\n      c.oid\n  ) as t_attributes on t_attributes.oid = t.typrelid\nwhere\n  (\n    t.typrelid = 0\n    or (\n      select\n        c.relkind = 'c'\n      from\n        pg_class c\n      where\n        c.oid = t.typrelid\n    )\n  )\n";e||(i+=" and not exists (\n      select from pg_type el\n      where el.oid = t.typelem\n        and el.typarray = t.oid\n    )");let l=g(n,a,t?void 0:m);return l&&(i+=" and n.nspname ".concat(l)),o&&(i+=" limit ".concat(o)),r&&(i+=" offset ".concat(r)),{sql:i,zod:eR}},zod:eI},version:{retrieve:function(){return{sql:"\nselect\n  version(),\n  current_setting('server_version_num')::int8 as version_number,\n  (\n    select\n      count(*) as active_connections\n    from\n      pg_stat_activity\n  ) as active_connections,\n  current_setting('max_connections')::int8 as max_connections\n",zod:ez}},zod:ez},indexes:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,limit:a,offset:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="\n    with indexes as (".concat(ej,")\n    select *\n    from indexes\n  "),i=g(t,n,e?void 0:m);return i&&(r+=" where schema ".concat(i)),a&&(r+=" limit ".concat(a)),o&&(r+=" offset ".concat(o)),{sql:r,zod:eD}},retrieve:function(e){let{id:t}=e;return{sql:"\n    with indexes as (".concat(ej,")\n    select *\n    from indexes\n    where id = ").concat((0,r.eu)(t),";\n  "),zod:eL}},zod:eC},columnPrivileges:{list:function(){let{includeSystemSchemas:e=!1,includedSchemas:t,excludedSchemas:n,columnIds:a,limit:o,offset:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l="\n  with column_privileges as (".concat("\n-- Lists each column's privileges in the form of:\n--\n-- [\n--   {\n--     \"column_id\": \"12345.1\",\n--     \"relation_schema\": \"public\",\n--     \"relation_name\": \"mytable\",\n--     \"column_name\": \"mycolumn\",\n--     \"privileges\": [\n--       {\n--         \"grantor\": \"postgres\",\n--         \"grantee\": \"myrole\",\n--         \"privilege_type\": \"SELECT\",\n--         \"is_grantable\": false\n--       },\n--       ...\n--     ]\n--   },\n--   ...\n-- ]\n--\n-- Modified from information_schema.column_privileges. We try to be as close as\n-- possible to the view definition, obtained from:\n--\n-- select pg_get_viewdef('information_schema.column_privileges');\n--\n-- The main differences are:\n-- - we include column privileges for materialized views\n--   (reason for exclusion in information_schema.column_privileges:\n--    https://www.postgresql.org/message-id/9136.1502740844%40sss.pgh.pa.us)\n-- - we query a.attrelid and a.attnum to generate column_id\n-- - table_catalog is omitted\n-- - table_schema -> relation_schema, table_name -> relation_name\n--\n-- Column privileges are intertwined with table privileges in that table\n-- privileges override column privileges. E.g. if we do:\n--\n-- grant all on mytable to myrole;\n--\n-- Then myrole is granted privileges for ALL columns. Likewise, if we do:\n--\n-- grant all (id) on mytable to myrole;\n-- revoke all on mytable from myrole;\n--\n-- Then the grant on the id column is revoked.\n--\n-- This is unlike how grants for schemas and tables interact, where you need\n-- privileges for BOTH the schema the table is in AND the table itself in order\n-- to access the table.\n\nselect (x.attrelid || '.' || x.attnum) as column_id,\n       nc.nspname as relation_schema,\n       x.relname as relation_name,\n       x.attname as column_name,\n       coalesce(\n         jsonb_agg(\n           jsonb_build_object(\n             'grantor', u_grantor.rolname,\n             'grantee', grantee.rolname,\n             'privilege_type', x.prtype,\n             'is_grantable', x.grantable\n           )\n         ),\n         '[]'\n       ) as privileges\nfrom\n  (select pr_c.grantor,\n          pr_c.grantee,\n          a.attrelid,\n          a.attnum,\n          a.attname,\n          pr_c.relname,\n          pr_c.relnamespace,\n          pr_c.prtype,\n          pr_c.grantable,\n          pr_c.relowner\n   from\n     (select pg_class.oid,\n             pg_class.relname,\n             pg_class.relnamespace,\n             pg_class.relowner,\n             (aclexplode(coalesce(pg_class.relacl, acldefault('r', pg_class.relowner)))).grantor as grantor,\n             (aclexplode(coalesce(pg_class.relacl, acldefault('r', pg_class.relowner)))).grantee as grantee,\n             (aclexplode(coalesce(pg_class.relacl, acldefault('r', pg_class.relowner)))).privilege_type as privilege_type,\n             (aclexplode(coalesce(pg_class.relacl, acldefault('r', pg_class.relowner)))).is_grantable as is_grantable\n      from pg_class\n      where (pg_class.relkind = any (array['r',\n                                           'v',\n                                           'm',\n                                           'f',\n                                           'p'])) ) pr_c(oid, relname, relnamespace, relowner, grantor, grantee, prtype, grantable),\n                                                    pg_attribute a\n   where ((a.attrelid = pr_c.oid)\n          and (a.attnum > 0)\n          and (not a.attisdropped))\n   union select pr_a.grantor,\n                pr_a.grantee,\n                pr_a.attrelid,\n                pr_a.attnum,\n                pr_a.attname,\n                c.relname,\n                c.relnamespace,\n                pr_a.prtype,\n                pr_a.grantable,\n                c.relowner\n   from\n     (select a.attrelid,\n             a.attnum,\n             a.attname,\n             (aclexplode(coalesce(a.attacl, acldefault('c', cc.relowner)))).grantor as grantor,\n             (aclexplode(coalesce(a.attacl, acldefault('c', cc.relowner)))).grantee as grantee,\n             (aclexplode(coalesce(a.attacl, acldefault('c', cc.relowner)))).privilege_type as privilege_type,\n             (aclexplode(coalesce(a.attacl, acldefault('c', cc.relowner)))).is_grantable as is_grantable\n      from (pg_attribute a\n            join pg_class cc on ((a.attrelid = cc.oid)))\n      where ((a.attnum > 0)\n             and (not a.attisdropped))) pr_a(attrelid, attnum, attname, grantor, grantee, prtype, grantable),\n                                        pg_class c\n   where ((pr_a.attrelid = c.oid)\n          and (c.relkind = any (ARRAY['r',\n                                      'v',\n                                      'm',\n                                      'f',\n                                      'p'])))) x,\n     pg_namespace nc,\n     pg_authid u_grantor,\n  (select pg_authid.oid,\n          pg_authid.rolname\n   from pg_authid\n   union all select (0)::oid as oid,\n                    'PUBLIC') grantee(oid, rolname)\nwhere ((x.relnamespace = nc.oid)\n       and (x.grantee = grantee.oid)\n       and (x.grantor = u_grantor.oid)\n       and (x.prtype = any (ARRAY['INSERT',\n                                  'SELECT',\n                                  'UPDATE',\n                                  'REFERENCES']))\n       and (pg_has_role(u_grantor.oid, 'USAGE')\n            or pg_has_role(grantee.oid, 'USAGE')\n            or (grantee.rolname = 'PUBLIC')))\ngroup by column_id,\n         nc.nspname,\n         x.relname,\n         x.attname\n",")\n  select *\n  from column_privileges\n  "),s=[],c=g(t,n,e?void 0:m);return c&&s.push("relation_schema ".concat(c)),(null==a?void 0:a.length)&&s.push("column_id in (".concat(a.map(r.eu).join(","),")")),s.length>0&&(l+=" where ".concat(s.join(" and "))),o&&(l+=" limit ".concat(o)),i&&(l+=" offset ".concat(i)),{sql:l,zod:ek}},grant:function(e){return{sql:"\ndo $$\ndeclare\n  col record;\nbegin\n".concat(e.map(e=>{let{privilegeType:t,columnId:n,grantee:a,isGrantable:o}=e,[i,l]=n.split(".");return"\nselect *\nfrom pg_attribute a\nwhere a.attrelid = ".concat((0,r.eu)(i),"\n  and a.attnum = ").concat((0,r.eu)(l),"\ninto col;\nexecute format(\n  'grant ").concat(t," (%I) on %s to ").concat("public"===a.toLowerCase()?"public":(0,r.bD)(a)," ").concat(o?"with grant option":"","',\n  col.attname,\n  col.attrelid::regclass\n);")}).join("\n"),"\nend $$;\n")}},revoke:function(e){return{sql:"\ndo $$\ndeclare\n  col record;\nbegin\n".concat(e.map(e=>{let{privilegeType:t,columnId:n,grantee:a}=e,[o,i]=n.split(".");return"\nselect *\nfrom pg_attribute a\nwhere a.attrelid = ".concat((0,r.eu)(o),"\n  and a.attnum = ").concat((0,r.eu)(i),"\ninto col;\nexecute format(\n  'revoke ").concat(t," (%I) on %s from ").concat("public"===a.toLowerCase()?"public":(0,r.bD)(a),"',\n  col.attname,\n  col.attrelid::regclass\n);")}).join("\n"),"\nend $$;\n")}},zod:eF},query:n(7164)}},18232:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var a=n(48678);n(97008);var o=n(32211),r=n(24542);async function i(e,t,n,i){var l,s,c;let d,u,{projectRef:m,connectionString:p,sql:g,queryKey:f,handleError:h,isRoleImpersonationEnabled:b=!1,isStatementTimeoutDisabled:_=!1}=e;if(!m)throw Error("projectRef is required");if(new Blob([g]).size>.98*o.MB)throw Error("Query is too large to be run via the SQL Editor");let v=new Headers(n);if(p&&v.set("x-connection-encrypted",p),i){let e=await i(g,v);"data"in e?d=e.data:u=e.error}else{let e=await (0,a.bE)("/platform/pg-meta/{ref}/query",{signal:t,params:{header:{"x-connection-encrypted":null!=p?p:""},path:{ref:m},query:{key:null!=(s=null==f?void 0:f.filter(e=>"string"==typeof e||"number"==typeof e).join("-"))?s:""}},body:{query:g,disable_statement_timeout:_},headers:v});d=e.data,u=e.error}if(u){if(b&&"object"==typeof u&&null!==u&&"error"in u&&"formattedError"in u){let e=u,t=/LINE (\d+):/im,[,n]=null!=(c=t.exec(e.error))?c:[],a=Number(n);isNaN(a)||(e={...e,error:e.error.replace(t,"LINE ".concat(a-r.Yt,":")),formattedError:e.formattedError.replace(t,"LINE ".concat(a-r.Yt,":"))}),u=e}if(void 0!==h)return h(u);(0,a.H4)(u)}return b&&Array.isArray(d)&&(null==d||null==(l=d[0])?void 0:l[r.BO])===1?{result:[]}:{result:d}}n(53169)},18971:(e,t,n)=>{"use strict";n.d(t,{JB:()=>o,Jn:()=>d,NA:()=>r,U1:()=>s,Uw:()=>c,Vl:()=>l,Vm:()=>a,ou:()=>i});var a=function(e){return e[e.WEEK=604800]="WEEK",e[e.MONTH=2592e3]="MONTH",e[e.YEAR=31536e3]="YEAR",e}({}),o=function(e){return e.COLUMNS="COLUMNS",e.LIST="LIST",e}({}),r=function(e){return e.NAME="name",e.UPDATED_AT="updated_at",e.CREATED_AT="created_at",e.LAST_ACCESSED_AT="last_accessed_at",e}({}),i=function(e){return e.ASC="asc",e.DESC="desc",e}({}),l=function(e){return e.BUCKET="BUCKET",e.FILE="FILE",e.FOLDER="FOLDER",e}({}),s=function(e){return e.READY="READY",e.LOADING="LOADING",e.EDITING="EDITING",e}({});let c={upload:["INSERT"],download:["SELECT"],list:["SELECT"],update:["SELECT","UPDATE"],move:["SELECT","UPDATE"],copy:["SELECT","INSERT"],remove:["SELECT","DELETE"],createSignedUrl:["SELECT"],createSignedUrls:["SELECT"],getPublicUrl:[]},d={STORAGE_COLUMN:"STORAGE_COLUMN",STORAGE_ITEM:"STORAGE_ITEM",STORAGE_FOLDER:"STORAGE_FOLDER"}},19070:(e,t,n)=>{"use strict";n.d(t,{GU:()=>f,IT:()=>g,Lh:()=>_,SE:()=>b,hl:()=>v});var a=n(25481),o=n(44900),r=n.n(o),i=n(49770),l=n(12378),s=n(3231),c=n(32211),d=n(45628),u=n(97008);let m=e=>"^".concat(e.replace(".","\\.").replace("%",".*"),"$");function p(e,t){return!e.filter(e=>e.restrictive).some(e=>{let{condition:n}=e;return null===n||r().apply(n,t)})&&e.filter(e=>!e.restrictive).some(e=>{let{condition:n}=e;return null===n||r().apply(n,t)})}function g(e,t,n,a,o,r){if(!e||!Array.isArray(e))return!1;if(r){let i=e.filter(e=>{var a;return e.organization_slug===o&&e.actions.some(e=>t?t.match(m(e)):null)&&e.resources.some(e=>n.match(m(e)))&&(null==(a=e.project_refs)?void 0:a.includes(r))});if(i.length>0)return p(i,{resource_name:n,...a})}return p(e.filter(e=>!e.project_refs||0===e.project_refs.length).filter(e=>e.organization_slug===o&&e.actions.some(e=>t?t.match(m(e)):null)&&e.resources.some(e=>n.match(m(e)))),{resource_name:n,...a})}function f(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return h(e,t,void 0,n)}function h(e,t,n){let a=!(arguments.length>3)||void 0===arguments[3]||arguments[3],{data:o,isLoading:r,isSuccess:i}=(0,l.m)({enabled:void 0===e&&a}),s=(0,d.a)({enabled:void 0===t&&a}),c=void 0===t?s:{slug:t},m=null==c?void 0:c.slug,p=(0,u.KT)({enabled:void 0===n&&a}),g=void 0===n||(null==p?void 0:p.parent_project_ref)?p:{ref:n,parent_project_ref:void 0};return{permissions:void 0===e?o:e,organizationSlug:m,projectRef:(null==g?void 0:g.parent_project_ref)?g.parent_project_ref:null==g?void 0:g.ref,isLoading:r,isSuccess:i}}function b(e,t,n,o,r){return function(e,t,n,o){let r=(0,a.DB)(),{organizationSlug:i,projectRef:l,permissions:s}=null!=o?o:{},{permissions:d,organizationSlug:u,projectRef:m}=h(s,i,l,r);return!!r&&(!c.pe||g(d,e,t,n,u,m))}(e,t,n,{organizationSlug:o,projectRef:void 0,permissions:r})}function _(){let e=(0,a.DB)(),{isFetched:t}=(0,l.m)({enabled:e}),{isFetched:n}=(0,i.Ad)({enabled:e}),{ref:o}=(0,a.g)(),{isFetched:r}=(0,s.wT)({ref:o},{enabled:!!o&&e});return!c.pe||(o?e&&t&&n&&r:e&&t&&n)}function v(e,t,n,o){let r=(0,a.DB)(),{organizationSlug:i,projectRef:l,permissions:s}=null!=o?o:{},{permissions:d,organizationSlug:u,projectRef:m,isLoading:p,isSuccess:f}=h(s,i,l,r);return r?c.pe?{isLoading:p,isSuccess:f,can:g(d,e,t,n,u,m)}:{isLoading:!1,isSuccess:!0,can:!0}:{isLoading:!0,isSuccess:!1,can:!1}}},20160:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var a=n(56947),o=n(48678),r=n(82681);async function i(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:a,error:r}=await (0,o.Jt)("/v1/projects/{ref}/branches",{params:{path:{ref:n}},signal:t});if(r)if("Preview branching is not enabled for this project."===r.message)return[];else(0,o.H4)(r);return a}let l=function(e){let{projectRef:t}=e,{enabled:n=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(r.N.list(t),e=>{let{signal:n}=e;return i({projectRef:t},n)},{enabled:n&&void 0!==t,...o})}},24542:(e,t,n)=>{"use strict";n.d(t,{BO:()=>l,Nf:()=>s,Yt:()=>i,_p:()=>m,bL:()=>r});var a=n(35416);function o(){return Math.floor((Date.now()+36e5)/1e3)}function r(e,t){let n=o(),r=Math.floor(Date.now()/1e3);if("authenticated"===t.role){var i,l,s;if("native"===t.userType&&t.user){let o=t.user;return{aal:null!=(i=t.aal)?i:"aal1",amr:[{method:"password",timestamp:r}],app_metadata:o.raw_app_meta_data,aud:"authenticated",email:o.email,exp:n,iat:r,iss:"https://".concat(e,".supabase.co/auth/v1"),phone:o.phone,role:null!=(l=o.role)?l:t.role,session_id:(0,a.gZ)(),sub:o.id,user_metadata:o.raw_user_meta_data,is_anonymous:o.is_anonymous}}if("external"===t.userType&&t.externalAuth)return{aal:null!=(s=t.aal)?s:"aal1",aud:"authenticated",exp:n,iat:r,role:"authenticated",session_id:(0,a.gZ)(),sub:t.externalAuth.sub,...t.externalAuth.additionalClaims}}return{iss:"supabase",ref:e,role:t.role,iat:r,exp:n}}let i=11,l="ROLE_IMPERSONATION_NO_RESULTS";function s(e,t){var n;let{role:a,claims:r}=null!=t?t:{role:void 0,claims:void 0};if(void 0===a)return e;let i="postgrest"===a.type?void 0!==r?function(e,t){let n={...t,exp:o()};return"\nselect set_config('role', '".concat(e.role,"', true),\nset_config('request.jwt.claims', '").concat(JSON.stringify(n).replaceAll("'","''"),"', true),\nset_config('request.method', 'POST', true),\nset_config('request.path', '/impersonation-example-request-path', true),\nset_config('request.headers', '{\"accept\": \"*/*\"}', true);\n  ").trim()}(a,r):"":(n=a.role,"\n    set local role '".concat(n,"';\n  ").trim());return"\n    ".concat(i,'\n\n    -- If the users sql returns no rows, pg-meta will\n    -- fallback to returning the result of the impersonation sql.\n    select 1 as "').concat(l,'";\n\n    ').concat(e,"\n  ").trim()}function c(e){return new TextEncoder().encode(e)}function d(e){return btoa(String.fromCharCode(...new Uint8Array("string"==typeof e?c(e):e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function u(e,t){let n=d(c(JSON.stringify({alg:"HS256",typ:"JWT"})))+"."+d(c(JSON.stringify(e))),a=d(new Uint8Array(await window.crypto.subtle.sign({name:"HMAC"},await window.crypto.subtle.importKey("raw",c(t),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]),c(n))));return"".concat(n,".").concat(a)}function m(e,t,n){return u({...r(e,n),exp:o()},t)}},26822:(e,t,n)=>{"use strict";n.d(t,{N:()=>R});var a=n(80263),o=n(83927),r=n.n(o),i=n(880),l=n(1933),s=n(796),c=n(53239),d=n(89856),u=n(53535),m=n(82457),p=n(37263);let g=e=>({hljs:{display:"block",overflowX:"auto",color:e?"#ddd":"#888"},"hljs-tag":{color:"#569cd6"},"hljs-keyword":{color:"#569cd6",fontWeight:"normal"},"hljs-selector-tag":{color:"#569cd6",fontWeight:"normal"},"hljs-literal":{color:"#569cd6",fontWeight:"normal"},"hljs-strong":{color:"#569cd6"},"hljs-name":{color:"#569cd6"},"hljs-code":{color:"#66d9ef"},"hljs-class .hljs-title":{color:"gray"},"hljs-attribute":{color:"#bf79db"},"hljs-symbol":{color:"#bf79db"},"hljs-regexp":{color:"#bf79db"},"hljs-link":{color:"#bf79db"},"hljs-string":{color:"#3ECF8E"},"hljs-bullet":{color:"#3ECF8E"},"hljs-subst":{color:"#3ECF8E"},"hljs-title":{color:"#3ECF8E",fontWeight:"normal"},"hljs-section":{color:"#3ECF8E",fontWeight:"normal"},"hljs-emphasis":{color:"#3ECF8E"},"hljs-type":{color:"#3ECF8E",fontWeight:"normal"},"hljs-built_in":{color:"#3ECF8E"},"hljs-builtin-name":{color:"#3ECF8E"},"hljs-selector-attr":{color:"#3ECF8E"},"hljs-selector-pseudo":{color:"#3ECF8E"},"hljs-addition":{color:"#3ECF8E"},"hljs-variable":{color:"#3ECF8E"},"hljs-template-tag":{color:"#3ECF8E"},"hljs-template-variable":{color:"#3ECF8E"},"hljs-comment":{color:e?"#999":"#888"},"hljs-quote":{color:"#75715e"},"hljs-deletion":{color:"#75715e"},"hljs-meta":{color:"#75715e"},"hljs-doctag":{fontWeight:"normal"},"hljs-selector-id":{fontWeight:"normal"}});var f=n(45327),h=n.n(f),b=n(70444),_=n(19041),v=n(55295),y=n(58572),E=n(55110),A=n(42657),w=n(60864),x=n(19387),T=n(85134),N=n(80712),S=n(26770),I=n(7945);let R=e=>{var t,n,o,f;let{title:R,language:z,linesToHighlight:j=[],highlightBorder:C,styleConfig:D,className:L,wrapperClassName:O,value:F,theme:k,children:P,hideCopy:M=!1,hideLineNumbers:U=!1,wrapLines:B=!0,renderer:q,focusable:G=!0,onCopyCallback:H=r()}=e,{resolvedTheme:Y}=(0,s.D)(),W=null==Y?void 0:Y.includes("dark"),$=null!=k?k:g(W),[V,J]=(0,c.useState)(!1),K=()=>{J(!0),H(),setTimeout(()=>{J(!1)},1e3)},X=c.Children.toArray(P),[Q]=1===X.length?X:[],Z=null!=(n=null!=F?F:"string"==typeof Q?Q:void 0)?n:P,ee="string"==typeof(Z=null!=(o=null==Z||null==(t=Z.trimEnd)?void 0:t.call(Z))?o:Z)&&Z.length<70?"short-inline-codeblock":"",et=z||(L?L.replace("language-",""):"js");"jsx"===et&&(et="js"),u.A.registerLanguage("js",A.A),u.A.registerLanguage("ts",I.A),u.A.registerLanguage("py",N.A),u.A.registerLanguage("sql",S.A),u.A.registerLanguage("bash",b.A),u.A.registerLanguage("dart",v.A),u.A.registerLanguage("csharp",_.A),u.A.registerLanguage("json",w.A),u.A.registerLanguage("kotlin",x.A),u.A.registerLanguage("curl",h()),u.A.registerLanguage("http",E.A),u.A.registerLanguage("php",T.A),u.A.registerLanguage("python",N.A),u.A.registerLanguage("go",y.A),("bash"===et||"sh"===et)&&(U=!0);let en=!U;return(0,a.jsxs)(a.Fragment,{children:[R&&(0,a.jsx)("div",{className:"text-sm rounded-t-md bg-surface-100 py-2 px-4 border border-b-0 border-default font-sans",children:R}),L?(0,a.jsxs)("div",{className:(0,m.cn)("group relative max-w-[90vw] md:max-w-none overflow-auto",O),children:[(0,a.jsx)(u.A,{suppressContentEditableWarning:!0,language:et,wrapLines:B,style:$,className:(0,m.cn)("code-block border border-surface p-4 w-full !my-0 !bg-surface-100 outline-none focus:border-foreground-lighter/50","".concat(R?"rounded-t-none rounded-b-md":"rounded-md"),"".concat(en?"":"pl-6"),L),customStyle:{fontSize:13,lineHeight:1.4},showLineNumbers:en,lineProps:e=>j.includes(e)?{style:{display:"block",backgroundColor:(null==D?void 0:D.highlightBackgroundColor)?null==D?void 0:D.highlightBackgroundColor:"hsl(var(--background-selection))",borderLeft:C?"1px solid ".concat((null==D?void 0:D.highlightBorderColor)?null==D?void 0:D.highlightBorderColor:"hsl(var(--foreground-default)",")"):null},class:"hljs-line-highlight"}:{},lineNumberContainerStyle:{paddingTop:"128px"},lineNumberStyle:{minWidth:"44px",paddingLeft:"4px",paddingRight:"4px",marginRight:"12px",color:null!=(f=null==D?void 0:D.lineNumber)?f:"#828282",textAlign:"center",fontSize:12,paddingTop:"4px",paddingBottom:"4px"},renderer:q,contentEditable:G,onBeforeInput:e=>(e.preventDefault(),!1),onKeyDown:e=>{if("Backspace"===e.code)return e.preventDefault(),!1},children:Z}),!M&&(F||P)&&L?(0,a.jsx)("div",{className:["absolute right-2 top-2","opacity-0 group-hover:opacity-100 transition","".concat(W?"dark":"")].join(" "),children:(0,a.jsx)(d.CopyToClipboard,{text:F||P,children:(0,a.jsx)(p.$,{type:"default",className:"px-1.5",icon:V?(0,a.jsx)(i.A,{}):(0,a.jsx)(l.A,{}),onClick:()=>K(),children:V?"Copied":""})})}):null]}):(0,a.jsx)("code",{className:ee,children:F||P})]})}},28763:(e,t,n)=>{"use strict";n.d(t,{Go:()=>l,Mh:()=>o,TV:()=>r,Z1:()=>s,oR:()=>c,yN:()=>i});var a=n(63295);function o(e,t){let n="select count(*) from ".concat(m(e)),{filters:a}=null!=t?t:{};return a&&(n=d(n,a)),n+";"}function r(e,t){let n="truncate ".concat(m(e)),{cascade:a}=null!=t?t:{};return a&&(n+=" cascade"),n+";"}function i(e,t,n){if(!t||0===t.length)throw Error("no filters for this delete query");let o="delete from ".concat(m(e)),{returning:r,enumArrayColumns:i}=null!=n?n:{};return t&&(o=d(o,t)),r&&(o+=void 0===i||0===i.length?" returning *":" returning *, ".concat(i.map(e=>"".concat((0,a.bD)(e),"::text[]")).join(","))),o+";"}function l(e,t,n){if(!t||0===t.length)throw Error("no value to insert");let{returning:o,enumArrayColumns:r}=null!=n?n:{},i=Object.keys(t[0]).map(e=>(0,a.bD)(e)).join(","),l="";return l=0==i.length?(0,a.GP)("insert into %1$s select from jsonb_populate_recordset(null::%1$s, %2$s)",m(e),(0,a.eu)(JSON.stringify(t))):(0,a.GP)("insert into %1$s (%2$s) select %2$s from jsonb_populate_recordset(null::%1$s, %3$s)",m(e),i,(0,a.eu)(JSON.stringify(t))),o&&(l+=void 0===r||0===r.length?" returning *":" returning *, ".concat(r.map(e=>"".concat((0,a.bD)(e),"::text[]")).join(","))),l+";"}function s(e,t,n){var o;let r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l="";l+="select ".concat(null!=t?t:"*"," from ").concat(i?(o=e,"".concat((0,a.bD)(o.name))):m(e));let{filters:s,pagination:c,sorts:u}=null!=n?n:{};if(s&&(l=d(l,s)),u&&(l=function(e,t){let n=t.filter(e=>e.column);return 0===n.length?e:e+=" order by ".concat(n.map(e=>{let t=e.ascending?"asc":"desc",n=e.nullsFirst?"nulls first":"nulls last";return"".concat((0,a.bD)(e.table),".").concat((0,a.bD)(e.column)," ").concat(t," ").concat(n)}).join(", "))}(l,u)),c){let{limit:e,offset:t}=null!=c?c:{};l+=" limit ".concat((0,a.eu)(e)," offset ").concat((0,a.eu)(t))}return"".concat(l).concat(r?";":"")}function c(e,t,n){let{filters:o,returning:r,enumArrayColumns:i}=null!=n?n:{};if(!o||0===o.length)throw Error("no filters for this update query");let l=Object.keys(t).map(e=>(0,a.bD)(e)).join(","),s=(0,a.GP)("update %1$s set (%2$s) = (select %2$s from json_populate_record(null::%1$s, %3$s))",m(e),l,(0,a.eu)(JSON.stringify(t)));return o&&(s=d(s,o)),r&&(s+=void 0===i||0===i.length?" returning *":" returning *, ".concat(i.map(e=>"".concat((0,a.bD)(e),"::text[]")).join(","))),s+";"}function d(e,t){return 0===t.length?e:e+=" where ".concat(t.map(e=>{switch(e.operator){case"in":var t;let n;return n=Array.isArray((t=e).value)?t.value.map(e=>u(e)):String(t.value).split(",").map(e=>u(e)),"".concat((0,a.bD)(t.column)," ").concat(t.operator," (").concat(n.join(","),")");case"is":var o=e;let r=String(o.value);switch(r){case"null":case"false":case"true":case"not null":return"".concat((0,a.bD)(o.column)," ").concat(o.operator," ").concat(r);default:return"".concat((0,a.bD)(o.column)," ").concat(o.operator," ").concat(u(o.value))}default:return"".concat((0,a.bD)(e.column)," ").concat(e.operator," ").concat(u(e.value))}}).join(" and "))}function u(e){if("string"==typeof e&&!((null==e?void 0:e.startsWith("ARRAY["))&&(null==e?void 0:e.endsWith("]"))))return(0,a.eu)(e);return e}function m(e){return"".concat((0,a.bD)(e.schema),".").concat((0,a.bD)(e.name))}},31857:(e,t,n)=>{"use strict";n.d(t,{c:()=>r}),n(73969);var a=n(48678),o=n(32211);let r=async(e,t)=>{let{projectRef:n,bucketId:r,path:i,options:l}=e;if(!r)throw Error("bucketId is required");let s=await (0,a.tQ)("".concat(o.H$).concat(o.pe?"":"/platform","/storage/").concat(n,"/buckets/").concat(r,"/objects/download"),{path:i,options:l,abortSignal:t});if(s.error)throw s.error;return s}},34745:(e,t,n)=>{"use strict";n.d(t,{Jb:()=>o,OG:()=>r,yO:()=>i});var a=n(40897);let o=(e,t)=>{if(e<=0)return{value:0,unit:a.s.BYTES};let n=void 0!==t?Object.values(a.s).indexOf(t):Math.floor(Math.log(e)/Math.log(1024)),o=void 0!==t?n<0?0:n:n>3?3:n,r=Object.values(a.s)[o];return{value:e/Math.pow(1024,o),unit:r}},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.s.BYTES,n=Object.values(a.s).indexOf(t);return e<0||n<0?0:e*Math.pow(1024,n)};function i(e,t,n){let a=new URL(n?"".concat(t,"://").concat(n):"https://".concat(e,".supabase.co"));return a.pathname="/storage/v1/s3",a.toString()}},35644:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var a=n(80263),o=n(82457);function r(e){let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("animate-pulse rounded-md bg-muted",t),...n,"data-sentry-component":"Skeleton","data-sentry-source-file":"skeleton.tsx"})}},37785:(e,t,n)=>{"use strict";n.d(t,{RE:()=>u,UZ:()=>d});var a=n(80263),o=n(53239),r=n(56028),i=n(12532),l=n(25481);function s(){let e=(0,r.BX)({selectedDatabaseId:void 0,setSelectedDatabaseId:t=>{e.selectedDatabaseId=t}});return e}let c=(0,o.createContext)(s()),d=e=>{let{children:t}=e,n=(0,l.MF)(s);return(0,a.jsx)(c.Provider,{value:n,"data-sentry-element":"unknown","data-sentry-component":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"database-selector.tsx",children:t})};function u(e){let t=(0,o.useContext)(c);return(0,i.s)(t,e)}},40069:(e,t,n)=>{"use strict";n.d(t,{BM:()=>A,Qp:()=>b,Zj:()=>E,dI:()=>_});var a=n(80263),o=n(20785),r=n(83207),i=n(53239),l=n(68906),s=n(25481),c=n(71156),d=n(82457),u=n(85936),m=n(37263),p=n(73957),g=n(98923),f=n(87163),h=n(44574);function b(e){let{className:t}=e,n=(0,g.aP)(),r=(0,g.mM)();if(n)return(0,a.jsxs)("button",{className:(0,d.cn)("p-2 bg-overlay flex items-center gap-2 text-xs text-foreground-muted",t),onClick:r,"data-sentry-component":"Breadcrumb","data-sentry-source-file":"CommandMenu.tsx",children:[(0,a.jsx)(o.A,{width:12,height:12,"data-sentry-element":"ArrowLeft","data-sentry-source-file":"CommandMenu.tsx"}),n.name]})}let _=(0,i.forwardRef)((e,t)=>{let{children:n,className:o,...r}=e;return(0,a.jsx)(u.uB,{ref:t,className:(0,d.cn)("h-full w-full flex flex-col overflow-hidden","[&_[cmdk-group]]:px-2 [&_[cmdk-group]]:!bg-transparent [&_[cmdk-group-heading]]:!bg-transparent [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-border-stronger [&_[cmdk-input]]:h-12","[&_[cmdk-item]_svg]:h-5","[&_[cmdk-item]_svg]:w-5","[&_[cmdk-item]_svg]:stroke-1","[&_[cmdk-input-wrapper]_svg]:h-5","[&_[cmdk-input-wrapper]_svg]:w-5","[&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0",o),...r,children:n})});function v(e){let{resetErrorBoundary:t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("min-h-64","flex items-center justify-center"),"data-sentry-component":"CommandError","data-sentry-source-file":"CommandMenu.tsx",children:(0,a.jsxs)("div",{className:"p-10 flex flex-col items-center gap-6 mt-4",children:[(0,a.jsx)(r.A,{strokeWidth:1.5,size:40,"data-sentry-element":"AlertTriangle","data-sentry-source-file":"CommandMenu.tsx"}),(0,a.jsx)("p",{className:"text-lg text-center",children:"Sorry, looks like we're having some issues with the command menu!"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Please try again in a bit."}),(0,a.jsx)(m.$,{size:"tiny",type:"secondary",onClick:t,"data-sentry-element":"Button","data-sentry-source-file":"CommandMenu.tsx",children:"Try again?"})]})})}function y(e){let{children:t}=e,n=(0,g.ux)();return n?(0,a.jsx)(n,{"data-sentry-element":"PageComponent","data-sentry-component":"PageSwitch","data-sentry-source-file":"CommandMenu.tsx"}):(0,a.jsx)(_,{"data-sentry-element":"CommandWrapper","data-sentry-component":"PageSwitch","data-sentry-source-file":"CommandMenu.tsx",children:t})}function E(e){let{children:t}=e,n=(0,h.g0)(),a=(0,h.sU)(),o=i.Children.only(t);return o&&(0,i.isValidElement)(o)?(0,i.cloneElement)(o,{onClick:()=>{var e,t;a(!n),null==(e=(t=o.props).onOpen)||e.call(t,!n)},"aria-haspopup":"dialog","aria-expanded":n,"aria-controls":"command-menu-dialog-content",className:(0,d.cn)("h-10 px-4 py-2","inline-flex items-center justify-center","whitespace-nowrap","rounded-md border border-input bg-background","text-sm font-medium","hover:bg-accent hover:text-accent-foreground","ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","transition-colors",o.props.className)}):null}function A(e){let{children:t,trigger:n}=e,o=(0,h.g0)(),r=(0,h.sU)(),u=(0,s.dv)("sm"),m=(0,h.r)(),b=(0,g.aP)(),_=(0,g.mM)(),E=(0,f.I)(),A=(0,f.G)(),{ref:w}=function(e){let{toggleOpen:t}=e,{ref:n,handleTouchStart:a,handleTouchMove:o,handleTouchEnd:r}=(0,c.A)({onClose:t}),l=(0,h.xq)(),s=(0,i.useMemo)(()=>({handleTouchStart:a,handleTouchMove:o,handleTouchEnd:r}),[a,o,r]);return(0,i.useEffect)(()=>{l(s)},[s]),{ref:n}}({toggleOpen:()=>r(!o)});return(0,a.jsxs)(p.lG,{open:o,onOpenChange:r,"data-sentry-element":"Dialog","data-sentry-component":"CommandMenu","data-sentry-source-file":"CommandMenu.tsx",children:[n,(0,a.jsx)(p.Cf,{id:"command-menu-dialog-content",hideClose:!0,forceMount:!0,ref:w,onOpenAutoFocus:e=>u&&e.preventDefault(),onInteractOutside:()=>r(!1),onEscapeKeyDown:e=>(e.preventDefault(),E?A(""):b?_():r(!1)),size:m,className:(0,d.cn)("relative flex flex-col my-0 mx-auto rounded-t-lg overflow-hidden","h-[85dvh] mt-[15vh] md:max-h-[500px] md:mt-0 left-0 bottom-0 md:bottom-auto","!animate-in !slide-in-from-bottom-[85%] !duration-300","data-[state=closed]:!animate-out data-[state=closed]:!slide-out-to-bottom","!slide-in-from-left-[0%] :!slide-in-from-top-[0%]","!slide-out-to-left-[0%] !slide-out-to-top-[0%]","md:data-[state=open]:!slide-in-from-bottom-[0%] md:data-[state=closed]:!slide-out-to-bottom-[0%]","md:data-[state=open]:!zoom-in-95 md:data-[state=closed]:!zoom-out-95"),dialogOverlayProps:{className:(0,d.cn)("overflow-hidden flex data-closed:delay-100")},"data-sentry-element":"DialogContent","data-sentry-source-file":"CommandMenu.tsx",children:(0,a.jsx)(l.tH,{FallbackComponent:v,"data-sentry-element":"ErrorBoundary","data-sentry-source-file":"CommandMenu.tsx",children:(0,a.jsx)(y,{"data-sentry-element":"PageSwitch","data-sentry-source-file":"CommandMenu.tsx",children:t})})})]})}_.displayName=u.uB.displayName},40897:(e,t,n)=>{"use strict";n.d(t,{E:()=>a,s:()=>o});let a=0xc80000000;var o=function(e){return e.BYTES="bytes",e.KB="KB",e.MB="MB",e.GB="GB",e}({})},41804:(e,t,n)=>{"use strict";n.d(t,{Gm:()=>c,d6:()=>d});var a=n(60045),o=n(56947),r=n(48678),i=n(19070),l=n(1535);async function s(e,t){let{projectRef:n}=e;if(!n)throw Error("projectRef is required");let{data:a,error:o}=await (0,r.Jt)("/platform/projects/{ref}/settings",{params:{path:{ref:n}},signal:t});return o&&(0,r.H4)(o),a}let c=function(e){let{projectRef:t}=e,{enabled:n=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,i.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"*");return(0,o.I)(l.n.settingsV2(t),e=>{let{signal:n}=e;return s({projectRef:t},n)},{enabled:n&&void 0!==t,refetchInterval(e){var t;let n=null!=(t=null==e?void 0:e.service_api_keys)?t:[];return c&&(null==e?void 0:e.status)!=="INACTIVE"&&0===n.length?2e3:0},...r})},d=e=>{var t,n;return{anonKey:(null!=(t=null==e?void 0:e.service_api_keys)?t:[]).find(e=>"anon"===e.tags),serviceKey:(null!=(n=null==e?void 0:e.service_api_keys)?n:[]).find(e=>"service_role"===e.tags)}}},41930:e=>{e.exports={"popover-trigger-width":"popover_popover-trigger-width__O8y9q"}},45897:(e,t,n)=>{"use strict";n.d(t,{ME:()=>g,Qj:()=>h,RY:()=>f,_c:()=>_,sc:()=>b});var a=n(80263),o=n(53239),r=n(56028),i=n(12532),l=n(25481),s=n(18232),c=n(26413),d=n(97008),u=n(24542);function m(e,t){let n=(0,r.BX)({projectRef:e,role:void 0,claims:void 0,setRole:async(a,o)=>{let r=(null==a?void 0:a.type)==="postgrest"?(0,u.bL)(e,a):void 0;if((null==o?void 0:o.type)==="postgres"&&void 0!==r){let{schema:e,functionName:n}=o,a=await t.current({schema:e,functionName:n,claims:r});a&&(r=a)}n.role=a,r&&(n.claims=r)}});return n}let p=(0,o.createContext)(m("",{current:async()=>{}})),g=e=>{let{children:t}=e,n=(0,d.KT)();async function o(e){var t,a,o;let{schema:r,functionName:i,claims:l}=e,c={user_id:l.sub,claims:l,authentication_method:"password"},d=await (0,s.E)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,sql:"select ".concat(r,".").concat(i,"('").concat(JSON.stringify(c),"'::jsonb) as event;"),queryKey:["customize-access-token",null==n?void 0:n.ref]});return null==d||null==(o=d.result)||null==(a=o[0])||null==(t=a.event)?void 0:t.claims}let r=(0,c.A)(o),i=(0,l.MF)(()=>{var e;return m(null!=(e=null==n?void 0:n.ref)?e:"",r)});return(0,a.jsx)(p.Provider,{value:i,"data-sentry-element":"unknown","data-sentry-component":"RoleImpersonationStateContextProvider","data-sentry-source-file":"role-impersonation-state.tsx",children:t})};function f(e){let t=(0,o.useContext)(p);return(0,i.s)(t,e)}function h(){let e=(0,o.useContext)(p);return(0,o.useCallback)(()=>(0,r.P9)(e),[e])}function b(e){let t=(0,o.useContext)(p),n=(0,c.A)(e);(0,o.useEffect)(()=>(0,r.B1)(t,()=>{n.current((0,r.P9)(t).role)}),[t])}function _(e){return(null==e?void 0:e.type)==="postgrest"}},49508:(e,t,n)=>{"use strict";n.d(t,{ap:()=>u,by:()=>d,to:()=>l});var a=n(80263),o=n(53239),r=n(56028),i=n(12532);let l=100,s=()=>{let e=(0,r.BX)({rowsPerPage:l,setRowsPerPage:t=>{e.rowsPerPage=t},ui:{open:"none"},get sidePanel(){return"side-panel"===e.ui.open?e.ui.sidePanel:void 0},get confirmationDialog(){return"confirmation-dialog"===e.ui.open?e.ui.confirmationDialog:void 0},closeSidePanel:()=>{e.ui={open:"none"}},closeConfirmationDialog:()=>{e.ui={open:"none"}},onAddSchema:()=>{e.ui={open:"side-panel",sidePanel:{type:"schema",mode:"new"}}},onAddTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"new"}}},onEditTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"edit"}}},onDuplicateTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"duplicate"}}},onDeleteTable:()=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"table",isDeleteWithCascade:!1}}},onAddColumn:()=>{e.ui={open:"side-panel",sidePanel:{type:"column"}}},onEditColumn:t=>{e.ui={open:"side-panel",sidePanel:{type:"column",column:t}}},onDeleteColumn:t=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"column",column:t,isDeleteWithCascade:!1}}},onAddRow:()=>{e.ui={open:"side-panel",sidePanel:{type:"row"}}},onEditRow:t=>{e.ui={open:"side-panel",sidePanel:{type:"row",row:t}}},onDeleteRows:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{numRows:0,allRowsSelected:!1,callback:()=>{}},{numRows:a,allRowsSelected:o,callback:r}=n;e.ui={open:"confirmation-dialog",confirmationDialog:{type:"row",rows:t,numRows:a,allRowsSelected:o,callback:r}}},onExpandJSONEditor:t=>{e.ui={open:"side-panel",sidePanel:{type:"json",jsonValue:t}}},onExpandTextEditor:(t,n)=>{e.ui={open:"side-panel",sidePanel:{type:"cell",value:{column:t,row:n}}}},onEditForeignKeyColumnValue:t=>{e.ui={open:"side-panel",sidePanel:{type:"foreign-row-selector",foreignKey:t}}},onImportData:()=>{e.ui={open:"side-panel",sidePanel:{type:"csv-import"}}},toggleConfirmationIsWithCascade:t=>{"confirmation-dialog"===e.ui.open&&("column"===e.ui.confirmationDialog.type||"table"===e.ui.confirmationDialog.type)&&(e.ui.confirmationDialog.isDeleteWithCascade=null!=t?t:!e.ui.confirmationDialog.isDeleteWithCascade)}});return e},c=(0,o.createContext)(s()),d=e=>{let{children:t}=e,n=(0,o.useRef)(s()).current;return(0,a.jsx)(c.Provider,{value:n,"data-sentry-element":"unknown","data-sentry-component":"TableEditorStateContextProvider","data-sentry-source-file":"table-editor.tsx",children:t})},u=e=>{let t=(0,o.useContext)(c);return(0,i.s)(t,e)}},53169:(e,t,n)=>{"use strict";n.d(t,{B:()=>a});let a={query:(e,t)=>["projects",e,"query",...t],ongoingQueries:e=>["projects",e,"ongoing-queries"]}},53674:(e,t,n)=>{"use strict";n.d(t,{YD:()=>b,lW:()=>v,qm:()=>u,zv:()=>_});var a=n(80263),o=n(25481),r=n(97008),i=n(53667),l=n.n(i),s=n(53239),c=n(56028),d=n(12532);let u={table:["r","v","m","f","p"],sql:["sql"]},m=e=>"".concat("supabase_recent_items","_").concat(e),p={activeTab:null,openTabs:[],tabsMap:{},previewTabId:void 0},g=e=>"".concat("supabase_studio_tabs","_").concat(e);function f(e){let t=function(e){if(!e)return[];let t=localStorage.getItem(m(e));try{return JSON.parse(null!=t?t:'{"items": []}').items}catch(e){return[]}}(e),{openTabs:n,activeTab:a,tabsMap:o,previewTabId:r}=function(e){if(!e)return p;let t=localStorage.getItem(g(e));if(!t)return p;try{let e=JSON.parse(null!=t?t:JSON.stringify(p));if(!e.openTabs||!Array.isArray(e.openTabs)||!e.tabsMap||"object"!=typeof e.tabsMap)return p;return e}catch(e){return p}}(e),i=(0,c.BX)({recentItems:t,addRecentItem:e=>{let t=i.recentItems.find(t=>t.id===e.id);if(t){t.timestamp=Date.now();return}let n={id:e.id,type:e.type,label:e.label||"Untitled",timestamp:Date.now(),metadata:e.metadata};i.recentItems.unshift(n);let[a,o]=l()(i.recentItems,e=>{if(u.table.includes(e.type))return e});i.recentItems=[...a.slice(0,8),...o]},clearRecentItems:()=>{i.recentItems=[]},removeRecentItem:e=>{i.recentItems=i.recentItems.filter(t=>t.id!==e)},removeRecentItems:e=>{i.recentItems=i.recentItems.filter(t=>!e.includes(t.id))},removeRecentItemsByType:e=>{i.recentItems=i.recentItems.filter(t=>t.type!==e)},getRecentItemsByType:e=>i.recentItems.filter(t=>t.type===e),activeTab:a,openTabs:n,tabsMap:o,previewTabId:r,addTab:e=>{if(!i.tabsMap[e.id]||i.activeTab!==e.id){if(i.tabsMap[e.id]){i.activeTab=e.id,e.isPreview||i.addRecentItem(e);return}if(!1===e.isPreview){i.openTabs=[...i.openTabs,e.id],i.tabsMap[e.id]=e,i.activeTab=e.id,i.addRecentItem(e);return}i.previewTabId&&(i.openTabs=i.openTabs.filter(e=>e!==i.previewTabId),delete i.tabsMap[i.previewTabId]),i.tabsMap[e.id]={...e,isPreview:!0},i.openTabs=[...i.openTabs,e.id],i.previewTabId=e.id,i.activeTab=e.id}},updateTab:(e,t)=>{i.tabsMap[e]&&("label"in t&&(i.tabsMap[e].label=t.label),"scrollTop"in t&&i.tabsMap[e].metadata&&(i.tabsMap[e].metadata.scrollTop=t.scrollTop))},removeTab:e=>{let t=i.openTabs.indexOf(e);i.openTabs=i.openTabs.filter(t=>t!==e),delete i.tabsMap[e],e===i.activeTab&&(i.activeTab=i.openTabs[t-1]||i.openTabs[t+1]||null)},removeTabs:e=>{e.length&&e.forEach(e=>i.removeTab(e))},reorderTabs:(e,t)=>{let n=[...i.openTabs],[a]=n.splice(e,1);n.splice(t,0,a),i.openTabs=n},makeTabActive:e=>{let t=i.tabsMap[e];t&&(i.activeTab=t.id)},makeTabPermanent:e=>{let t=i.tabsMap[e];(null==t?void 0:t.isPreview)&&(t.isPreview=!1,i.previewTabId=void 0,i.addRecentItem(t))},makeActiveTabPermanent:()=>{var e;return!!i.activeTab&&null!=(e=i.tabsMap[i.activeTab])&&!!e.isPreview&&(i.makeTabPermanent(i.activeTab),!0)},handleTabNavigation:(e,t)=>{var n,a,o;let r=i.tabsMap[e];if(r)switch(i.activeTab=e,!r.isPreview&&i.addRecentItem(r),r.type){case"sql":let l=t.query.schema||"public";t.push("/project/".concat(t.query.ref,"/sql/").concat(null==(n=r.metadata)?void 0:n.sqlId,"?schema=").concat(l));break;case"r":case"v":case"m":case"f":case"p":t.push("/project/".concat(t.query.ref,"/editor/").concat(null==(a=r.metadata)?void 0:a.tableId,"?schema=").concat(null==(o=r.metadata)?void 0:o.schema))}},handleTabClose:e=>{var t;let{id:n,router:a,editor:o,onClose:r,onClearDashboardHistory:l}=e,s=i.tabsMap[n],c=Object.values(i.tabsMap).filter(e=>e.id!==n),d=o?null==(t=c.filter(e=>{var t;return null==(t=u[o])?void 0:t.includes(e.type)})[0])?void 0:t.id:void 0,{[n]:m,...p}=i.tabsMap;if(i.tabsMap=p,s){let e=[...i.openTabs].filter(e=>e!==n);i.openTabs=e}if(i.previewTabId===n&&(i.previewTabId=void 0),i.activeTab===n||"new"===n)if(d)i.activeTab=d,i.handleTabNavigation(d,a);else switch(l(),null==s?void 0:s.type){case"sql":a.push("/project/".concat(a.query.ref,"/sql"));break;case"r":case"v":case"m":case"f":case"p":a.push("/project/".concat(a.query.ref,"/editor"));break;default:a.push("/project/".concat(a.query.ref,"/").concat(o))}null==r||r(n)},handleTabCloseAll:e=>{let{editor:t,router:n,onClearDashboardHistory:a}=e,o="table"===t?i.openTabs.filter(e=>!e.startsWith("sql")):i.openTabs.filter(e=>e.startsWith("sql"));i.removeTabs(o),a(),n.push("/project/".concat(n.query.ref,"/").concat("table"===t?"editor":"sql"))},handleTabDragEnd:(e,t,n,a)=>{let o=i.tabsMap[n];(null==o?void 0:o.isPreview)&&i.makeTabPermanent(n);let r=[...i.openTabs];r.splice(e,1),r.splice(t,0,n),i.openTabs=r,i.activeTab=n,i.handleTabNavigation(n,a)}});return i}let h=(0,s.createContext)(f("")),b=e=>{let{children:t}=e,n=(0,r.KT)(),i=(0,o.MF)(()=>{var e;return f(null!=(e=null==n?void 0:n.ref)?e:"")});return(0,s.useEffect)(()=>{if(null==n?void 0:n.ref)return(0,c.B1)(i,()=>{localStorage.setItem(g(null==n?void 0:n.ref),JSON.stringify({activeTab:i.activeTab,openTabs:i.openTabs,tabsMap:i.tabsMap,previewTabId:i.previewTabId})),localStorage.setItem(m(null==n?void 0:n.ref),JSON.stringify({items:i.recentItems}))})},[]),(0,a.jsx)(h.Provider,{value:i,"data-sentry-element":"unknown","data-sentry-component":"TabsStateContextProvider","data-sentry-source-file":"tabs.tsx",children:t})},_=e=>{let t=(0,s.useContext)(h);return(0,d.s)(t,e)};function v(e,t){switch(e){case"r":return"r-".concat(t.id);case"v":return"v-".concat(t.id);case"m":return"m-".concat(t.id);case"f":return"f-".concat(t.id);case"p":return"p-".concat(t.id);case"sql":return"sql-".concat(t.id);default:return""}}},54097:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var a=n(80263),o=n(53239),r=n(73957),i=n(82457),l=n(37263),s=n(84161);let c=(0,o.forwardRef)((e,t)=>{let{title:n,description:c,size:d="small",visible:u,onCancel:m,onConfirm:p,loading:g,cancelLabel:f="Cancel",confirmLabel:h="Submit",confirmLabelLoading:b,alert:_,children:v,variant:y="default",disabled:E,...A}=e,[w,x]=(0,o.useState)(void 0!==g&&g);return(0,o.useEffect)(()=>{u&&void 0===g&&x(!1)},[u]),(0,o.useEffect)(()=>{void 0!==g&&x(g)},[g]),(0,a.jsx)(r.lG,{open:u,...A,onOpenChange:()=>{u&&m()},children:(0,a.jsxs)(r.Cf,{ref:t,className:"p-0 gap-0 pb-5 !block",size:d,children:[(0,a.jsxs)(r.c7,{className:(0,i.cn)("border-b"),padding:"small",children:[(0,a.jsx)(r.L3,{children:n}),c&&(0,a.jsx)(r.rr,{children:c})]}),_&&(0,a.jsx)(s.Z,{type:y,label:_.title,description:_.description,className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0",...null==_?void 0:_.base}),v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.OO,{padding:"small",children:v}),(0,a.jsx)(r.pf,{})]}),(0,a.jsxs)("div",{className:"flex gap-2 px-5 pt-5",children:[(0,a.jsx)(l.$,{size:"medium",block:!0,type:"default",disabled:w,onClick:()=>m(),children:f}),(0,a.jsx)(l.$,{block:!0,size:"medium",type:"destructive"===y?"danger":"warning"===y?"warning":"primary",htmlType:"submit",loading:w,disabled:w||E,onClick:e=>{e.preventDefault(),e.stopPropagation(),p(),void 0===g&&x(!0)},className:"truncate",children:h})]})]})})});c.displayName="ConfirmationModal";let d=c},56259:(e,t,n)=>{"use strict";n.d(t,{y:()=>c,A:()=>d});var a=n(80263),o=n(25481),r=n(53239);let i=null;var l=n(82457);let s=e=>{let{className:t,delayIndex:n=0,animationDelay:s=150}=e,c=function(e){let t=(0,r.useRef)(null);return(0,o.Es)(()=>{let e=document.getAnimations().filter(e=>e instanceof CSSAnimation&&"shimmer"===e.animationName),n=e.find(e=>e.effect instanceof KeyframeEffect&&e.effect.target===t.current);if(void 0===n)return;let a=e[0];return n===a&&i&&(n.currentTime=i),n!==a&&(n.currentTime=a.currentTime),()=>{n===a&&n.currentTime&&(i=Number(n.currentTime))}},[]),t}(0);return(0,a.jsx)("div",{ref:c,className:(0,l.cn)("shimmering-loader rounded py-3",t),style:{animationFillMode:"backwards",animationDelay:"".concat(n*s,"ms")},"data-sentry-component":"ShimmeringLoader","data-sentry-source-file":"ShimmeringLoader.tsx"})},c=()=>(0,a.jsxs)("div",{className:"space-y-2","data-sentry-component":"GenericSkeletonLoader","data-sentry-source-file":"ShimmeringLoader.tsx",children:[(0,a.jsx)(s,{"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"ShimmeringLoader.tsx"}),(0,a.jsx)(s,{className:"w-3/4",delayIndex:1,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"ShimmeringLoader.tsx"}),(0,a.jsx)(s,{className:"w-1/2",delayIndex:2,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"ShimmeringLoader.tsx"})]}),d=s},63050:(e,t,n)=>{"use strict";n.d(t,{x:()=>r});var a=n(72101),o=n(13482);class r{count(){return new o.X(this.table,"count")}delete(e){return new o.X(this.table,"delete",void 0,e)}insert(e,t){return new o.X(this.table,"insert",e,t)}select(e){return new o.X(this.table,"select",e)}update(e,t){return new o.X(this.table,"update",e,t)}truncate(e){return new o.X(this.table,"truncate",void 0,e)}constructor(e){(0,a._)(this,"table",void 0),this.table=e}}},63295:(e,t,n)=>{"use strict";n.d(t,{GP:()=>c,bD:()=>l,eu:()=>s});let a=new Set(["AES128","AES256","ALL","ALLOWOVERWRITE","ANALYSE","ANALYZE","AND","ANY","ARRAY","AS","ASC","ASYMMETRIC","AUTHORIZATION","BACKUP","BETWEEN","BINARY","BLANKSASNULL","BOTH","BYTEDICT","CASE","CAST","CHECK","COLLATE","COLUMN","CONSTRAINT","CREATE","CREDENTIALS","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURRENT_USER_ID","DEFAULT","DEFERRABLE","DEFLATE","DEFRAG","DELTA","DELTA32K","DESC","DISABLE","DISTINCT","DO","ELSE","EMPTYASNULL","ENABLE","ENCODE","ENCRYPT","ENCRYPTION","END","EXCEPT","EXPLICIT","FALSE","FETCH","FOR","FOREIGN","FREEZE","FROM","FULL","GLOBALDICT256","GLOBALDICT64K","GRANT","GROUP","GZIP","HAVING","IDENTITY","IGNORE","ILIKE","IN","INITIALLY","INNER","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","LUN","LUNS","LZO","LZOP","MINUS","MOSTLY13","MOSTLY32","MOSTLY8","NATURAL","NEW","NOT","NOTNULL","NULL","NULLS","OFF","OFFLINE","OFFSET","OLD","ON","ONLY","OPEN","OR","ORDER","OUTER","OVERLAPS","PARALLEL","PARTITION","PERCENT","PLACING","PRIMARY","RAW","READRATIO","RECOVER","REFERENCES","REJECTLOG","RESORT","RESTORE","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","SYSDATE","SYSTEM","TABLE","TAG","TDES","TEXT255","TEXT32K","THEN","TO","TOP","TRAILING","TRUE","TRUNCATECOLUMNS","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WALLET","WHEN","WHERE","WINDOW","WITH","WITHOUT"]),o={ident:"I",literal:"L",string:"s"};function r(e){return e.replace("T"," ").replace("Z","+00")}function i(e,t,n){let a="";for(let[o,r]of(a+=e?" (":"(",t.entries()))a+=(0===o?"":", ")+n(r);return a+")"}function l(e){if(null==e)throw Error("SQL identifier cannot be null or undefined");if(!1===e)return'"f"';if(!0===e)return'"t"';if(e instanceof Date)return'"'.concat(r(e.toISOString()),'"');if(Array.isArray(e)){let t=[];for(let n of e)if(!0===Array.isArray(n))throw TypeError("Nested array to grouped list conversion is not supported for SQL identifier");else t.push(l(n));return t.toString()}else if(e===Object(e))throw Error("SQL identifier cannot be an object");let t=String(e).slice(0);if(!0===/^[_a-z][\d$_a-z]*$/.test(t)&&!1==!!a.has(t.toUpperCase()))return t;let n='"';for(let e of t)n+='"'===e?e+e:e;return n+'"'}function s(e){let t,n="";if(null==e)return"NULL";if("bigint"==typeof e)return BigInt(e).toString();if(e===Number.POSITIVE_INFINITY)return"'Infinity'";if(e===Number.NEGATIVE_INFINITY)return"'-Infinity'";if(Number.isNaN(e))return"'NaN'";if("number"==typeof e)return Number(e).toString();if(!1===e)return"'f'";if(!0===e)return"'t'";if(e instanceof Date)return"'".concat(r(e.toISOString()),"'");if(Array.isArray(e)){let t=[];for(let[n,a]of e.entries())!0===Array.isArray(a)?t.push(i(0!==n,a,s)):t.push(s(a));return t.toString()}e===Object(e)?(t="jsonb",n=JSON.stringify(e)):n=String(e).slice(0);let a=!1,o="'";for(let e of n)"'"===e?o+=e+e:"\\"===e?(o+=e+e,a=!0):o+=e;return o+="'",!0===a&&(o="E".concat(o)),t&&(o+="::".concat(t)),o}function c(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];let c=0,d="%(%|(\\d+\\$)?[";d+=o.ident,d+=o.literal,d+=o.string;let u=RegExp(d+="])","g");return e.replace(u,(e,t)=>{if("%"===t)return"%";let a=c,d=t.split("$");if(d.length>1&&(a=Number.parseInt(d[0],10)-1,t=d[1]),a<0)throw Error("specified argument 0 but arguments start at 1");if(a>n.length-1)throw Error("too few arguments");return(c=a+1,t===o.ident)?l(n[a]):t===o.literal?s(n[a]):t===o.string?function e(t){if(null==t)return"";if(!1===t)return"f";if(!0===t)return"t";if(t instanceof Date)return r(t.toISOString());if(Array.isArray(t)){let n=[];for(let[a,o]of t.entries())null!=o&&(!0===Array.isArray(o)?n.push(i(0!==a,o,e)):n.push(e(o)));return n.toString()}return t===Object(t)?JSON.stringify(t):String(t).toString().slice(0)}(n[a]):void 0})}},67394:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});let a={schemas:e=>["projects",e,"schemas"],keywords:e=>["projects",e,"keywords"],migrations:e=>["projects",e,"migrations"],tableColumns:(e,t,n)=>["projects",e,"table-columns",t,n],databaseFunctions:e=>["projects",e,"database-functions"],entityDefinition:(e,t)=>["projects",e,"entity-definition",t],entityDefinitions:(e,t)=>["projects",e,"entity-definitions",t],tableDefinition:(e,t)=>["projects",e,"table-definition",t],viewDefinition:(e,t)=>["projects",e,"view-definition",t],backups:e=>["projects",e,"database","backups"],poolingConfiguration:e=>["projects",e,"database","pooling-configuration"],indexesFromQuery:(e,t)=>["projects",e,"indexes",{query:t}],indexAdvisorFromQuery:(e,t)=>["projects",e,"index-advisor",{query:t}],tableConstraints:(e,t)=>["projects",e,"table-constraints",t],foreignKeyConstraints:(e,t)=>["projects",e,"foreign-key-constraints",t],databaseSize:e=>["projects",e,"database-size"],maxConnections:e=>["projects",e,"max-connections"],pgbouncerStatus:e=>["projects",e,"pgbouncer","status"],pgbouncerConfig:e=>["projects",e,"pgbouncer","config"]}},67928:(e,t,n)=>{"use strict";n.d(t,{AM:()=>c,Wv:()=>d,hl:()=>u,zT:()=>m});var a=n(80263),o=n(13730),r=n(53239),i=n(82457),l=n(41930),s=n.n(l);let c=o.bL,d=o.l9;o.Mz;let u=r.forwardRef((e,t)=>{let{className:n,align:l="center",sideOffset:c=4,portal:d=!1,sameWidthAsTrigger:u=!1,...m}=e,p=d?o.ZL:r.Fragment;return(0,a.jsx)(p,{children:(0,a.jsx)(o.UC,{ref:t,align:l,sideOffset:c,className:(0,i.cn)(u?s()["popover-trigger-width"]:"","z-50 w-72 rounded-md border border-overlay bg-overlay p-4 text-popover-foreground shadow-md outline-none animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...m})})});u.displayName="PopoverContent";let m=r.forwardRef((e,t)=>{let{className:n,children:o,...r}=e;return(0,a.jsx)("div",{ref:t,...r,className:(0,i.cn)("w-full h-px bg-border-overlay",n)})});m.displayName="PopoverSeparator"},70084:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});var a=n(63050);class o{from(e,t){return new a.x({name:e,schema:null!=t?t:"public"})}}},73332:(e,t,n)=>{"use strict";n.d(t,{C:()=>a});let a={list:(e,t)=>["projects",e,"entity-types",...t?[t]:[]]}},82681:(e,t,n)=>{"use strict";n.d(t,{N:()=>a});let a={list:e=>["projects",e,"branches"],detail:(e,t)=>["projects",e,"branches",t],diff:(e,t)=>["projects",e,"branch",t,"diff"]}},85936:(e,t,n)=>{"use strict";n.d(t,{G7:()=>d,L$:()=>p,fx:()=>g,h_:()=>f,oI:()=>u,uB:()=>c,xL:()=>m});var a=n(80263),o=n(45362),r=n(76584),i=n(29260),l=n(53239),s=n(82457);let c=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB,{ref:t,className:(0,s.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-overlay text-foreground-light",n),...r})});c.displayName=o.uB.displayName;let d=l.forwardRef((e,t)=>{var n;let{className:l,wrapperClassName:c,showResetIcon:d=!1,showSearchIcon:u=!0,handleReset:m,...p}=e;return(0,a.jsxs)("div",{className:(0,s.cn)("flex items-center border-b px-3",c),"cmdk-input-wrapper":"",children:[u&&(0,a.jsx)(r.A,{className:"h-4 w-4 shrink-0 opacity-50"}),(0,a.jsx)(o.uB.Input,{ref:t,className:(0,s.cn)("flex h-9 w-full rounded-md bg-transparent py-3 md:text-xs text outline-none placeholder:text-muted disabled:cursor-not-allowed disabled:opacity-50 border-none focus:ring-0",l),...p}),d&&(0,a.jsx)("button",{onClick:m,className:(0,s.cn)("text-foreground-lighter hover:text-foreground-light hover:cursor-pointer transition-all opacity-0 duration-100",!!(null==(n=p.value)?void 0:n.length)&&"opacity-100"),children:(0,a.jsx)(i.A,{size:14})})]})});d.displayName=o.uB.Input.displayName;let u=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB.List,{ref:t,className:(0,s.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",n),...r})});u.displayName=o.uB.List.displayName;let m=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB.Empty,{ref:t,className:(0,s.cn)("py-6 text-center text-xs",n),...r})});m.displayName=o.uB.Empty.displayName;let p=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB.Group,{ref:t,className:(0,s.cn)("overflow-hidden p-1 text-foreground-light [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-normal [&_[cmdk-group-heading]]:text-foreground-muted","[&_[cmdk-group-heading]]:font-mono","[&_[cmdk-group-heading]]:uppercase","[&_[cmdk-group-heading]]:tracking-wider",n),...r})});p.displayName=o.uB.Group.displayName;let g=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB.Separator,{ref:t,className:(0,s.cn)("-mx-1 h-px bg-border-overlay",n),...r})});g.displayName=o.uB.Separator.displayName;let f=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.uB.Item,{ref:t,className:(0,s.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none data-[selected=true]:bg-overlay-hover data-[selected=true]:text-strong data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",n),...r})});f.displayName=o.uB.Item.displayName},87163:(e,t,n)=>{"use strict";n.d(t,{G:()=>i,I:()=>r});var a=n(12532),o=n(40445);let r=()=>{let{queryState:e}=(0,o.e)(),{query:t}=(0,a.s)(e);return t},i=()=>{let{queryState:e}=(0,o.e)(),{setQuery:t}=(0,a.s)(e);return t}},89635:(e,t,n)=>{"use strict";n.d(t,{KB:()=>u,Uj:()=>d,w$:()=>c});var a=n(17331),o=n(56947),r=n(18232),i=n(67394);let l=a.A.schemas.list();async function s(e,t){let{projectRef:n,connectionString:a}=e,{result:o}=await (0,r.E)({projectRef:n,connectionString:a,sql:l.sql,queryKey:["schemas"]},t);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.I)(i.c.schemas(t),e=>{let{signal:a}=e;return s({projectRef:t,connectionString:n},a)},{enabled:a&&void 0!==t,...r})};function d(e,t){return e.invalidateQueries(i.c.schemas(t))}function u(e,t){let{projectRef:n,connectionString:a}=t;return e.fetchQuery(i.c.schemas(n),e=>{let{signal:t}=e;return s({projectRef:n,connectionString:a},t)})}},96040:(e,t,n)=>{"use strict";n.d(t,{t:()=>c});var a=n(80263),o=n(58394),r=n(47941),i=n(53239),l=n(82457);let s=i.forwardRef((e,t)=>{let{className:n,value:o,...i}=e;return(0,a.jsx)(r.bL,{ref:t,className:(0,l.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",n),...i,children:(0,a.jsx)(r.C1,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:"translateX(-".concat(100-(o||0),"%)")}})})});s.displayName=r.bL.displayName;let c=e=>{let{progress:t,progressPrefix:n,action:r,message:i}=e;return(0,a.jsxs)("div",{className:"flex gap-3 w-full","data-sentry-component":"SonnerProgress","data-sentry-source-file":"sonner-progress.tsx",children:[(0,a.jsx)(o.A,{className:"animate-spin text-foreground-muted mt-0.5",size:16,"data-sentry-element":"Loader2","data-sentry-source-file":"sonner-progress.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex w-full justify-between",children:[(0,a.jsx)("p",{className:"text-foreground text-sm",children:i}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm font-mono",children:[n||"","".concat(Number(t).toFixed(0),"%")]})]}),(0,a.jsx)(s,{value:t,className:"w-full","data-sentry-element":"Progress","data-sentry-source-file":"sonner-progress.tsx"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between",children:[(0,a.jsx)("small",{className:"text-foreground-lighter text-xs",children:"Please do not close the browser"}),r]})]})]})}},97337:(e,t,n)=>{"use strict";n.d(t,{J:()=>c});var a=n(80263),o=n(98221),r=n(79279),i=n(53239),l=n(82457);let s=(0,r.F)("text-sm text leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(o.b,{ref:t,className:(0,l.cn)(s(),n),...r})});c.displayName=o.b.displayName},98923:(e,t,n)=>{"use strict";n.d(t,{Q4:()=>f,R3:()=>m,aP:()=>d,mM:()=>p,ux:()=>u});var a=n(84305),o=n.n(a),r=n(53239),i=n(12532),l=n(40445),s=n(20368),c=n(87163);let d=()=>{let{pagesState:e}=(0,l.e)(),{commandPages:t,pageStack:n}=(0,i.s)(e),a=n.at(-1);return(0,r.useMemo)(()=>a&&t[a]?{...t[a],name:a}:void 0,[t,a])},u=()=>{let e=d();if(e&&(0,s.by)(e))return e.component},m=()=>{let{pagesState:e}=(0,l.e)(),t=(0,c.G)();return function(n){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.appendPageStack(n),a||t("")}},p=()=>{let{pagesState:e}=(0,l.e)(),{popPageStack:t}=(0,i.s)(e);return t},g=[],f=function(e,t){let{deps:n=g,enabled:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{pagesState:s}=(0,l.e)(),{registerNewPage:c}=(0,i.s)(s),d=(0,r.useRef)(n),u=(0,r.useRef)(a),m=(0,r.useRef)();(0,r.useMemo)(()=>{if(!o()(d.current,n)||u.current!==a){var r;null==(r=m.current)||r.call(m),m.current=a?c(e,t):void 0,d.current=n,u.current=a}},[c,e,t,n,a]),(0,r.useEffect)(()=>(m.current=a?c(e,t):void 0,()=>{var e;return null==(e=m.current)?void 0:e.call(m)}),[])}}}]);