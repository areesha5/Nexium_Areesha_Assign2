!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0532f4ab-419f-452c-8853-16207d384766",e._sentryDebugIdIdentifier="sentry-dbid-0532f4ab-419f-452c-8853-16207d384766")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2303],{2687:(e,t,a)=>{a.d(t,{c3:()=>l,e9:()=>o});var s=a(17702),r=a(48678),n=a(65210);let l=100;async function i(e,t){let{projectRef:a,cursor:s,sort:n,name:i}=e;if(void 0===a)throw Error("projectRef is required");let{data:o,error:d}=await (0,r.Jt)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{type:"sql",cursor:s,limit:l.toString(),sort_by:n,sort_order:"name"===n?"asc":"desc",name:i,visibility:"user"}},signal:t});return d&&(0,r.H4)(d),{...o.data,cursor:o.cursor}}let o=function(e){let{projectRef:t,name:a,sort:r}=e,{enabled:l=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.q)(n.M.folders(t,{name:a,sort:r}),e=>{let{signal:s,pageParam:n}=e;return i({projectRef:t,cursor:n,name:a,sort:r},s)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...o})}},7874:(e,t,a)=>{a.d(t,{I:()=>o});var s=a(17702),r=a(48678),n=a(65210),l=a(2687);async function i(e,t){let{projectRef:a,cursor:s,visibility:n,favorite:i,name:o,sort:d}=e;if(void 0===a)throw Error("projectRef is required for getSqlSnippets");let{data:c,error:u}=await (0,r.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:"sql",cursor:s,visibility:n,favorite:i,name:o,limit:l.c3.toString(),sort_by:d,sort_order:"name"===d?"asc":"desc"}},signal:t});if(u)throw u;return{cursor:c.cursor,contents:c.data}}let o=function(e){let{projectRef:t,sort:a,name:r,visibility:l,favorite:o}=e,{enabled:d=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.q)(n.M.sqlSnippets(t,{sort:a,name:r,visibility:l,favorite:o}),e=>{let{signal:s,pageParam:n}=e;return i({projectRef:t,cursor:n,sort:a,name:r,visibility:l,favorite:o},s)},{enabled:d&&void 0!==t,getNextPageParam:e=>e.cursor,...c})}},12523:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(80263),r=a(53239),n=a(9377),l=a(48492);function i(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function o(e){let{validate:t,...a}=e,[o,d]=(0,r.useReducer)(i,null),c=(0,n.Wx)({validateOnBlur:!0,...a,validationSchema:a.validationSchema,initialValues:a.initialValues,onSubmit:a.onSubmit,validate:t||function(){return o}});return(0,s.jsx)("form",{id:a.id,name:a.name,onSubmit:c.handleSubmit,className:a.className,style:a.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,s.jsx)(l.h,{values:c.values,errors:c.errors,formContextOnChange:c.handleChange,handleBlur:c.handleBlur,touched:c.touched,fieldLevelValidation:function(e,t){d({key:e,error:t})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:a.children({errors:c.errors,touched:c.touched,isSubmitting:c.isSubmitting,isValidating:c.isValidating,submitCount:c.submitCount,initialValues:c.initialValues,values:c.values,handleReset:c.handleReset,resetForm:c.resetForm,setFieldValue:c.setFieldValue})})})}},18075:(e,t,a)=>{a.d(t,{$:()=>P});var s=a(80263),r=a(74176),n=a(25481),l=a(53674),i=a(82457),o=a(72865),d=a(58789),c=a(14803),u=a(23480),p=a(85462);function m(e){let{hideTabs:t}=e,{showSidebar:a,setShowSidebar:r}=(0,u.qM)();return(0,s.jsxs)(p.m_,{"data-sentry-element":"Tooltip","data-sentry-component":"CollapseButton","data-sentry-source-file":"CollapseButton.tsx",children:[(0,s.jsx)(p.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"CollapseButton.tsx",children:(0,s.jsx)("button",{className:(0,i.cn)("flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0",!t&&"border-b border-b-default"),onClick:()=>r(!a),children:a?(0,s.jsx)(d.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"}):(0,s.jsx)(c.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,s.jsxs)(p.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"CollapseButton.tsx",children:["Collapse"," sidebar"]})]})}var f=a(26779),x=a(47625),h=a(88712),g=a(37055),y=a(55060),v=a(29260),j=a(87355),b=a(16425),S=a(91218),w=a(45159),N=a(87604),C=a(53239),q=a(25650);let M=e=>{var t;let{tab:a,index:r,openTabs:n,onClose:o}=e,d=(0,j.useRouter)().query.schema||"public",c=(0,l.zv)(),{attributes:u,listeners:p,setNodeRef:m,transform:f,transition:y,isDragging:S}=(0,x.gl)({id:a.id}),w={transform:N.Ks.Transform.toString(f),transition:y,zIndex:+!!S},M=(0,C.useMemo)(()=>"r"===a.type&&n.filter(e=>"r"===e.type).some(e=>{var t;return(null==(t=e.metadata)?void 0:t.schema)!==d}),[n,d,a.type]);return(0,s.jsxs)(g.P.div,{ref:m,style:w,...u,layoutId:a.id,transition:{duration:.045},animate:{opacity:+!S},className:(0,i.cn)("flex items-center h-10 first-of-type:border-l"),"data-sentry-element":"unknown","data-sentry-component":"SortableTab","data-sentry-source-file":"SortableTab.tsx",children:[(0,s.jsxs)(b.Xi,{value:a.id,onDoubleClick:()=>c.makeTabPermanent(a.id),className:(0,i.cn)("flex items-center gap-2 pl-3 pr-2.5 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","border-b border-default","data-[state=active]:border-b-background-dash-sidebar dark:data-[state=active]:border-b-background-surface-100","relative group h-full","hover:bg-surface-300 dark:hover:bg-surface-100",a.isPreview&&"italic font-light"),...p,"data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"SortableTab.tsx",children:[(0,s.jsx)(q.L,{type:a.type,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"SortableTab.tsx"}),(0,s.jsxs)("div",{className:"flex items-center gap-0",children:[(0,s.jsx)(h.N,{mode:"popLayout",initial:!0,"data-sentry-element":"AnimatePresence","data-sentry-source-file":"SortableTab.tsx",children:M&&(0,s.jsxs)(g.P.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{duration:.15},className:"text-foreground-muted group-data-[state=active]:text-foreground-lighter",children:[null==a||null==(t=a.metadata)?void 0:t.schema,"."]})}),(0,s.jsx)("span",{children:a.label||"Untitled"})]}),(0,s.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"p-0.5 ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),o(a.id)},children:(0,s.jsx)(v.A,{size:12,className:"text-foreground-light","data-sentry-element":"X","data-sentry-source-file":"SortableTab.tsx"})}),(0,s.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground opacity-0 group-data-[state=active]:opacity-100"})]}),r<n.length&&(0,s.jsx)("div",{role:"separator",className:"h-full w-px bg-border"},"separator-".concat(a.id))]})},E=e=>{let{tab:t}=e,{ref:a}=(0,n.g)(),r=(0,l.zv)().tabsMap[t];return r?(0,s.jsxs)(g.P.div,{layoutId:t,transition:{duration:.045},animate:{opacity:.7},className:"flex relative items-center gap-2 px-3 text-xs bg-dash-sidebar dark:bg-surface-100 shadow-lg rounded-sm h-10","data-sentry-element":"unknown","data-sentry-component":"TabPreview","data-sentry-source-file":"TabPreview.tsx",children:[(0,s.jsx)(q.L,{type:r.type,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"TabPreview.tsx"}),(0,s.jsx)("span",{children:r.label||"Untitled"}),(0,s.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground-muted"})]}):null},k=()=>{var e;let{ref:t,id:a}=(0,n.g)(),r=(0,j.useRouter)(),o=(0,u.qM)(),d=(0,w.l)(),c=(0,l.zv)(),p=(0,f.FR)((0,f.MS)(f.AN,{activationConstraint:{distance:1}})),N=c.openTabs.map(e=>c.tabsMap[e]).filter(e=>void 0!==e),C=r.asPath.includes("/new"),q=d?N.filter(e=>{var t;return null==(t=l.qm[d])?void 0:t.includes(e.type)}):[],k=()=>{t&&d&&o.setDashboardHistory(t,"table"===d?"editor":d,void 0)},P=e=>{c.handleTabClose({id:e,router:r,editor:d,onClearDashboardHistory:k})},L=()=>{if(d){let e="table"===d?c.openTabs.filter(e=>!e.startsWith("sql")):c.openTabs.filter(e=>e.startsWith("sql"));c.removeTabs(e),k(),r.push("/project/".concat(t,"/").concat("table"===d?"editor":"sql"))}},_=e=>{if(d){let s="table"===d?c.openTabs.filter(t=>!t.startsWith("sql")&&t!==e):c.openTabs.filter(t=>t.startsWith("sql")&&t!==e);c.removeTabs(s),k();let n="table"===d?e.split("-")[1]:e.split("sql-")[1];a!==n&&r.push("/project/".concat(t,"/").concat("table"===d?"editor":"sql","/").concat(n))}},Q=e=>{if(d){let t="table"===d?c.openTabs.filter(e=>!e.startsWith("sql")):c.openTabs.filter(e=>e.startsWith("sql")),a=t.indexOf(e),s=t.slice(a+1);c.removeTabs(s)}};return(0,s.jsxs)(f.Mp,{sensors:p,onDragEnd:e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let s=c.openTabs.indexOf(t.id.toString()),n=c.openTabs.indexOf(a.id.toString());s!==n&&c.handleTabDragEnd(s,n,t.id.toString(),r)},"data-sentry-element":"DndContext","data-sentry-component":"EditorTabs","data-sentry-source-file":"Tabs.tsx",children:[(0,s.jsxs)(b.tU,{className:"w-full flex",value:C?"new":null!=(e=c.activeTab)?e:void 0,onValueChange:e=>{c.handleTabNavigation(e,r)},"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"Tabs.tsx",children:[(0,s.jsx)(m,{hideTabs:!1,"data-sentry-element":"CollapseButton","data-sentry-source-file":"Tabs.tsx"}),(0,s.jsxs)(b.j7,{className:(0,i.cn)("rounded-b-none gap-0 h-10 flex items-center w-full z-[1]","bg-surface-200 dark:bg-alternative border-none overflow-clip overflow-x-auto"),"data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"Tabs.tsx",children:[(0,s.jsx)(x.gB,{items:q.map(e=>e.id),strategy:x.m$,"data-sentry-element":"SortableContext","data-sentry-source-file":"Tabs.tsx",children:q.map((e,t)=>(0,s.jsxs)(S.tz,{children:[(0,s.jsx)(S.Rc,{children:(0,s.jsx)(M,{tab:e,index:t,openTabs:N,onClose:()=>P(e.id)},e.id)}),(0,s.jsxs)(S.Ip,{children:[(0,s.jsx)(S.kt,{onClick:()=>P(e.id),children:"Close"}),(0,s.jsx)(S.kt,{onClick:()=>_(e.id),children:"Close Others"}),(0,s.jsx)(S.kt,{onClick:()=>Q(e.id),children:"Close to the Right"}),(0,s.jsx)(S.kt,{onClick:L,children:"Close All"})]})]}))}),C&&(0,s.jsxs)(b.Xi,{value:"new",className:(0,i.cn)("flex items-center gap-2 px-3 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","relative group h-full border-t-2 !border-b-0","hover:bg-surface-300 dark:hover:bg-surface-100"),children:[(0,s.jsx)(y.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter"}),(0,s.jsx)("div",{className:"flex items-center gap-0",children:(0,s.jsx)("span",{children:"New"})}),(0,s.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),P("new")},children:(0,s.jsx)(v.A,{size:12,className:"text-foreground-light"})})," ",(0,s.jsx)("div",{className:"absolute w-full -bottom-[1px] left-0 right-0 h-px bg-dash-sidebar dark:bg-surface-100 opacity-0 group-data-[state=active]:opacity-100"})]}),(0,s.jsx)(h.N,{initial:!1,"data-sentry-element":"AnimatePresence","data-sentry-source-file":"Tabs.tsx",children:!C&&(0,s.jsx)(g.P.button,{className:"flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0 border-b",onClick:()=>r.push("/project/".concat(r.query.ref,"/").concat("table"===d?"editor":"sql","/new?skip=true")),initial:{opacity:0,scale:.8,x:-10},animate:{opacity:1,scale:1,x:0},transition:{duration:.2},children:(0,s.jsx)(y.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,s.jsx)("div",{className:"grow h-full border-b pr-6"})]})]}),(0,s.jsx)(f.Hd,{dropAnimation:null,"data-sentry-element":"DragOverlay","data-sentry-source-file":"Tabs.tsx",children:c.activeTab?(0,s.jsx)(E,{tab:c.activeTab}):null})]})},P=e=>{let{children:t,title:a,product:d,...c}=e,{ref:u}=(0,n.g)(),p=(0,r.usePathname)(),f=(0,w.l)(),x=(0,l.zv)(),h="table"===f&&0===x.openTabs.filter(e=>!e.startsWith("sql")).length,g=p==="/project/".concat(u,"/editor")||p==="/project/".concat(u,"/sql")||h;return(0,s.jsx)(o.S,{resizableSidebar:!0,title:a,product:d,...c,"data-sentry-element":"ProjectLayoutWithAuth","data-sentry-component":"EditorBaseLayout","data-sentry-source-file":"EditorBaseLayout.tsx",children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:(0,i.cn)("h-10 flex items-center",g?"bg-surface-100":"bg-surface-200 dark:bg-alternative"),children:g?(0,s.jsx)(m,{hideTabs:g}):(0,s.jsx)(k,{})}),(0,s.jsx)("div",{className:"h-full",children:t})]})})}},25650:(e,t,a)=>{a.d(t,{L:()=>c});var s=a(80263),r=a(36662),n=a(69399),l=a(73451),i=a(15777),o=a(23601),d=a(82457);let c=e=>{var t,a,c;let{type:u,size:p=15,strokeWidth:m=1.5,isActive:f}=e;return"sql"===u?(0,s.jsx)(o.ty,{size:p,className:(0,d.cn)("transition-colors","fill-foreground-muted","group-aria-selected:fill-foreground","w-4 h-4","-ml-0.5"),strokeWidth:m}):u===r.z.TABLE?(0,s.jsx)(n.A,{size:p,strokeWidth:m,className:(0,d.cn)("text-foreground-muted group-hover:text-foreground-lighter group-aria-selected:text-foreground",f&&"text-foreground-light","transition-colors")}):"schema"===u?(0,s.jsx)(l.A,{size:p,strokeWidth:m}):u===r.z.VIEW?(0,s.jsx)(i.A,{size:p,strokeWidth:m,className:(0,d.cn)("text-foreground-muted group-hover:text-foreground-lighter",f&&"text-foreground-lighter","transition-colors")}):(0,s.jsx)("div",{className:(0,d.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",u===r.z.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",u===r.z.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500",u===r.z.PARTITIONED_TABLE&&"text-foreground-light bg-border-stronger"),"data-sentry-component":"EntityTypeIcon","data-sentry-source-file":"EntityTypeIcon.tsx",children:null==(c=Object.entries(r.z).find(e=>{let[,t]=e;return t===u}))||null==(a=c[0])||null==(t=a[0])?void 0:t.toUpperCase()})}},26840:(e,t,a)=>{a.d(t,{A:()=>T});var s=a(80263),r=a(53434),n=a.n(r),l=a(24716),i=a(24515),o=a(53239),d=a(73969),c=a(80948),u=a(76195),p=a(32144),m=a(80251),f=a(18232),x=a(53169);async function h(e){let{pid:t,projectRef:a,connectionString:s}=e,{result:r}=await (0,f.E)({projectRef:a,connectionString:s,sql:"select pg_terminate_backend(".concat(t,")")});return r}let g=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,p.jE)();return(0,m.n)(e=>h(e),{async onSuccess(t,a,r){let{projectRef:n}=a;await s.invalidateQueries(x.B.ongoingQueries(n)),await (null==e?void 0:e(t,a,r))},async onError(e,a,s){void 0===t?d.oR.error("Failed to abort query: ".concat(e.message)):t(e,a,s)},...a})};var y=a(56947);let v=()=>"\nselect pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';\n".trim();async function j(e,t){let{projectRef:a,connectionString:s}=e,r=v().trim(),{result:n}=await (0,f.E)({projectRef:a,connectionString:s,sql:r,queryKey:["ongoing-queries"]},t);return(null!=n?n:[]).filter(e=>!e.query.startsWith(r))}let b=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,y.I)(x.B.ongoingQueries(t),e=>{let{signal:s}=e;return j({projectRef:t,connectionString:a},s)},{enabled:s&&void 0!==t,...r})};var S=a(97008),w=a(69938),N=a(32211),C=a(37785),q=a(4806),M=a(37263),E=a(26822),k=a(82457),P=a(85462),L=a(54097),_=a(23480),Q=a(25481);let A=()=>{let[e,t]=(0,w.W)({replace:!0}),{viewOngoingQueries:a}=(0,Q.g)(),r=(0,S.KT)(),p=(0,C.RE)(),m=(0,_.qM)(),[f,x]=(0,o.useState)(),{data:h}=(0,u.Vh)({projectRef:null==r?void 0:r.ref}),y=(null!=h?h:[]).find(e=>e.identifier===p.selectedDatabaseId),{data:v,error:j,isError:A,isLoading:T,isFetching:I,refetch:D}=b({projectRef:null==r?void 0:r.ref,connectionString:null==y?void 0:y.connectionString},{enabled:!N.pe||N.pe&&(null==y?void 0:y.connectionString)!==void 0,staleTime:5e3}),R=null!=v?v:[];(0,o.useEffect)(()=>{a&&(m.setOnGoingQueriesPanelOpen(!0),t({viewOngoingQueries:void 0}))},[a]);let{mutate:F,isLoading:z}=g({onSuccess:()=>{d.oR.success("Successfully aborted query (ID: ".concat(f,")")),x(void 0)}}),O=()=>{t({viewOngoingQueries:void 0}),m.setOnGoingQueriesPanelOpen(!1)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.cj,{open:m.ongoingQueriesPanelOpen,onOpenChange:()=>O(),"data-sentry-element":"Sheet","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,s.jsxs)(q.h,{size:"lg","data-sentry-element":"SheetContent","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,s.jsxs)(q.Fm,{"data-sentry-element":"SheetHeader","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,s.jsxs)(q.qp,{className:"flex items-center gap-x-2","data-sentry-element":"SheetTitle","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["Running queries on"," ",(null==y?void 0:y.identifier)===(null==r?void 0:r.ref)?"primary database":"read replica",(0,s.jsx)(M.$,{type:"default",className:"px-1.5",loading:T||I,icon:(0,s.jsx)(l.A,{}),onClick:()=>D(),"data-sentry-element":"Button","data-sentry-source-file":"OngoingQueriesPanel.tsx"})]}),(0,s.jsxs)(q.Qs,{"data-sentry-element":"SheetDescription","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["There ",1===R.length?"is":"are"," ",(0,s.jsx)("span",{className:"text-foreground-light",children:R.length})," quer",1===R.length?"y":"ies"," currently running"," ",(null==y?void 0:y.identifier)!==(null==r?void 0:r.ref)?"on replica ".concat(null==y?void 0:y.identifier):""]})]}),(0,s.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[A&&(0,s.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,s.jsx)(c.A,{subject:"Failed to retrieve ongoing queries",error:j})}),0===R.length&&(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,s.jsxs)("span",{children:["No queries are currently running on the"," ",(null==y?void 0:y.identifier)!==(null==r?void 0:r.ref)?"read replica ".concat(null==y?void 0:y.identifier):(null!=h?h:[]).length>1?"primary database":"database"]}),(0,s.jsx)(M.$,{type:"default",loading:T||I,icon:(0,s.jsx)(l.A,{}),onClick:()=>D(),children:"Refresh"})]}),R.map(e=>(0,s.jsxs)(q.Xc,{className:"flex justify-between gap-x-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,s.jsx)(E.N,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,k.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,s.jsx)("p",{className:"text-foreground-light text-xs",children:"•"}),(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",n()(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,s.jsxs)(P.m_,{children:[(0,s.jsx)(P.k$,{asChild:!0,children:(0,s.jsx)(M.$,{type:"warning",className:"px-1.5",icon:(0,s.jsx)(i.A,{}),onClick:()=>x(e.pid)})}),(0,s.jsx)(P.ZI,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,s.jsx)(L.A,{loading:z,variant:"warning",title:"Confirm to abort this query? (ID: ".concat(f,")"),visible:void 0!==f,onCancel:()=>x(void 0),onConfirm:()=>{void 0!==f&&F({pid:f,projectRef:null==r?void 0:r.ref,connectionString:null==y?void 0:y.connectionString})},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,s.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})},T=(0,a(92226).r)(e=>{let{children:t}=e;return(0,s.jsxs)(s.Fragment,{children:[t,(0,s.jsx)(A,{"data-sentry-element":"OngoingQueriesPanel","data-sentry-source-file":"SQLEditorLayout.tsx"})]})})},36500:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(80263),r=a(53239),n=a(35644);let l=(0,r.memo)(function(){return(0,s.jsx)("div",{className:"px-4 flex flex-col gap-0",children:[{width:"w-40",opacity:"opacity-100"},{width:"w-32",opacity:"opacity-100"},{width:"w-20",opacity:"opacity-75"},{width:"w-40",opacity:"opacity-50"},{width:"w-20",opacity:"opacity-25"}].map((e,t)=>(0,s.jsxs)("div",{className:"flex flex-row h-6 items-center gap-3 ".concat(e.opacity),children:[(0,s.jsx)(n.E,{className:"h-4 w-5"}),(0,s.jsx)(n.E,{className:"h-4 ".concat(e.width)})]},t))})})},41719:(e,t,a)=>{a.d(t,{$:()=>d});var s=a(32144),r=a(80251),n=a(73969),l=a(48678),i=a(65210);async function o(e,t){let{projectRef:a,ids:s}=e,{data:r,error:n}=await (0,l.yH)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:a},query:{ids:s}},signal:t});return n&&(0,l.H4)(n),r.map(e=>e.id)}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.jE)();return(0,r.n)(e=>o(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await l.invalidateQueries(i.M.allContentLists(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,s){void 0===t?n.oR.error("Failed to delete contents: ".concat(e.message)):t(e,a,s)},...a})}},46160:(e,t,a)=>{a.d(t,{OJ:()=>j,Pl:()=>q,Pq:()=>y,Q5:()=>M,RK:()=>N,a0:()=>w,ag:()=>S,hm:()=>g,i9:()=>C,qP:()=>v,ue:()=>b});var s=a(80263),r=a(57728),n=a(58394),l=a(76584),i=a(37859),o=a(8758),d=a.n(o),c=a(53239),u=a(9079),p=a(82457),m=a(23601),f=a(93263),x=a(42206),h=a(85462);let g=(0,c.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsx)(u.Nt,{ref:t,...a,className:(0,p.cn)("w-full px-2 group",a.className)})}),y=(0,c.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsxs)(u.R6,{ref:t,...a,className:(0,p.cn)("w-full flex gap-1 items-center group px-3 text-sm font-normal font-mono uppercase text-lighter tracking-wide",a.className),children:[(0,s.jsx)(r.A,{className:"transition-all text-foreground-muted group-data-[state=open]:rotate-90",size:16,strokeWidth:1.5}),(0,s.jsx)("span",{className:"group-hover:not-disabled:text-foreground",children:a.title})]})}),v=(0,c.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsx)(u.Ke,{ref:t,...a,className:(0,p.cn)("w-full flex flex-col gap-0",a.className)})}),j=(0,c.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,p.cn)("h-px bg-border-muted",e.className)})),b=(0,c.forwardRef)((e,t)=>{let{className:a,isActive:r,forceHoverState:n,...l}=e;return(0,s.jsx)(d(),{ref:t,...l,"aria-current":r,className:(0,p.cn)("text-sm","h-7 pl-3 pr-2","flex items-center justify-between rounded-md group relative",r?"bg-selection":"hover:bg-surface-200",n&&"bg-surface-200",r?"text-foreground":"text-foreground-light hover:text-foreground",a)})}),S=(0,c.forwardRef)((e,t)=>{let{isActive:a=!0,forceHoverState:r,isPreview:n,isOpened:l=!0,...i}=e;return(0,s.jsxs)(d(),{ref:t,...i,"aria-current":a,className:(0,p.cn)((0,m.u2)({isSelected:a&&!n,isOpened:l&&!n,isPreview:n}),"px-4",i.className),children:[!n&&a&&(0,s.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),i.children]})}),w=(0,c.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,p.cn)("flex px-2 gap-2 items-center",e.className)})),N=(0,c.forwardRef)((e,t)=>{let{children:a,isLoading:r=!1,...i}=e;return(0,s.jsxs)("label",{htmlFor:i.name,className:"relative w-full",children:[(0,s.jsx)("span",{className:"sr-only",children:i["aria-labelledby"]}),(0,s.jsx)(f.p,{ref:t,type:"text",className:(0,p.cn)("h-[32px] md:h-[28px] w-full","text-base md:text-xs","pl-7","pr-7","w-full","rounded",i.className),...i}),a,r?(0,s.jsx)(n.A,{className:"animate-spin absolute left-2 text-foreground-muted",style:{top:7},size:14,strokeWidth:1.5}):(0,s.jsx)(l.A,{className:"absolute left-2 top-2 text-foreground-muted",size:14,strokeWidth:1.5})]})}),C=(0,c.forwardRef)((e,t)=>{let{value:a,onValueChange:r,contentClassName:n,triggerClassName:l,...o}=e;return(0,s.jsxs)(x.rI,{modal:!1,children:[(0,s.jsxs)(h.m_,{delayDuration:0,children:[(0,s.jsx)(x.ty,{asChild:!0,className:(0,p.cn)("absolute right-1 top-[.4rem] md:top-[.3rem]","text-foreground transition-colors hover:text-foreground data-[state=open]:text-foreground",l),children:(0,s.jsx)(h.k$,{children:(0,s.jsx)(i.A,{size:18,strokeWidth:1})})}),(0,s.jsx)(h.ZI,{side:"bottom",children:"Sort By"})]}),(0,s.jsx)(x.SQ,{side:"bottom",align:"end",className:(0,p.cn)("w-48",n),children:(0,s.jsx)(x.Hr,{value:a,onValueChange:r,children:o.children})})]})}),q=(0,c.forwardRef)((e,t)=>(0,s.jsx)(x.Ht,{ref:t,...e})),M=(0,c.forwardRef)((e,t)=>{let{illustration:a,title:r,description:n,actions:l,...i}=e;return(0,s.jsx)("div",{ref:t,...i,className:(0,p.cn)("border border-muted bg-surface-100 dark:bg-surface-75 flex flex-col gap-y-3 items-center justify-center rounded-md px-5 py-4",i.className),children:(0,s.jsxs)("div",{className:"w-full flex flex-col gap-y-1 items-center",children:[a,r&&(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:r}),n&&(0,s.jsx)("p",{className:"text-xs text-foreground-lighter text-center",children:n}),l&&(0,s.jsx)("div",{className:"mt-2",children:l}),i.children]})})})},59152:(e,t,a)=>{a.d(t,{Z:()=>tt});var s=a(80263),r=a(60045),n=a(56404),l=a(25481),i=a(29260),o=a(55060),d=a(24381),c=a(11427),u=a(87355),p=a(53239),m=a(73969),f=a(19070),x=a(19214),h=a(97008),g=a(27528),y=a(23480),v=a(72147),j=a(85462),b=a(42206),S=a(37263),w=a(46160);let N=["templates","quickstarts"];function C(){let{ref:e}=(0,l.g)(),t=(0,u.useRouter)();return(0,s.jsx)("div",{"data-sentry-component":"SqlEditorMenuStaticLinks","data-sentry-source-file":"SqlEditorMenuStaticLinks.tsx",children:N.map(a=>{let r=t.asPath==="/project/".concat(e,"/sql/").concat(a);return(0,s.jsx)(w.ag,{title:"Templates",isActive:r,isOpened:!1,href:"/project/".concat(e,"/sql/").concat(a),className:"capitalize",children:a},a)})})}var q=a(58394),M=a(8758),E=a.n(M),k=a(41560),P=a(56947),L=a(48678),_=a(65210);async function Q(e,t){let{projectRef:a,cumulative:s,type:r,name:n}=e;if(void 0===a)throw Error("projectRef is required");let{data:l,error:i}=await (0,L.Jt)("/platform/projects/{ref}/content/count",{params:{path:{ref:a},query:{...r&&{type:r},...n&&{name:n}}},...s?{}:{headers:{Version:"2"}},signal:t});if(i)throw(0,L.H4)(i);return l}let A=function(e){let{projectRef:t,cumulative:a,type:s,name:r}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,P.I)(_.M.count(t,s,{cumulative:a,name:r}),e=>{let{signal:n}=e;return Q({projectRef:t,cumulative:a,type:s,name:r},n)},{enabled:n&&void 0!==t,...l})};var T=a(17702);async function I(e,t){let{projectRef:a,type:s,name:r,limit:n=10,sort:l,cursor:i}=e;if(void 0===a)throw Error("projectRef is required for getContent");let{data:o,error:d}=await (0,L.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:s,name:r,sort_by:l,limit:n.toString(),cursor:i}},signal:t});return d&&(0,L.H4)(d),{cursor:o.cursor,content:o.data}}let D=function(e){let{projectRef:t,type:a,name:s,limit:r,sort:n}=e,{enabled:l=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,T.q)(_.M.infiniteList(t,{type:a,name:s,limit:r,sort:n}),e=>{let{signal:l,pageParam:i}=e;return I({projectRef:t,type:a,name:s,limit:r,sort:n,cursor:i},l)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...i})};var R=a(2687),F=a(82457),z=a(23601),O=a(81172);let W=e=>{var t;let{search:a}=e,{ref:r}=(0,l.g)(),{data:n,isLoading:i,hasNextPage:o,fetchNextPage:d,isFetchingNextPage:c}=D({projectRef:r,type:"sql",limit:R.c3,name:0===a.length?void 0:a},{keepPreviousData:!0}),{data:u}=A({projectRef:r,cumulative:!0,type:"sql",name:a},{keepPreviousData:!0}),m=null!=(t=null==u?void 0:u.count)?t:0,f=(0,p.useMemo)(()=>null==n?void 0:n.pages.flatMap(e=>e.content),[null==n?void 0:n.pages]);return(0,s.jsxs)("div",{className:"flex flex-col flex-grow","data-sentry-component":"SearchList","data-sentry-source-file":"SearchList.tsx",children:[i?(0,s.jsx)("div",{className:"px-4 py-1 pb-2.5",children:(0,s.jsx)(q.A,{className:"animate-spin",size:14})}):u?(0,s.jsxs)("p",{className:"px-4 pb-2 text-sm text-foreground-lighter",children:[m," result",m>1?"s":""," found"]}):null,i?(0,s.jsxs)("div",{className:"px-4 flex flex-col gap-y-1",children:[(0,s.jsx)(O.A,{className:"py-2.5"}),(0,s.jsx)(O.A,{className:"py-2.5 w-5/6"}),(0,s.jsx)(O.A,{className:"py-2.5 w-3/4"})]}):(0,s.jsx)(k.A,{items:f,ItemComponent:e=>(0,s.jsx)(B,{snippet:e.item}),itemProps:{},getItemSize:()=>28,hasNextPage:o,isLoadingNextPage:c,onLoadNextPage:()=>d()})]})},B=e=>{let{snippet:t}=e,{ref:a,id:r}=(0,l.g)(),n=t.id===r;return(0,s.jsxs)(E(),{className:(0,F.cn)("h-full flex items-center gap-x-3 pl-4 hover:bg-control transition",n&&"!bg-selection [&>svg]:fill-foreground [&>p]:text-foreground"),href:"/project/".concat(a,"/sql/").concat(t.id),"data-sentry-element":"Link","data-sentry-component":"SearchListItem","data-sentry-source-file":"SearchList.tsx",children:[(0,s.jsx)(z.ty,{size:16,strokeWidth:1.5,className:"w-5 h-5 -ml-0.5 transition-colors fill-foreground-muted group-aria-selected:fill-foreground","data-sentry-element":"SQL_ICON","data-sentry-source-file":"SearchList.tsx"}),(0,s.jsx)("p",{className:"transition text-sm text-foreground-light truncate",children:t.name})]})};var V=a(50004),$=a(15777),G=a(63678),H=a(32117),K=a(52793),U=a.n(K),J=a(90354),Z=a(22133),Y=a(94277),X=a(83523),ee=a(26822),et=a(63809),ea=a(41667);let es=e=>{var t;let{id:a,...r}=e,n=null==(t=(0,v.aP)().snippets[a])?void 0:t.snippet,l=U()(null==n?void 0:n.name),[i,o]=(0,p.useState)("CLI"),d=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(l,"`"),cli:(0,ea.h8)(a,l),npm:(0,ea.h8)(a,l,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,ea.mG)(a),npm:(0,ea.mG)(a,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(l,".sql`"),cli:(0,ea.xL)(a,l),npm:(0,ea.xL)(a,l,!0)}];return(0,s.jsx)(Y.A,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,s.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...r,"data-sentry-element":"Modal","data-sentry-component":"DownloadSnippetModal","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,s.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,s.jsx)(X.A,{type:"underlined",listClassNames:"pl-5","data-sentry-element":"Tabs","data-sentry-source-file":"DownloadSnippetModal.tsx",children:d.map(e=>(0,s.jsx)(X.A.Panel,{id:e.id,label:e.label,children:(0,s.jsxs)(Y.A.Content,{className:"!py-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("p",{className:"text-base",children:e.title}),(0,s.jsx)(et.o,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,s.jsx)(Z.A,{width:50,options:["CLI","NPM"],activeOption:i,borderOverride:"border-muted",onClickOption:()=>"CLI"===i?o("NPM"):o("CLI")})]}),(0,s.jsx)("pre",{children:(0,s.jsx)(ee.N,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===i?e.cli:e.npm})})]})},e.id))}),(0,s.jsxs)(Y.A.Content,{className:"w-full flex items-center justify-between pt-0","data-sentry-element":"unknown","data-sentry-source-file":"DownloadSnippetModal.tsx",children:[(0,s.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,s.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,s.jsx)(S.$,{asChild:!0,type:"default",icon:(0,s.jsx)(J.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,s.jsx)(E(),{href:"https://supabase.com/docs/guides/deployment/database-migrations",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About migrations"})}),(0,s.jsx)(S.$,{asChild:!0,type:"default",icon:(0,s.jsx)(J.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,s.jsx)(E(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About CLI"})})]})]})]})})};var er=a(32981),en=a(35421),el=a(880),ei=a(87494),eo=a(39353),ed=a(59710),ec=a(66319),eu=a(7908),ep=a(73957),em=a(67963),ef=a(97337),ex=a(67928),eh=a(85936),eg=a(40691),ey=a(93263);let ev=e=>{var t;let{visible:a,snippets:r=[],onClose:n}=e,{ref:i}=(0,l.g)(),d=(0,v.aP)(),[c,u]=(0,p.useState)(!1),[f,x]=(0,p.useState)(),{mutateAsync:h,isLoading:g}=(0,eu.W)(),{mutateAsync:y,isLoading:j}=(0,ec.v)({onError:e=>{m.oR.error("Failed to move query: ".concat(e.message))}}),b="new-folder"===f?eo.Ik({name:eo.Yj().min(1,"Please provide a name for the folder")}).refine(e=>!d.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):eo.Ik({}),w=(0,ei.mN)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,er.u)(b),defaultValues:{name:""}}),N=(0,v.mD)(i),C="root"===f?"Root of the editor":"new-folder"===f?"Create a new folder":null==(t=N.find(e=>e.id===f))?void 0:t.name,q=1===r.length&&(!r[0].folder_id&&"root"===f||r[0].folder_id===f),M=1===r.length&&(!r[0].folder_id&&"root"===f||r[0].folder_id===f),E=async e=>{if(!i)return console.error("Project ref is required");try{let t=f;if("new-folder"===f&&"name"in e){let{id:a}=await h({projectRef:i,name:e.name});t=a}await Promise.all(r.map(async e=>{let a=null==e?void 0:e.content;if(void 0===a){let{content:t}=await (0,ed.Q)({projectRef:i,id:e.id});"sql"in t&&(a=t)}if(void 0===a)return m.oR.error("Failed to save snippet: Unable to retrieve snippet contents");await y({projectRef:i,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===f?null:t,content:a}})})),m.oR.success("Successfully moved ".concat(1===r.length?'"'.concat(r[0].name,'"'):"".concat(r.length," snippets")," to ").concat("root"===f?"the root of the editor":C)),r.forEach(e=>{d.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===f?null:t},skipSave:!0})}),n()}catch(e){m.oR.error("Failed to create new folder: ".concat(e.message))}};return(0,p.useEffect)(()=>{if(a&&void 0!==r){if(1===r.length){var e;x(null!=(e=r[0].folder_id)?e:"root")}else x("root");w.reset({name:""})}},[a,r]),(0,s.jsx)(ep.lG,{open:a,onOpenChange:()=>n(),"data-sentry-element":"Dialog","data-sentry-component":"MoveQueryModal","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsx)(ep.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsx)(em.lV,{...w,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsxs)("form",{id:"move-snippet",onSubmit:w.handleSubmit(E),children:[(0,s.jsxs)(ep.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsxs)(ep.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"MoveQueryModal.tsx",children:["Move ",1===r.length?'"'.concat(r[0].name,'"'):"".concat(r.length)," ","snippet",r.length>1?"s":""," to a folder"]}),(0,s.jsxs)(ep.rr,{"data-sentry-element":"DialogDescription","data-sentry-source-file":"MoveQueryModal.tsx",children:["Select which folder to move your quer",r.length>1?"ies":"y"," to"]})]}),(0,s.jsx)(ep.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,s.jsxs)(ep.OO,{className:"py-5 flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(ef.J,{className:"text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"Select a folder"}),(0,s.jsxs)(ex.AM,{open:c,onOpenChange:u,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsx)(ex.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsx)(S.$,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,s.jsx)(en.A,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[C,q&&" (Current)"]})})}),(0,s.jsx)(ex.hl,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsxs)(eh.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsx)(eh.G7,{placeholder:"Find folder...","data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,s.jsxs)(eh.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsx)(eh.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"No folders found"}),(0,s.jsx)(eh.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsxs)(eg.FK,{className:(N||[]).length>6?"h-[210px]":"","data-sentry-element":"ScrollArea","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsxs)(eh.h_,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),x("root")},onClick:()=>{u(!1),x("root")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsxs)("span",{children:["Root of the editor",1===r.length&&null===r[0].folder_id&&" (Current)"]}),"root"===f&&(0,s.jsx)(el.A,{size:14})]},"root"),null==N?void 0:N.map(e=>(0,s.jsxs)(eh.h_,{value:e.name,className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),x(e.id)},onClick:()=>{u(!1),x(e.id)},children:[(0,s.jsxs)("span",{children:[e.name,1===r.length&&r[0].folder_id===e.id&&" (Current)"]}),e.id===f&&(0,s.jsx)(el.A,{size:14})]},e.id))]})}),(0,s.jsx)(eh.fx,{"data-sentry-element":"CommandSeparator_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,s.jsx)(eh.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,s.jsxs)(eh.h_,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{u(!1),x("new-folder")},onClick:()=>{u(!1),x("new-folder")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsx)(o.A,{size:14,strokeWidth:1.5,"data-sentry-element":"Plus","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,s.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===f&&(0,s.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,s.jsx)(em.zB,{name:"name",control:w.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(em.eI,{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(em.lR,{children:"Provide a name for your new folder"}),(0,s.jsx)(em.MJ,{children:(0,s.jsx)(ey.p,{autoFocus:!0,...t,autoComplete:"off",disabled:j||g})}),(0,s.jsx)(em.C5,{})]})}})})]}),(0,s.jsxs)(ep.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,s.jsx)(S.$,{type:"default",disabled:j||g,onClick:()=>n(),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Cancel"}),(0,s.jsx)(S.$,{type:"primary",htmlType:"submit",disabled:M,loading:j||g,"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Move file"})]})]})})})})};var ej=a(43910),eb=a(41804),eS=a(83142),ew=a(45628),eN=a(65475),eC=a(53674),eq=a(12523),eM=a(93057),eE=a(14287),ek=a(531);let eP=e=>{let{snippet:t={},visible:a,onCancel:r,onComplete:n}=e,{ref:i}=(0,l.g)(),o=(0,ew.a)(),d=(0,eN._P)("useBedrockAssistant"),c=(0,v.aP)(),u=(0,eC.zv)(),{data:f}=(0,eS.j5)({orgSlug:null==o?void 0:o.slug},{enabled:a}),x="sql"===t.type,{data:h}=(0,eb.Gm)({projectRef:i}),g=(0,ek.BP)(f)&&(null==h?void 0:h.is_sensitive),{id:y,name:j,description:b}=t,[w,N]=(0,p.useState)(j),[C,q]=(0,p.useState)(b),{mutate:M,isLoading:E}=(0,ej.G)({onSuccess:e=>{let{title:t,description:a}=e;N(t),C||q(a)},onError:e=>{m.oR.error("Failed to rename query: ".concat(e.message))}}),k=async()=>{if("content"in t&&x)M({sql:t.content.sql,useBedrockAssistant:d});else try{let{content:e}=await (0,ed.Q)({projectRef:i,id:t.id});"sql"in e&&M({sql:e.sql,useBedrockAssistant:d})}catch(e){m.oR.error("Unable to generate title based on query contents")}},{mutateAsync:P}=(0,ec.v)(),L=async(e,a)=>{let{setSubmitting:s}=a;if(!i)return console.error("Project ref is required");if(!y)return console.error("Snippet ID is required");s(!0);try{let e=t;"content"in e||(e=await (0,ed.Q)({projectRef:i,id:y}),c.addSnippet({projectRef:i,snippet:e})),await P({projectRef:i,payload:{...e,name:w,description:C}}),c.renameSnippet({id:y,name:w,description:C});let a=(0,eC.lW)("sql",{id:y});u.updateTab(a,{label:w}),m.oR.success("Successfully renamed snippet!"),n&&n()}catch(e){s(!1),m.oR.error("Failed to rename snippet: ".concat(e.message))}};return(0,p.useEffect)(()=>{N(j),q(b)},[t.id]),(0,s.jsx)(Y.A,{visible:a,onCancel:r,hideFooter:!0,header:"Rename",size:"small","data-sentry-element":"Modal","data-sentry-component":"RenameQueryModal","data-sentry-source-file":"RenameQueryModal.tsx",children:(0,s.jsx)(eq.A,{onReset:r,validateOnBlur:!0,initialValues:{name:null!=j?j:"",description:null!=b?b:""},validate:()=>{let e={};return w||(e.name="Please enter a query name"),e},onSubmit:L,"data-sentry-element":"Form","data-sentry-source-file":"RenameQueryModal.tsx",children:e=>{let{isSubmitting:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Y.A.Content,{className:"space-y-4",children:[(0,s.jsx)(eM.A,{label:"Name",id:"name",name:"name",value:w,onChange:e=>N(e.target.value)}),(0,s.jsx)("div",{className:"flex w-full justify-end mt-2",children:!g&&(0,s.jsx)(S.$,{type:"default",onClick:()=>k(),size:"tiny",disabled:E,children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"scale-75",children:(0,s.jsx)(eE.M,{loading:E})}),(0,s.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,s.jsx)(eM.A.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:C,onChange:e=>q(e.target.value)})]}),(0,s.jsx)(Y.A.Separator,{}),(0,s.jsxs)(Y.A.Content,{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(S.$,{htmlType:"reset",type:"default",onClick:r,disabled:t,children:"Cancel"}),(0,s.jsx)(S.$,{htmlType:"submit",loading:t,disabled:t,children:"Rename query"})]})]})}})})};var eL=a(25551),e_=a(71425);let eQ=()=>(0,s.jsx)(w.Q5,{title:"No private queries created yet",description:"Queries will be automatically saved once you start writing in the editor",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"EmptyPrivateQueriesPanel","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx",children:(0,s.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,s.jsxs)("div",{className:"relative h-content",children:[(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,s.jsx)("div",{className:"absolute left-[128px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,s.jsx)(e_.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)("div",{className:"border-l pointer-events-none",children:(0,s.jsx)(z.Z7,{isSelected:2===t,id:"dummy-".concat(t+1),name:"dummy_query_".concat(t+1),level:1,xPadding:16})},"dummy-".concat(t+1)))]})})});var eA=a(36500),eT=a(99130),eI=a(41719),eD=a(32144),eR=a(80251);async function eF(e,t){let{projectRef:a,ids:s}=e,{data:r,error:n}=await (0,L.yH)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{ids:s}},signal:t});if(n)throw(0,L.H4)(n);return r}let ez=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:a=!0,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,eD.jE)();return(0,eR.n)(e=>eF(e),{async onSuccess(e,s,n){let{projectRef:l}=s;a&&await r.invalidateQueries(_.M.folders(l)),await (null==t?void 0:t(e,s,n))},async onError(t,a,s){void 0===e?m.oR.error("Failed to delete folder: ".concat(t.message)):e(t,a,s)},...s})};var eO=a(7874),eW=a(23801),eB=a(17082),eV=a(54097),e$=a(35644);let eG=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,s.jsx)(e$.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,s.jsx)(e$.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,s.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,s.jsx)(e$.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,s.jsx)(e$.E,{className:"w-32 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,s.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-75",children:[(0,s.jsx)(e$.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,s.jsx)(e$.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,s.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-50",children:[(0,s.jsx)(e$.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,s.jsx)(e$.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,s.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-25",children:[(0,s.jsx)(e$.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,s.jsx)(e$.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]})]}),eH={id:0,name:"",parent:null,children:[]},eK=e=>{var t,a;if(void 0===e)return[eH];let{folders:s,contents:r}=e,n=(null==s?void 0:s.map(e=>{var t;let{id:a,name:s}=e;return{id:a,name:s,parent:0,isBranch:!0,children:null!=(t=null==r?void 0:r.filter(e=>e.folder_id===a).map(e=>e.id))?t:[],metadata:e}}))||[],l=(null==r?void 0:r.map(e=>{let{id:t,name:a,folder_id:s}=e;return{id:t,name:a,parent:null!=s?s:0,children:[],metadata:e}}))||[];return[{id:0,name:"",parent:null,children:[...null==(t=s||[])?void 0:t.map(e=>e.id),...null==(a=(r||[]).filter(e=>!e.folder_id))?void 0:a.map(e=>e.id)]},...n,...l]};function eU(e){let t=new Set,a=e.filter(e=>0===e.parent);if(a.length>0){let e=a[a.length-1];"string"==typeof e.id&&t.add(e.id),a.forEach(e=>{if(e.children.length>0){let a=e.children[e.children.length-1];"string"==typeof a&&t.add(a)}})}return t}var eJ=a(99132);async function eZ(e,t){let{projectRef:a,folderId:s,cursor:r,sort:n,name:l}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===s)throw Error("folderId is required");let{data:i,error:o}=await (0,L.Jt)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:a,id:s},query:{cursor:r,limit:R.c3.toString(),sort_by:n,sort_order:"name"===n?"asc":"desc",name:l}},signal:t});return o&&(0,L.H4)(o),{...i.data,cursor:i.cursor}}let eY=function(e){let{projectRef:t,folderId:a,name:s,sort:r}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,T.q)(_.M.folderContents(t,a,{name:s,sort:r}),e=>{let{signal:n,pageParam:l}=e;return eZ({projectRef:t,folderId:a,cursor:l,name:s,sort:r},n)},{enabled:n&&void 0!==t&&void 0!==a,getNextPageParam:e=>e.cursor,...l})};var eX=a(26413),e0=a(669),e1=a(98990),e2=a(83741),e5=a(83575),e4=a(71147),e3=a(1933),e6=a(432),e7=a(91218);let e8=e=>{let{element:t,isBranch:a,isExpanded:n,level:i,status:d,isSelected:c,isMultiSelected:m,getNodeProps:x,onSelectCreate:h,onSelectDelete:y,onSelectRename:j,onSelectMove:b,onSelectShare:w,onSelectUnshare:N,onSelectDownload:C,onSelectDuplicate:q,onEditSave:M,onMultiSelect:k,isLastItem:P,hasNextPage:L,fetchNextPage:_,isFetchingNextPage:Q,sort:A,name:T,onFolderContentsChange:I,...D}=e,R=(0,u.useRouter)(),{id:F,ref:O}=(0,eJ.g)(),{profile:W}=(0,g.xc)(),{className:B,onClick:V}=x(),$=(0,v.aP)(),G=(null==W?void 0:W.id)===(null==t?void 0:t.metadata.owner_id),H="project"===t.metadata.visibility,K="editing"===d,U=(0,f.SE)(r.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==W?void 0:W.id},subject:{id:null==W?void 0:W.id}}),Z=0===t.parent?void 0:t.parent,Y=a&&n,{data:X,isSuccess:ee,isLoading:et,isFetchingNextPage:ea,hasNextPage:es,fetchNextPage:er,isPreviousData:en,isFetching:el}=eY({projectRef:O,folderId:null!=Z?Z:t.id,name:T,sort:A},{enabled:Y,keepPreviousData:!0});(0,p.useEffect)(()=>{O&&ee&&X.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{$.addSnippet({projectRef:O,snippet:e})})})},[O,null==X?void 0:X.pages]);let ei=(0,eX.A)(I);(0,p.useEffect)(()=>{if(Y){var e;null==(e=ei.current)||e.call(ei,{isLoading:et||en&&el,snippets:null==X?void 0:X.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]})})}},[null==X?void 0:X.pages,el,et,en,Y]);let eo=void 0!==Z;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e7.tz,{modal:!1,"data-sentry-element":"ContextMenu_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:[(0,s.jsx)(e7.Rc,{asChild:!0,"data-sentry-element":"ContextMenuTrigger_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:(0,s.jsx)(z.Z7,{className:B,level:i,isExpanded:n,isBranch:a,isSelected:c,isPreview:D.isPreview,isEditing:K,isLoading:Y&&et||"saving"===d,onEditSubmit:e=>{void 0!==M&&M(e)},onClick:e=>{a?K||V(e):e.shiftKey&&"new"!==F?null==k||k(t.id):R.push("/project/".concat(O,"/sql/").concat(t.id))},...D,name:t.name,xPadding:16,"data-sentry-element":"TreeViewItem","data-sentry-source-file":"SQLEditorTreeViewItem.tsx"})}),(0,s.jsx)(e7.Ip,{onCloseAutoFocus:e=>e.stopPropagation(),"data-sentry-element":"ContextMenuContent_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:a?(0,s.jsxs)(s.Fragment,{children:[void 0!==h&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(o.A,{size:14}),"Create new snippet"]}),void 0!==j&&G&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>j(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e0.A,{size:14}),"Rename folder"]}),void 0!==y&&G&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e7.K5,{}),(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>y(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e1.A,{size:14}),"Delete folder"]})]})]}):m?(0,s.jsxs)(s.Fragment,{children:[void 0!==b&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e2.A,{size:14}),"Move selected queries"]}),(0,s.jsx)(e7.K5,{}),void 0!==y&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>y(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e1.A,{size:14}),"Delete selected queries"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e7.kt,{asChild:!0,className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),children:(0,s.jsxs)(E(),{target:"_self",rel:"noreferrer",href:"/project/".concat(O,"/sql/").concat(t.id),children:[(0,s.jsx)(J.A,{size:14}),"Open in new tab"]})}),(0,s.jsx)(e7.K5,{}),void 0!==j&&G&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>j(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e0.A,{size:14}),"Rename query"]}),void 0!==b&&G&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e2.A,{size:14}),"Move query"]}),void 0!==w&&!H&&U&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>w(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e5.A,{size:14}),"Share query with team"]}),void 0!==N&&H&&G&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>N(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e4.A,{size:14}),"Unshare query with team"]}),void 0!==q&&U&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>q(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e3.A,{size:14}),"Duplicate query"]}),void 0!==C&&l.pe&&(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>C(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(e6.A,{size:14}),"Download as migration file"]}),void 0!==y&&G&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e7.K5,{}),(0,s.jsxs)(e7.kt,{className:"gap-x-2",onSelect:()=>y(),children:[(0,s.jsx)(e1.A,{size:14}),"Delete query"]})]})]})})]}),(eo?es:L)&&"string"==typeof t.id&&P&&(0,s.jsx)("div",{className:"px-4 py-1",style:{paddingLeft:!t.isBranch&&t.level>1?48*(t.level-1):void 0},children:(0,s.jsx)(S.$,{type:"outline",size:"tiny",block:!0,loading:eo?ea:Q,disabled:eo?ea:Q,onClick:function(){eo?er():"function"==typeof _&&_()},children:"Load More"})})]})},e9={shared:!1,favorite:!1,private:!0},te=e=>{var t,a,r,n,i,o,d;let{sort:c="inserted_at"}=e,f=(0,u.useRouter)(),{ref:y,id:j}=(0,l.g)(),{profile:b}=(0,g.xc)(),S=(0,h.KT)(),N=(0,v.aP)(),C=(0,eC.zv)(),[q,M]=(0,x.M)(l.rS.SQL_EDITOR_SECTION_STATE(null!=y?y:""),e9),{shared:E,favorite:k,private:P}=q,[L,_]=(0,p.useState)(!1),[Q,T]=(0,p.useState)(!1),[I,D]=(0,p.useState)(!1),[F,O]=(0,p.useState)([]),[W,B]=(0,p.useState)([]),[K,U]=(0,p.useState)(),[J,Z]=(0,p.useState)(),[Y,X]=(0,p.useState)(),[ee,et]=(0,p.useState)(),[er,en]=(0,p.useState)(),el=null==(t=N.snippets[j])?void 0:t.snippet,{data:ei,isSuccess:eo,isLoading:eu,isPreviousData:ep,isFetching:em,hasNextPage:ef,fetchNextPage:ex,isFetchingNextPage:eh}=(0,R.e9)({projectRef:y,sort:c},{keepPreviousData:!0}),[eg,ey]=(0,p.useState)({}),ej=(0,p.useMemo)(()=>{var e;let t=null!=(e=null==ei?void 0:ei.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[],a=Object.values(eg).reduce((e,t)=>{var a;let s=(null!=(a=t.snippets)?a:[]).filter(t=>!e.snippetIds.has(t.id)),r=new Set(s.map(e=>e.id));return{snippets:[...e.snippets,...s],isLoading:e.isLoading||t.isLoading,snippetIds:new Set([...e.snippetIds,...r])}},{snippets:t,isLoading:eu||ep&&em,snippetIds:new Set(t.map(e=>e.id))});return el&&"user"===el.visibility&&!a.snippetIds.has(el.id)&&(a.snippetIds.add(el.id),a.snippets=[...a.snippets,el]),a},[null==ei?void 0:ei.pages,eg,eu,ep,em,el]),eb=(0,p.useMemo)(()=>{var e,t;return null!=(t=null==(e=ej.snippets)?void 0:e.filter(e=>"user"===e.visibility).sort((e,t)=>"name"===c?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[ej.snippets,c]),eS=(0,v.mD)(y),{data:ew}=A({projectRef:y,type:"sql"}),eN=null!=(n=null==ew?void 0:ew.private)?n:0,eq=(0,p.useMemo)(()=>0===eS.length&&0===eb.length?[eH]:eK({folders:eS,contents:eb}),[eS,eb]),eM=(0,p.useMemo)(()=>eU(eq),[eq]),{data:eE,isLoading:ek,hasNextPage:e_,fetchNextPage:eD,isFetchingNextPage:eR,isSuccess:eF}=(0,eO.I)({projectRef:y,favorite:!0,sort:c},{enabled:k,keepPreviousData:!0}),e$=(0,p.useMemo)(()=>{var e,t;let a=null!=(e=null==eE?void 0:eE.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return el&&el.favorite&&!a.find(e=>e.id===el.id)&&a.push(el),null!=(t=a.map(e=>({...e,folder_id:void 0})).sort((e,t)=>"name"===c?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==eE?void 0:eE.pages,el,c]),eJ=null!=(i=null==ew?void 0:ew.favorites)?i:0,eZ=(0,p.useMemo)(()=>0===e$.length?[eH]:eK({contents:e$,folders:[]}),[e$]),eY=(0,p.useMemo)(()=>eU(eZ),[eZ]),{data:eX,isLoading:e0,hasNextPage:e1,fetchNextPage:e2,isFetchingNextPage:e5,isSuccess:e4}=(0,eO.I)({projectRef:y,visibility:"project",sort:c},{enabled:E,keepPreviousData:!0}),e3=(0,p.useMemo)(()=>{var e,t;let a=null!=(e=null==eX?void 0:eX.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return el&&"project"===el.visibility&&!a.find(e=>e.id===el.id)&&a.push(el),null!=(t=a.sort((e,t)=>"name"===c?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==eX?void 0:eX.pages,el,c]),e6=null!=(o=null==ew?void 0:ew.shared)?o:0,e7=(0,p.useMemo)(()=>0===e3.length?[eH]:eK({contents:e3,folders:[]}),[e3]),te=(0,p.useMemo)(()=>eU(e7),[e7]),tt=(0,p.useMemo)(()=>{var e,t;return[...null!=(e=null==ei?void 0:ei.pages.flatMap(e=>e.contents))?e:[],...null!=(t=null==eX?void 0:eX.pages.flatMap(e=>e.contents))?t:[]]},[ei,eX]),{mutate:ta,isLoading:ts}=(0,ec.v)({onError:e=>{m.oR.error("Failed to update query: ".concat(e.message))}}),{mutate:tr,isLoading:tn}=(0,eI.$)({onSuccess:e=>{let t=e.map(e=>(0,eC.lW)("sql",{id:e}));C.removeTabs(t)},onError:(e,t)=>{e.message.includes("Contents not found")?to(t.ids):m.oR.error("Failed to delete query: ".concat(e.message))}}),{mutate:tl,isLoading:ti}=ez({onSuccess:(e,t)=>{m.oR.success("Successfully deleted folder");let{ids:a}=t;N.removeFolder(a[0]),en(void 0)}}),to=e=>{T(!1),B([]);let t=Object.keys(N.snippets).filter(t=>!e.includes(t));0===t.length?f.push("/project/".concat(y,"/sql/new")):e.includes(j)&&f.push("/project/".concat(y,"/sql/").concat(t[0])),e.length>0&&e.forEach(e=>N.removeSnippet(e))},td=async e=>{var t;let a="share"===e?K:J;if(!y)return console.error("Project ref is required");if(!a)return console.error("Snippet ID is required");let s=N.snippets[a.id],r=null==s||null==(t=s.snippet)?void 0:t.content;if(void 0===r){let{content:e}=await (0,ed.Q)({projectRef:y,id:a.id});r=e}if(void 0===r)return m.oR.error("Unable to update snippet visibility: Content is missing");let n="share"===e?"project":"user";ta({projectRef:y,payload:{...a,visibility:n,folder_id:null,content:r}},{onSuccess:()=>{U(void 0),Z(void 0),M({...q,shared:!0}),N.updateSnippet({id:a.id,snippet:{visibility:n,folder_id:null},skipSave:!0}),m.oR.success("share"===e?"Snippet is now shared to the project":"Snippet is now unshared from the project")}})},tc=async e=>{if(!b)return console.error("Profile is required");if(!S)return console.error("Project is required");if(!y)return console.error("Project ref is required");if(!j)return console.error("Snippet ID is required");let t="";if(e.content&&e.content.sql)t=e.content.sql;else{let{content:a}=await (0,ed.Q)({projectRef:y,id:e.id});"sql"in a&&(t=a.sql)}let a=(0,ea.fW)({id:(0,eW.A)(),name:"".concat(e.name," (Duplicate)"),sql:t,owner_id:null==b?void 0:b.id,project_id:null==S?void 0:S.id});N.addSnippet({projectRef:y,snippet:a}),N.addNeedsSaving(a.id),f.push("/project/".concat(y,"/sql/").concat(a.id))},tu=async()=>{if(!y)return console.error("Project ref is required");if(void 0===er)return console.error("No folder is selected");let e=eb.filter(e=>e.folder_id===er.id);if(e.length>0){let t=e.map(e=>e.id);tr({projectRef:y,ids:t},{onSuccess:()=>{t.forEach(e=>N.removeSnippet(e)),to(t),tl({projectRef:y,ids:[null==er?void 0:er.id]})}})}else tl({projectRef:y,ids:[null==er?void 0:er.id]})},tp=e=>{let t=eb.map(e=>e.id),a=t.indexOf(j),s=t.indexOf(e),r=Math.min(a,s),n=Math.max(a,s),l=[],i=eb[r].folder_id===eb[n].folder_id;for(let e=r;e<=n;e++)i&&eb[e].folder_id===eb[r].folder_id&&l.push(eb[e]);B(l)};(0,p.useEffect)(()=>{void 0!==el&&eo&&("project"===el.visibility?M({...q,shared:!0}):"user"===el.visibility&&M({...q,private:!0}),el.folder_id&&!F.includes(el.folder_id)&&O([...F,el.folder_id]))},[el,c,eo]),(0,p.useEffect)(()=>{B([])},[j]),(0,p.useEffect)(()=>{y&&ei&&ei.pages.forEach(e=>{var t,a;null==(t=e.contents)||t.forEach(e=>{N.addSnippet({projectRef:y,snippet:e})}),null==(a=e.folders)||a.forEach(e=>N.addFolder({projectRef:y,folder:e}))})},[y,null==ei?void 0:ei.pages]),(0,p.useEffect)(()=>{void 0!==y&&eF&&eE.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{N.addSnippet({projectRef:y,snippet:e})})})},[y,null==eE?void 0:eE.pages]),(0,p.useEffect)(()=>{void 0!==y&&e4&&eX.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{N.addSnippet({projectRef:y,snippet:e})})})},[y,null==eX?void 0:eX.pages]);let tm=(0,eT.x)();return(0,p.useEffect)(()=>{eo&&tm({snippets:tt})},[tt,eo,tm]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(w.hm,{className:"px-0",open:E,onOpenChange:e=>{M({...null!=q?q:e9,shared:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,s.jsx)(w.Pq,{title:"Shared ".concat(e6>0?" (".concat(e6,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:e0?(0,s.jsx)(eG,{}):0===e3.length?(0,s.jsx)(w.Q5,{className:"mx-2",title:"No shared queries",description:"Share queries with your team by right-clicking on the query."}):(0,s.jsx)(z.GS,{data:e7,"aria-label":"project-level-snippets",nodeRenderer:e=>{var t,a;let{element:r,...n}=e,l=Object.values(C.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=r.metadata)?void 0:a.id)}),i=(0,eC.lW)("sql",{id:null==r||null==(t=r.metadata)?void 0:t.id}),o=C.previewTabId===i,d=!o&&(null==(a=r.metadata)?void 0:a.id)===j,c=W.some(e=>{var t;return e.id===(null==(t=r.metadata)?void 0:t.id)});return(0,s.jsx)(e8,{...n,isOpened:l&&!o,isSelected:d||c,isPreview:o,onDoubleClick:e=>{e.preventDefault(),C.makeTabPermanent(i)},element:r,onSelectDelete:()=>{T(!0),B([r.metadata])},onSelectRename:()=>{D(!0),X(r.metadata)},onSelectDownload:()=>{et(r.metadata)},onSelectDuplicate:()=>{tc(r.metadata)},onSelectUnshare:()=>{Z(r.metadata)},isLastItem:te.has(r.id),hasNextPage:e1,fetchNextPage:e2,isFetchingNextPage:e5})}})})]}),(0,s.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsxs)(w.hm,{className:"px-0",open:k,onOpenChange:e=>{M({...null!=q?q:e9,favorite:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,s.jsx)(w.Pq,{title:"Favorites ".concat(eJ>0?" (".concat(eJ,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:ek?(0,s.jsx)(eG,{}):0===e$.length?(0,s.jsx)(w.Q5,{title:"No favorite queries",className:"mx-2 px-3",description:(0,s.jsxs)(s.Fragment,{children:["Save a query to favorites for easy accessibility by clicking the"," ",(0,s.jsx)(V.A,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})}):(0,s.jsx)(z.GS,{data:eZ,"aria-label":"favorite-snippets",nodeRenderer:e=>{var t,a;let{element:r,...n}=e,l=Object.values(C.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=r.metadata)?void 0:a.id)}),i=(0,eC.lW)("sql",{id:null==r||null==(t=r.metadata)?void 0:t.id}),o=C.previewTabId===i,d=!o&&(null==(a=r.metadata)?void 0:a.id)===j,c=W.some(e=>{var t;return e.id===(null==(t=r.metadata)?void 0:t.id)});return(0,s.jsx)(e8,{...n,isSelected:d||c,isOpened:l&&!o,isPreview:o,onDoubleClick:e=>{e.preventDefault(),C.makeTabPermanent(i)},element:r,onSelectDelete:()=>{T(!0),B([r.metadata])},onSelectRename:()=>{D(!0),X(r.metadata)},onSelectDownload:()=>{et(r.metadata)},onSelectDuplicate:()=>{tc(r.metadata)},onSelectShare:()=>U(r.metadata),onSelectUnshare:()=>{Z(r.metadata)},isLastItem:eY.has(r.id),hasNextPage:e_,fetchNextPage:eD,isFetchingNextPage:eR})}})})]}),(0,s.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsxs)(w.hm,{open:P,onOpenChange:e=>{M({...null!=q?q:e9,private:e})},className:"px-0","data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,s.jsx)(w.Pq,{title:"PRIVATE\n            ".concat(eN>0?" (".concat(eN,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:eu?(0,s.jsx)(eA.A,{}):0===eS.length&&0===eb.length?(0,s.jsx)(eQ,{}):(0,s.jsx)(z.GS,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:eq,selectedIds:W.map(e=>e.id),"aria-label":"private-snippets",onExpand:e=>{let t=e.element.id.toString();e.isExpanded&&!F.includes(t)&&O([...F,t]),!e.isExpanded&&F.includes(t)&&O(F.filter(e=>e!==t))},expandedIds:F,nodeRenderer:e=>{var t,a;let{element:r,...n}=e,l=Object.values(C.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=r.metadata)?void 0:a.id)}),i=(0,eC.lW)("sql",{id:null==r||null==(t=r.metadata)?void 0:t.id}),o=C.previewTabId===i,d=!o&&(null==(a=r.metadata)?void 0:a.id)===j,u=W.some(e=>{var t;return e.id===(null==(t=r.metadata)?void 0:t.id)});return(0,s.jsx)(e8,{...n,element:r,isOpened:l&&!o,isSelected:d||u,isPreview:o,isMultiSelected:W.length>1,isLastItem:eM.has(r.id),status:n.isBranch?N.folders[r.id].status:"idle",onMultiSelect:tp,onSelectCreate:()=>{if(b&&S){let e=(0,ea.fW)({id:(0,eW.A)(),name:eL.tO,owner_id:null==b?void 0:b.id,project_id:null==S?void 0:S.id,folder_id:r.id,sql:""});N.addSnippet({projectRef:S.ref,snippet:e}),f.push("/project/".concat(y,"/sql/").concat(e.id))}},onSelectDelete:()=>{n.isBranch?en(r.metadata):(T(!0),0===W.length&&B([r.metadata]))},onSelectRename:()=>{n.isBranch?N.editFolder(r.id):(D(!0),X(r.metadata))},onSelectMove:()=>{_(!0),0===W.length&&B([r.metadata])},onSelectDownload:()=>et(r.metadata),onSelectDuplicate:()=>tc(r.metadata),onSelectShare:()=>U(r.metadata),onEditSave:e=>{0===e.length&&"new-folder"===r.id?N.removeFolder(r.id):e.length>0&&N.saveFolder({id:r.id,name:e})},hasNextPage:ef,fetchNextPage:ex,isFetchingNextPage:eh,sort:c,onFolderContentsChange:e=>{let{isLoading:t,snippets:a}=e;ey(e=>({...e,[r.id]:{snippets:a,isLoading:t}}))},onDoubleClick:e=>{e.preventDefault(),C.makeTabPermanent(i)}})}})})]}),(0,s.jsx)(eB.w,{"data-sentry-element":"Separator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(eP,{snippet:Y,visible:I,onCancel:()=>D(!1),onComplete:()=>D(!1),"data-sentry-element":"RenameQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(ev,{snippets:W,visible:L,onClose:()=>{_(!1),B([])},"data-sentry-element":"MoveQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(es,{id:null!=(d=null==ee?void 0:ee.id)?d:"",visible:void 0!==ee,onCancel:()=>et(void 0),"data-sentry-element":"DownloadSnippetModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)(eV.A,{size:"medium",loading:ts,title:"Confirm to share query: ".concat(null==K?void 0:K.name),confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==K,onCancel:()=>U(void 0),onConfirm:()=>td("share"),alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,s.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,s.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,s.jsx)($.A,{size:16,"data-sentry-element":"Eye","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,s.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,s.jsx)(G.A,{size:16,"data-sentry-element":"Unlock","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,s.jsx)(eV.A,{size:"medium",title:"Confirm to unshare query: ".concat(null==J?void 0:J.name),confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==J,onCancel:()=>Z(void 0),onConfirm:()=>td("unshare"),alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,s.jsx)("ul",{className:"text-sm text-foreground-light space-y-5",children:(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(H.A,{"data-sentry-element":"EyeOffIcon","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,s.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})}),(0,s.jsx)(eV.A,{size:"small",title:"Confirm to delete ".concat(1===W.length?"query":"".concat(W.length.toLocaleString()," quer").concat(W.length>1?"ies":"y")),confirmLabel:"Delete ".concat(W.length.toLocaleString()," quer").concat(W.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",loading:tn,visible:Q,variant:"destructive",onCancel:()=>{T(!1),B([])},onConfirm:()=>{if(!y)return console.error("Project ref is required");tr({projectRef:y,ids:W.map(e=>e.id)},{onSuccess:e=>{m.oR.success("Successfully deleted ".concat(W.length.toLocaleString()," quer").concat(W.length>1?"ies":"y")),to(e)}})},alert:(null==(a=W[0])?void 0:a.visibility)==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,s.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===W.length?"Are you sure you want to delete '".concat(null==(r=W[0])?void 0:r.name,"'?"):"Are you sure you want to delete the selected ".concat(W.length," quer").concat(W.length>1?"ies":"y","?")]})}),(0,s.jsx)(eV.A,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:ti,visible:void 0!==er,variant:"destructive",onCancel:()=>en(void 0),onConfirm:tu,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",null==er?void 0:er.name,"'?"]})})]})},tt=()=>{let e=(0,u.useRouter)(),{profile:t}=(0,g.xc)(),a=(0,h.KT)(),{ref:N}=(0,l.g)(),q=(0,v.aP)(),[M,E]=(0,p.useState)(""),[k,P]=(0,p.useState)(!1),[L,_]=(0,x.M)(l.rS.SQL_EDITOR_SORT(null!=N?N:""),"inserted_at"),Q=(0,y.Nj)(),A=(0,n.d7)(M,500),T=(0,f.SE)(r.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==t?void 0:t.id},subject:{id:null==t?void 0:t.id}}),I=()=>{if(!N)return console.error("Project ref is required");E(""),P(!1),q.addNewFolder({projectRef:N})},D=async()=>{if(!N)return console.error("Project ref is required");if(!a)return console.error("Project is required");if(!t)return console.error("Profile is required");if(!T)return(0,m.oR)("Your queries will not be saved as you do not have sufficient permissions");try{e.push("/project/".concat(N,"/sql/new?skip=true")),E(""),P(!1)}catch(e){m.oR.error("Failed to create new query: ".concat(e.message))}};return(0,p.useEffect)(()=>{P(A.length>0)},[A]),(0,s.jsxs)("div",{className:"h-full flex flex-col justify-between","data-sentry-component":"SQLEditorMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-4 flex-grow",children:[(0,s.jsxs)("div",{className:"mt-4 mx-4 flex items-center justify-between gap-x-2",children:[(0,s.jsx)(w.a0,{className:"w-full p-0 gap-0","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,s.jsx)(w.RK,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:M,onChange:e=>{let t=e.target.value;E(t),0===t.length&&P(!1)},onKeyDown:e=>{"Escape"===e.code&&(E(""),P(!1))},"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"SQLEditorMenu.tsx",children:k?(0,s.jsxs)(j.m_,{children:[(0,s.jsx)(j.k$,{className:"absolute right-1 top-[.4rem] md:top-[.3rem] transition-colors text-foreground-light hover:text-foreground",onClick:()=>{E(""),P(!1)},children:(0,s.jsx)(i.A,{size:18})}),(0,s.jsx)(j.ZI,{children:"Clear search"})]}):(0,s.jsxs)(w.i9,{value:L,onValueChange:e=>_(e),children:[(0,s.jsx)(w.Pl,{value:"name",children:"Alphabetical"},"name"),(0,s.jsx)(w.Pl,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,s.jsxs)(b.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,s.jsx)(b.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,s.jsx)(S.$,{"data-testId":"sql-editor-new-query-button",type:"default",icon:(0,s.jsx)(o.A,{className:"text-foreground"}),className:"w-[26px]","data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx"})}),(0,s.jsxs)(b.SQ,{align:"end",side:"bottom",className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,s.jsxs)(b._2,{className:"gap-x-2",onClick:()=>D(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,s.jsx)(d.A,{size:14,"data-sentry-element":"FilePlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new snippet"]}),(0,s.jsxs)(b._2,{className:"gap-x-2",onClick:()=>I(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,s.jsx)(c.A,{size:14,"data-sentry-element":"FolderPlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new folder"]})]})]})]}),k?(0,s.jsx)(W,{search:A}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C,{}),(0,s.jsx)(te,{sort:L})]})]}),(0,s.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,s.jsx)(S.$,{block:!0,type:"default",onClick:()=>Q.setOnGoingQueriesPanelOpen(!0),"data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx",children:"View running queries"})})]})}},59710:(e,t,a)=>{a.d(t,{K:()=>i,Q:()=>l});var s=a(56947),r=a(48678),n=a(65210);async function l(e,t){let{projectRef:a,id:s}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===s)throw Error("Content ID is required");let{data:n,error:l}=await (0,r.Jt)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:a,id:s}},signal:t});if(l)throw(0,r.H4)(l);return n}let i=function(e){let{projectRef:t,id:a}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(n.M.resource(t,a),e=>{let{signal:s}=e;return l({projectRef:t,id:a},s)},{enabled:r&&void 0!==t&&void 0!==a,...i})}},83523:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(80263),r=a(46115),n=a(53239),l=a(5548);let i=e=>{var t,a,i;let{defaultActiveId:o,activeId:d,type:c="pills",size:u="tiny",block:p,onChange:m,onClick:f,scrollable:x,wrappable:h,addOnBefore:g,addOnAfter:y,listClassNames:v,baseClassNames:j,refs:b,children:S}=e,w=n.Children.toArray(S),[N,C]=(0,n.useState)(null!=(i=null!=d?d:o)?i:null==w||null==(a=w[0])||null==(t=a.props)?void 0:t.id);(0,n.useMemo)(()=>{d&&d!==N&&C(d)},[d]);let q=(0,l.A)("tabs");function M(e){null==f||f(e),e!==N&&(null==m||m(e),C(e))}let E=[q[c].list];return x&&E.push(q.scrollable),h&&E.push(q.wrappable),v&&E.push(v),(0,s.jsxs)(r.bL,{value:N,className:[q.base,j].join(" "),ref:null==b?void 0:b.base,"data-sentry-element":"unknown","data-sentry-component":"Tabs","data-sentry-source-file":"Tabs.tsx",children:[(0,s.jsxs)(r.B8,{className:E.join(" "),ref:null==b?void 0:b.list,"data-sentry-element":"unknown","data-sentry-source-file":"Tabs.tsx",children:[g,w.map(e=>{let t=N===e.props.id,a=[q[c].base,q.size[u]];return t?a.push(q[c].active):a.push(q[c].inactive),p&&a.push(q.block),(0,s.jsxs)(r.l9,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),M(e.props.id))},onClick:()=>M(e.props.id),value:e.props.id,className:a.join(" "),children:[e.props.icon,(0,s.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),y]}),w]})};i.Panel=e=>{let{children:t,id:a,className:n}=e,i=(0,l.A)("tabs");return(0,s.jsx)(r.UC,{value:a,className:[i.content,n].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Panel","data-sentry-source-file":"Tabs.tsx",children:t})};let o=i},99130:(e,t,a)=>{a.d(t,{B:()=>l,x:()=>i});var s=a(26413),r=a(53239),n=a(53674);function l(){let e=(0,n.zv)(),t=(0,s.A)(e.tabsMap),a=(0,s.A)(e.recentItems),l=(0,s.A)(e.openTabs);return(0,r.useCallback)(s=>{let{schemas:r,entities:i}=s,o=i.map(e=>(0,n.lW)(e.type,{id:e.id})),d=[];for(let e of r)d.push(...a.current.filter(t=>{var a;return(null==(a=t.metadata)?void 0:a.schema)===e}).map(e=>e.id));let c=[...d.filter(e=>!o.includes(e))];e.removeRecentItems(c);let u=[];for(let e of r)u.push(...l.current.filter(a=>{var s;return(null==(s=t.current[a].metadata)?void 0:s.schema)===e}));let p=[...u.filter(e=>!e.startsWith("sql")&&!e.startsWith("schema")&&!o.includes(e))];e.removeTabs(p),l.current.map(e=>t.current[e]).filter(e=>{var t;return null==(t=n.qm.table)?void 0:t.includes(e.type)}).forEach(t=>{let a=null==i?void 0:i.find(e=>{var a;return(null==(a=t.metadata)?void 0:a.tableId)===e.id});a&&a.name!==t.label&&e.updateTab(t.id,{label:a.name})})},[])}function i(){let e=(0,n.zv)(),t=(0,s.A)(e.tabsMap),a=(0,s.A)(e.openTabs);return(0,r.useCallback)(s=>{let{snippets:r}=s,l=[...r.filter(e=>"sql"===e.type).map(e=>(0,n.lW)("sql",{id:e.id})),"sql-templates","sql-quickstarts"],i=a.current.filter(e=>e.startsWith("sql")&&!l.includes(e));e.removeTabs(i);let o=e.getRecentItemsByType("sql");e.removeRecentItems(o?o.filter(e=>!l.includes(e.id)).map(e=>e.id):[]),a.current.map(e=>t.current[e]).filter(e=>{var t;return null==(t=n.qm.sql)?void 0:t.includes(e.type)}).forEach(t=>{let a=null==r?void 0:r.find(e=>{var a;return(null==(a=t.metadata)?void 0:a.sqlId)===e.id});a&&a.name!==t.label&&e.updateTab(t.id,{label:a.name})})},[])}}}]);