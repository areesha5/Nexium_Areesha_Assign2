!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="faee2fc7-0f8e-4e7d-8491-4b892c0ff18c",e._sentryDebugIdIdentifier="sentry-dbid-faee2fc7-0f8e-4e7d-8491-4b892c0ff18c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3080],{4197:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(84497).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},46160:(e,t,a)=>{a.d(t,{OJ:()=>j,Pl:()=>S,Pq:()=>y,Q5:()=>C,RK:()=>k,a0:()=>_,ag:()=>w,hm:()=>b,i9:()=>N,qP:()=>g,ue:()=>v});var s=a(80263),l=a(57728),i=a(58394),n=a(76584),r=a(37859),o=a(8758),c=a.n(o),d=a(53239),u=a(9079),m=a(82457),p=a(23601),f=a(93263),x=a(42206),h=a(85462);let b=(0,d.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsx)(u.Nt,{ref:t,...a,className:(0,m.cn)("w-full px-2 group",a.className)})}),y=(0,d.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsxs)(u.R6,{ref:t,...a,className:(0,m.cn)("w-full flex gap-1 items-center group px-3 text-sm font-normal font-mono uppercase text-lighter tracking-wide",a.className),children:[(0,s.jsx)(l.A,{className:"transition-all text-foreground-muted group-data-[state=open]:rotate-90",size:16,strokeWidth:1.5}),(0,s.jsx)("span",{className:"group-hover:not-disabled:text-foreground",children:a.title})]})}),g=(0,d.forwardRef)((e,t)=>{let{...a}=e;return(0,s.jsx)(u.Ke,{ref:t,...a,className:(0,m.cn)("w-full flex flex-col gap-0",a.className)})}),j=(0,d.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,m.cn)("h-px bg-border-muted",e.className)})),v=(0,d.forwardRef)((e,t)=>{let{className:a,isActive:l,forceHoverState:i,...n}=e;return(0,s.jsx)(c(),{ref:t,...n,"aria-current":l,className:(0,m.cn)("text-sm","h-7 pl-3 pr-2","flex items-center justify-between rounded-md group relative",l?"bg-selection":"hover:bg-surface-200",i&&"bg-surface-200",l?"text-foreground":"text-foreground-light hover:text-foreground",a)})}),w=(0,d.forwardRef)((e,t)=>{let{isActive:a=!0,forceHoverState:l,isPreview:i,isOpened:n=!0,...r}=e;return(0,s.jsxs)(c(),{ref:t,...r,"aria-current":a,className:(0,m.cn)((0,p.u2)({isSelected:a&&!i,isOpened:n&&!i,isPreview:i}),"px-4",r.className),children:[!i&&a&&(0,s.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),r.children]})}),_=(0,d.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,m.cn)("flex px-2 gap-2 items-center",e.className)})),k=(0,d.forwardRef)((e,t)=>{let{children:a,isLoading:l=!1,...r}=e;return(0,s.jsxs)("label",{htmlFor:r.name,className:"relative w-full",children:[(0,s.jsx)("span",{className:"sr-only",children:r["aria-labelledby"]}),(0,s.jsx)(f.p,{ref:t,type:"text",className:(0,m.cn)("h-[32px] md:h-[28px] w-full","text-base md:text-xs","pl-7","pr-7","w-full","rounded",r.className),...r}),a,l?(0,s.jsx)(i.A,{className:"animate-spin absolute left-2 text-foreground-muted",style:{top:7},size:14,strokeWidth:1.5}):(0,s.jsx)(n.A,{className:"absolute left-2 top-2 text-foreground-muted",size:14,strokeWidth:1.5})]})}),N=(0,d.forwardRef)((e,t)=>{let{value:a,onValueChange:l,contentClassName:i,triggerClassName:n,...o}=e;return(0,s.jsxs)(x.rI,{modal:!1,children:[(0,s.jsxs)(h.m_,{delayDuration:0,children:[(0,s.jsx)(x.ty,{asChild:!0,className:(0,m.cn)("absolute right-1 top-[.4rem] md:top-[.3rem]","text-foreground transition-colors hover:text-foreground data-[state=open]:text-foreground",n),children:(0,s.jsx)(h.k$,{children:(0,s.jsx)(r.A,{size:18,strokeWidth:1})})}),(0,s.jsx)(h.ZI,{side:"bottom",children:"Sort By"})]}),(0,s.jsx)(x.SQ,{side:"bottom",align:"end",className:(0,m.cn)("w-48",i),children:(0,s.jsx)(x.Hr,{value:a,onValueChange:l,children:o.children})})]})}),S=(0,d.forwardRef)((e,t)=>(0,s.jsx)(x.Ht,{ref:t,...e})),C=(0,d.forwardRef)((e,t)=>{let{illustration:a,title:l,description:i,actions:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,m.cn)("border border-muted bg-surface-100 dark:bg-surface-75 flex flex-col gap-y-3 items-center justify-center rounded-md px-5 py-4",r.className),children:(0,s.jsxs)("div",{className:"w-full flex flex-col gap-y-1 items-center",children:[a,l&&(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:l}),i&&(0,s.jsx)("p",{className:"text-xs text-foreground-lighter text-center",children:i}),n&&(0,s.jsx)("div",{className:"mt-2",children:n}),r.children]})})})},53165:(e,t,a)=>{a.d(t,{Ay:()=>r});var s=a(80263),l=a(90709);a(53239);var i=a(5548);let n=e=>{let{open:t,children:a,className:i,...n}=e;return(0,s.jsx)(l.bL,{asChild:n.asChild,defaultOpen:n.defaultOpen,open:t,onOpenChange:n.onOpenChange,disabled:n.disabled,className:i,"data-sentry-element":"unknown","data-sentry-component":"Collapsible","data-sentry-source-file":"Collapsible.tsx",children:a})};n.Trigger=function(e){let{children:t,asChild:a}=e;return(0,s.jsx)(l.l9,{asChild:a,"data-sentry-element":"unknown","data-sentry-component":"Trigger","data-sentry-source-file":"Collapsible.tsx",children:t})},n.Content=function(e){let{asChild:t,children:a,className:n}=e,r=(0,i.A)("collapsible");return(0,s.jsx)(l.UC,{asChild:t,className:[r.content,n].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Content","data-sentry-source-file":"Collapsible.tsx",children:a})};let r=n},56404:(e,t,a)=>{a.d(t,{Mj:()=>m,d7:()=>i});var s=a(53239);function l(e,t){window.dispatchEvent(new StorageEvent("storage",{key:e,newValue:t}))}function i(e,t){let[a,l]=s.useState(e);return s.useEffect(()=>{let a=setTimeout(()=>{l(e)},t);return()=>{clearTimeout(a)}},[e,t]),a}let n={past:[],present:null,future:[]},r=(e,t)=>{let a=JSON.stringify(t);window.localStorage.setItem(e,a),l(e,a)},o=e=>{window.localStorage.removeItem(e),l(e,null)},c=e=>window.localStorage.getItem(e),d=e=>(window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)),u=()=>{throw Error("useLocalStorage is a client-only hook")};function m(e,t){let a=s.useSyncExternalStore(d,()=>c(e),u),l=s.useCallback(t=>{try{let s="function"==typeof t?t(JSON.parse(a)):t;null==s?o(e):r(e,s)}catch(e){console.warn(e)}},[e,a]);return s.useEffect(()=>{null===c(e)&&void 0!==t&&r(e,t)},[e,t]),[a?JSON.parse(a):t,l]}let p=()=>navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection},73080:(e,t,a)=>{a.d(t,{A:()=>ed});var s=a(80263),l=a(92226),i=a(72865),n=a(60045),r=a(56404),o=a(669),c=a(37126),d=a(8758),u=a.n(d),m=a(87355),p=a(53239),f=a(25481),x=a(47330),h=a(73969),b=a(40897),y=a(34745),g=a(83076),j=a(32144),v=a(80251),w=a(48678),_=a(4838);async function k(e){let{projectRef:t,id:a,isPublic:s,file_size_limit:l,allowed_mime_types:i}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let n={id:a,public:s};l&&(n.file_size_limit=l),i&&(n.allowed_mime_types=i);let{data:r,error:o}=await (0,w.bE)("/platform/storage/{ref}/buckets",{params:{path:{ref:t}},body:n});return o&&(0,w.H4)(o),r}let N=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,j.jE)();return(0,v.n)(e=>k(e),{async onSuccess(t,a,l){let{projectRef:i}=a;await s.invalidateQueries(_.w.buckets(i)),await (null==e?void 0:e(t,a,l))},async onError(e,a,s){void 0===t?h.oR.error("Failed to create bucket: ".concat(e.message)):t(e,a,s)},...a})};var S=a(32211),C=a(94277),A=a(12523),z=a(82457),E=a(93057),M=a(50003),R=a(53165),B=a(7029),I=a(37263),T=a(84161);let O=e=>{var t;let{visible:a,onClose:l}=e,{ref:i}=(0,f.g)(),n=(0,m.useRouter)(),{mutate:r,isLoading:o}=N({onSuccess:e=>{h.oR.success("Successfully created bucket ".concat(e.name)),n.push("/project/".concat(i,"/storage/buckets/").concat(e.name)),l()}}),{data:c}=(0,g.I)({projectRef:i},{enabled:S.pe&&a}),{value:d,unit:j}=(0,y.Jb)(null!=(t=null==c?void 0:c.fileSizeLimit)?t:0),v="".concat(d," ").concat(j),[w,_]=(0,p.useState)(b.s.BYTES),[k,O]=(0,p.useState)(!1),L=async e=>{if(!i)return console.error("Project ref is required");r({projectRef:i,id:e.name,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,y.OG)(e.formatted_size_limit,w):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null})};return(0,p.useEffect)(()=>{a&&(_(b.s.BYTES),O(!1))},[a]),(0,s.jsx)(C.A,{hideFooter:!0,visible:a,size:"medium",header:"Create storage bucket",onCancel:()=>l(),"data-sentry-element":"Modal","data-sentry-component":"CreateBucketModal","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,s.jsx)(A.A,{validateOnBlur:!1,initialValues:{name:"",public:!1,file_size_limit:0,allowed_mime_types:"",has_file_size_limit:!1,formatted_size_limit:0},validate:e=>{let t={};return e.name||(t.name="Please provide a name for your bucket"),e.name&&!/^[a-z0-9.-]+$/.test(e.name)&&(t.name="The name of the bucket must only container lowercase letters, numbers, dots, and hyphens"),e.name&&e.name.endsWith(" ")&&(t.name="The name of the bucket cannot end with a whitespace"),e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),"public"===e.name&&(t.name='"public" is a reserved name. Please choose another name'),t},onSubmit:L,"data-sentry-element":"Form","data-sentry-source-file":"CreateBucketModal.tsx",children:e=>{let{values:t}=e,a=t.public;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.A.Content,{className:(0,z.cn)("!px-0",a&&"!pb-0"),children:[(0,s.jsx)(E.A,{id:"name",name:"name",type:"text",className:"w-full px-5",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created.",descriptionText:"Only lowercase letters, numbers, dots, and hyphens"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 mt-6",children:[(0,s.jsx)(M.A,{id:"public",name:"public",layout:"flex",className:"px-5",label:"Public bucket",descriptionText:"Anyone can read any object without any authorization"}),a&&(0,s.jsxs)(T.Z,{type:"warning",className:"rounded-none border-x-0 border-b-0 mb-0 [&>div>p]:!leading-normal",title:"Public buckets are not protected",children:[(0,s.jsx)("p",{className:"mb-2",children:"Users can read objects in public buckets without any authorization."}),(0,s.jsx)("p",{children:"Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]})]})]}),(0,s.jsxs)(R.Ay,{open:k,onOpenChange:()=>O(!k),children:[(0,s.jsx)(R.Ay.Trigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,s.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,s.jsx)(x.A,{size:18,strokeWidth:2,className:(0,z.cn)("text-foreground-light",k&&"rotate-180")})]})}),(0,s.jsx)(R.Ay.Content,{className:"py-4",children:(0,s.jsxs)("div",{className:"w-full space-y-5 px-5",children:[(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsx)(M.A,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,s.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,s.jsx)("div",{className:"col-span-8",children:(0,s.jsx)(E.A,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,y.OG)(t.formatted_size_limit,w).toLocaleString()," bytes.")})}),(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsx)(B.A,{id:"size_limit_units",disabled:!1,value:w,onChange:_,children:Object.values(b.s).map(e=>(0,s.jsx)(B.A.Option,{label:e,value:e,children:(0,s.jsx)("div",{children:e})},e))})}),S.pe&&(0,s.jsx)("div",{className:"col-span-12",children:(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: Individual bucket uploads will still be capped at the"," ",(0,s.jsx)(u(),{href:"/project/".concat(i,"/settings/storage"),className:"font-bold underline",children:"global upload limit"})," ","of ",v]})})]})]}),(0,s.jsx)(E.A,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,s.jsx)(C.A.Separator,{}),(0,s.jsxs)(C.A.Content,{className:"flex items-center space-x-2 justify-end",children:[(0,s.jsx)(I.$,{type:"default",htmlType:"button",disabled:o,onClick:()=>l(),children:"Cancel"}),(0,s.jsx)(I.$,{type:"primary",htmlType:"submit",loading:o,disabled:o,children:"Save"})]})]})}})})};var L=a(26455);async function P(e){let{projectRef:t,id:a,isPublic:s,file_size_limit:l,allowed_mime_types:i}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is requried");let n={public:s};void 0!==l&&(n.file_size_limit=l),void 0!==i&&(n.allowed_mime_types=i);let{data:r,error:o}=await (0,w.F6)("/platform/storage/{ref}/buckets/{id}",{params:{path:{id:a,ref:t}},body:n});return o&&(0,w.H4)(o),r}let F=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,j.jE)();return(0,v.n)(e=>P(e),{async onSuccess(t,a,l){let{projectRef:i}=a;await s.invalidateQueries(_.w.buckets(i)),await (null==e?void 0:e(t,a,l))},async onError(e,a,s){void 0===t?h.oR.error("Failed to update bucket: ".concat(e.message)):t(e,a,s)},...a})},q=e=>{var t;let{visible:a,bucket:l,onClose:i}=e,{ref:n}=(0,f.g)(),{mutate:r,isLoading:o}=F({onSuccess:()=>{h.oR.success('Successfully updated bucket "'.concat(null==l?void 0:l.name,'"')),i()}}),{data:c}=(0,g.I)({projectRef:n},{enabled:S.pe&&a}),{value:d,unit:m}=(0,y.Jb)(null!=(t=null==c?void 0:c.fileSizeLimit)?t:0),j="".concat(d," ").concat(m),[v,w]=(0,p.useState)(b.s.BYTES),[_,k]=(0,p.useState)(!1),N=async e=>void 0===l?console.error("Bucket is required"):void 0===n?console.error("Project ref is required"):void r({projectRef:n,id:l.id,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,y.OG)(e.formatted_size_limit,v):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null});return(0,p.useEffect)(()=>{if(a){var e;let{unit:t}=(0,y.Jb)(null!=(e=null==l?void 0:l.file_size_limit)?e:0);w(t),k(!1)}},[a]),(0,s.jsx)(C.A,{hideFooter:!0,visible:a,size:"medium",header:'Edit bucket "'.concat(null==l?void 0:l.name,'"'),onCancel:i,"data-sentry-element":"Modal","data-sentry-component":"EditBucketModal","data-sentry-source-file":"EditBucketModal.tsx",children:(0,s.jsx)(A.A,{validateOnBlur:!1,initialValues:{},validate:e=>{let t={};return e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),t},onSubmit:N,"data-sentry-element":"Form","data-sentry-source-file":"EditBucketModal.tsx",children:e=>{let{values:t,resetForm:r}=e,c=(null==l?void 0:l.public)!==t.public,d=(null==l?void 0:l.public)&&!t.public,m=!(null==l?void 0:l.public)&&t.public;return(0,p.useEffect)(()=>{if(a&&void 0!==l){var e,t,s;let{value:a}=(0,y.Jb)(null!=(e=l.file_size_limit)?e:0),i={name:null!=(t=l.name)?t:"",public:l.public,file_size_limit:l.file_size_limit,allowed_mime_types:(null!=(s=l.allowed_mime_types)?s:[]).join(", "),has_file_size_limit:null!==l.file_size_limit,formatted_size_limit:null!=a?a:0};r({values:i,initialValues:i})}},[a]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.A.Content,{className:(0,z.cn)("!px-0",c&&"!pb-0"),children:[(0,s.jsx)(E.A,{disabled:!0,id:"name",name:"name",type:"text",className:"w-full px-5",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created."}),(0,s.jsxs)("div",{className:(0,z.cn)("flex flex-col gap-y-2 mt-6"),children:[(0,s.jsx)(M.A,{id:"public",name:"public",layout:"flex",label:"Public bucket",className:"px-5",descriptionText:"Anyone can read any object without any authorization"}),c&&(0,s.jsxs)(T.Z,{type:"warning",className:"rounded-none border-x-0 border-b-0 mb-0 [&>div>p]:!leading-normal",title:m?"Warning: Making bucket public":d?"Warning: Making bucket private":"",children:[(0,s.jsx)("p",{children:m?"This will make all objects in your bucket publicly accessible.":d?"All objects in your bucket will be private and only accessible via signed URLs, or downloaded with the right authorisation headers.":""}),d&&(0,s.jsxs)("p",{children:["Assets cached in the CDN may still be publicly accessible. You can consider"," ",(0,s.jsx)(L.g,{href:"https://supabase.com/docs/guides/storage/cdn/smart-cdn#cache-eviction",children:"purging the cache"})," ","or moving your assets to a new bucket."]})]})]})]}),(0,s.jsxs)(R.Ay,{open:_,onOpenChange:()=>k(!_),children:[(0,s.jsx)(R.Ay.Trigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,s.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,s.jsx)(x.A,{size:18,strokeWidth:2,className:(0,z.cn)("text-foreground-light",_&&"rotate-180")})]})}),(0,s.jsx)(R.Ay.Content,{className:"py-4",children:(0,s.jsxs)("div",{className:"w-full space-y-4 px-5",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(M.A,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,s.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,s.jsx)("div",{className:"col-span-8",children:(0,s.jsx)(E.A,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,y.OG)(t.formatted_size_limit,v).toLocaleString()," bytes.")})}),(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsx)(B.A,{id:"size_limit_units",disabled:!1,value:v,onChange:w,children:Object.values(b.s).map(e=>(0,s.jsx)(B.A.Option,{label:e,value:e,children:(0,s.jsx)("div",{children:e})},e))})}),S.pe&&(0,s.jsx)("div",{className:"col-span-12 mt-2",children:(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: Individual bucket upload will still be capped at the"," ",(0,s.jsx)(u(),{href:"/project/".concat(n,"/settings/storage"),className:"font-bold underline",children:"global upload limit"})," ","of ",j]})})]})]}),(0,s.jsx)(E.A,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,s.jsx)(C.A.Separator,{}),(0,s.jsxs)(C.A.Content,{className:"flex items-center space-x-2 justify-end",children:[(0,s.jsx)(I.$,{type:"default",disabled:o,onClick:()=>i(),children:"Cancel"}),(0,s.jsx)(I.$,{type:"primary",htmlType:"submit",loading:o,disabled:o,children:"Save"})]})]})}})})};var D=a(51413);async function W(e){let{projectRef:t,id:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is requried");let{data:s,error:l}=await (0,w.bE)("/platform/storage/{ref}/buckets/{id}/empty",{params:{path:{id:a,ref:t}}});return l&&(0,w.H4)(l),s}let G=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,j.jE)();return(0,v.n)(e=>W(e),{async onSuccess(t,a,l){let{projectRef:i}=a;await s.invalidateQueries(_.w.buckets(i)),await (null==e?void 0:e(t,a,l))},async onError(e,a,s){void 0===t?h.oR.error("Failed to empty bucket: ".concat(e.message)):t(e,a,s)},...a})};var J=a(2647),Q=a(54097);let $=e=>{let{visible:t=!1,bucket:a,onClose:l}=e,{ref:i}=(0,f.g)(),{fetchFolderContents:n}=(0,J.$)(),{mutate:r,isLoading:o}=G({onSuccess:async()=>{void 0!==a&&(await n({bucketId:a.id,folderId:a.id,folderName:a.name,index:-1}),h.oR.success("Successfully deleted bucket ".concat(a.name)),l())}}),c=async()=>i?a?void r({projectRef:i,id:a.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,s.jsx)(Q.A,{variant:"destructive",size:"small",title:"Confirm to delete all contents from ".concat(null==a?void 0:a.name),confirmLabel:"Empty bucket",visible:t,loading:o,onCancel:()=>l(),onConfirm:c,alert:{title:"This action cannot be undone",description:"The contents of your bucket cannot be recovered once deleted"},"data-sentry-element":"ConfirmationModal","data-sentry-component":"EmptyBucketModal","data-sentry-source-file":"EmptyBucketModal.tsx",children:(0,s.jsxs)("p",{className:"text-sm",children:['Are you sure you want to empty the bucket "',null==a?void 0:a.name,'"?']})})};var K=a(13933),Y=a(56259),H=a(79920),U=a(19070),V=a(97008),Z=a(51555),X=a(96773),ee=a(46160),et=a(83927),ea=a.n(et),es=a(39427),el=a(4197),ei=a(98990),en=a(72470),er=a(42206);let eo=e=>{let{bucket:t,projectRef:a="",isSelected:l=!1,onSelectEmptyBucket:i=ea(),onSelectDeleteBucket:r=ea(),onSelectEditBucket:o=ea()}=e,c=(0,U.SE)(n.aG.STORAGE_WRITE,"*");return(0,s.jsxs)("div",{className:(0,z.cn)("group flex items-center justify-between rounded-md",l&&"text-foreground bg-surface-100"),"data-sentry-component":"BucketRow","data-sentry-source-file":"BucketRow.tsx",children:[(0,s.jsx)(u(),{href:"/project/".concat(a,"/storage/buckets/").concat(encodeURIComponent(t.id)),className:(0,z.cn)("py-1 px-3",l?"w-[88%]":"w-full"),"data-sentry-element":"Link","data-sentry-source-file":"BucketRow.tsx",children:(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-2 truncate w-full",children:[(0,s.jsx)("p",{className:"text-sm group-hover:text-foreground transition truncate ".concat(l?"text-foreground":"text-foreground-light"),title:t.name,children:t.name}),t.public&&(0,s.jsx)(en.E,{variant:"warning",children:"Public"})]})}),c&&l?(0,s.jsxs)(er.rI,{children:[(0,s.jsx)(er.ty,{asChild:!0,children:(0,s.jsx)(I.$,{type:"text",icon:(0,s.jsx)(x.A,{}),className:"mr-1 p-0.5"})}),(0,s.jsxs)(er.SQ,{side:"bottom",align:"start",children:[(0,s.jsxs)(er._2,{className:"space-x-2",onClick:()=>o(),children:[(0,s.jsx)(es.A,{size:14}),(0,s.jsx)("p",{children:"Edit bucket"})]},"toggle-private"),(0,s.jsx)(er.mB,{}),(0,s.jsxs)(er._2,{className:"space-x-2",onClick:()=>i(),children:[(0,s.jsx)(el.A,{size:14}),(0,s.jsx)("p",{children:"Empty bucket"})]},"empty-bucket"),(0,s.jsxs)(er._2,{className:"space-x-2",onClick:()=>r(),children:[(0,s.jsx)(ei.A,{size:14}),(0,s.jsx)("p",{children:"Delete bucket"})]},"delete-bucket")]})]}):(0,s.jsx)("div",{className:"w-5"})]},t.id)},ec=()=>{let e=(0,m.useRouter)(),{ref:t,bucketId:a}=(0,f.g)(),l=(0,V.KT)(),i=(null==l?void 0:l.parent_project_ref)!==void 0,[d,x]=(0,p.useState)(""),[h,b]=(0,p.useState)(!1),[y,g]=(0,p.useState)(),[j,v]=(0,p.useState)(),[w,_]=(0,p.useState)(),k=(0,U.SE)(n.aG.STORAGE_WRITE,"*"),[N,S]=(0,r.Mj)("storage-explorer-sort","created-at"),C=e.pathname.split("/")[4],{data:A=[],error:z,isLoading:E,isError:M,isSuccess:R}=(0,H.p)({projectRef:t}),B="alphabetical"===N?A.sort((e,t)=>e.name.toLowerCase().trim().localeCompare(t.name.toLowerCase().trim())):A.sort((e,t)=>new Date(t.created_at)>new Date(e.created_at)?-1:1),I=d.length>1?B.filter(e=>e.name.includes(d.trim())):B,T=(null==z?void 0:z.message.includes("Tenant config"))&&i;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Z.Ay,{type:"pills",className:"my-6 flex flex-grow flex-col","data-sentry-element":"Menu","data-sentry-source-file":"StorageMenu.tsx",children:[(0,s.jsxs)("div",{className:"mb-6 mx-5 flex flex-col gap-y-1.5",children:[(0,s.jsx)(K.G,{block:!0,type:"default",icon:(0,s.jsx)(o.A,{}),disabled:!k,style:{justifyContent:"start"},onClick:()=>b(!0),tooltip:{content:{side:"bottom",text:k?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"StorageMenu.tsx",children:"New bucket"}),(0,s.jsx)(ee.a0,{className:"px-0","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsx)(ee.RK,{name:"search-buckets","aria-labelledby":"Search buckets",placeholder:"Search buckets...",value:d,onChange:e=>{x(e.target.value)},"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsxs)(ee.i9,{value:N,onValueChange:e=>S(e),"data-sentry-element":"InnerSideBarFilterSortDropdown","data-sentry-source-file":"StorageMenu.tsx",children:[(0,s.jsx)(ee.Pl,{value:"alphabetical",className:"flex gap-2","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"StorageMenu.tsx",children:"Alphabetical"},"alphabetical"),(0,s.jsx)(ee.Pl,{value:"created-at","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"StorageMenu.tsx",children:"Created at"},"created-at")]})})})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(Z.Ay.Group,{title:(0,s.jsx)("span",{className:"uppercase font-mono",children:"All buckets"}),"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx"}),E&&(0,s.jsxs)("div",{className:"space-y-2 mx-2",children:[(0,s.jsx)(Y.A,{className:"!py-2.5"}),(0,s.jsx)(Y.A,{className:"!py-2.5"}),(0,s.jsx)(Y.A,{className:"!py-2.5"})]}),M&&(0,s.jsx)("div",{className:"px-2",children:(0,s.jsxs)(X.Fc,{variant:T?"default":"warning",children:[(0,s.jsx)(X.XL,{className:"text-xs tracking-normal",children:T?"Storage is not available on preview branches for now":"Failed to fetch buckets"}),(0,s.jsx)(X.TN,{className:"text-xs",children:T?"We're actively looking into making this available on preview branches":"Please refresh to try again"})]})}),R&&(0,s.jsxs)(s.Fragment,{children:[0===A.length&&(0,s.jsx)(ee.Q5,{className:"mx-2",title:"No buckets available",description:"Buckets that you create will appear here"}),d.length>0&&0===I.length&&(0,s.jsx)(ee.Q5,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(d,'" did not return any results')}),I.map((e,l)=>{let i=a===e.id;return(0,s.jsx)(eo,{bucket:e,projectRef:t,isSelected:i,onSelectEmptyBucket:()=>v(e),onSelectDeleteBucket:()=>_(e),onSelectEditBucket:()=>g(e)},"".concat(l,"_").concat(e.id))})]})]}),(0,s.jsx)("div",{className:"h-px w-full bg-border"}),(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(Z.Ay.Group,{title:(0,s.jsx)("span",{className:"uppercase font-mono",children:"Configuration"}),"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx"}),(0,s.jsx)(u(),{href:"/project/".concat(t,"/storage/policies"),"data-sentry-element":"Link","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsx)(Z.Ay.Item,{rounded:!0,active:"policies"===C,"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsx)("p",{className:"truncate",children:"Policies"})})}),(0,s.jsx)(u(),{href:"/project/".concat(t,"/settings/storage"),"data-sentry-element":"Link","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsx)(Z.Ay.Item,{rounded:!0,"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"truncate",children:"Settings"}),(0,s.jsx)(c.A,{strokeWidth:1,className:"h-4 w-4","data-sentry-element":"ArrowUpRight","data-sentry-source-file":"StorageMenu.tsx"})]})})})]})]})]}),(0,s.jsx)(O,{visible:h,onClose:()=>b(!1),"data-sentry-element":"CreateBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,s.jsx)(q,{visible:void 0!==y,bucket:y,onClose:()=>g(void 0),"data-sentry-element":"EditBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,s.jsx)($,{visible:void 0!==j,bucket:j,onClose:()=>v(void 0),"data-sentry-element":"EmptyBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,s.jsx)(D.vd,{visible:void 0!==w,bucket:w,onClose:()=>_(void 0),"data-sentry-element":"DeleteBucketModal","data-sentry-source-file":"StorageMenu.tsx"})]})},ed=(0,l.r)(e=>{let{title:t,children:a}=e;return(0,s.jsx)(i.A,{title:t||"Storage",product:"Storage",productMenu:(0,s.jsx)(ec,{}),"data-sentry-element":"ProjectLayout","data-sentry-component":"StorageLayout","data-sentry-source-file":"StorageLayout.tsx",children:a})})}}]);